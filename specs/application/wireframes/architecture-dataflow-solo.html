<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Architecture — Solo Dev, Deep Agent Tree</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link href="https://api.fontshare.com/v2/css?f[]=mona-sans@400,500,600,700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { -webkit-font-smoothing: antialiased; }
    button { cursor: pointer; border: none; background: none; font: inherit; }

    :root {
      --bg-canvas: #0a0e14;
      --bg-default: #131920;
      --bg-subtle: #1a2230;
      --bg-emphasis: #2d3750;
      --border-default: #2a3445;
      --fg-default: #e2eaf4;
      --fg-muted: #7b8da6;
      --fg-subtle: #566580;
      --accent-fg: #58a6ff;
      --success-fg: #3fb950;
      --success-dim: #1a4028;
      --attention-fg: #d29922;
      --done-fg: #a371f7;
      --sdk-fg: #f778ba;
      --event-fg: #e8883a;
      --font-sans: 'Mona Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      --font-mono: 'Fira Code', 'SF Mono', Menlo, Consolas, monospace;
      --radius: 6px;
      --radius-lg: 10px;
    }

    body { font-family: var(--font-sans); font-size: 13px; color: var(--fg-default); background: var(--bg-canvas); height: 100vh; overflow: hidden; }

    body::before {
      content: ''; position: fixed; inset: 0;
      background:
        radial-gradient(ellipse 800px 500px at 50% 15%, rgba(88,166,255,0.04), transparent),
        radial-gradient(ellipse 600px 400px at 50% 75%, rgba(163,113,247,0.03), transparent);
      pointer-events: none; z-index: 0;
    }
    body::after {
      content: ''; position: fixed; inset: 0;
      background-image:
        linear-gradient(rgba(88,166,255,0.015) 1px, transparent 1px),
        linear-gradient(90deg, rgba(88,166,255,0.015) 1px, transparent 1px);
      background-size: 48px 48px; pointer-events: none; z-index: 0;
    }

    .page { display: flex; flex-direction: column; height: 100vh; position: relative; z-index: 1; }

    /* Header */
    .header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 14px 24px; border-bottom: 1px solid var(--border-default);
      background: rgba(10,14,20,0.85); backdrop-filter: blur(12px);
      flex-shrink: 0; z-index: 10;
    }
    .header-left { display: flex; align-items: center; gap: 14px; }
    .logo-mark { width: 28px; height: 28px; border-radius: 7px; background: linear-gradient(135deg, var(--accent-fg), var(--done-fg)); display: grid; place-items: center; font-weight: 700; font-size: 12px; color: #fff; }
    .header h1 { font-size: 14px; font-weight: 600; letter-spacing: -0.02em; }
    .header h1 span { color: var(--fg-muted); font-weight: 400; margin-left: 8px; }
    .legend { display: flex; gap: 20px; font-size: 10px; font-family: var(--font-mono); text-transform: uppercase; letter-spacing: 0.06em; }
    .legend-item { display: flex; align-items: center; gap: 7px; color: var(--fg-muted); }
    .legend-dot { width: 7px; height: 7px; border-radius: 50%; }

    /* Canvas */
    .canvas-wrap { flex: 1; position: relative; overflow: hidden; }
    #conn-svg { position: absolute; inset: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }
    .nodes-layer { position: absolute; inset: 0; z-index: 2; }

    /* Nodes */
    .node {
      position: absolute; border: 1px solid var(--border-default); border-radius: var(--radius-lg);
      background: var(--bg-default); transition: border-color 0.25s, box-shadow 0.25s; cursor: default;
    }
    .node:hover { border-color: var(--fg-subtle); box-shadow: 0 4px 24px rgba(0,0,0,0.35); }
    .node-hdr { display: flex; align-items: center; gap: 8px; padding: 10px 14px; border-bottom: 1px solid var(--border-default); font-weight: 600; font-size: 11px; }
    .node-ico { width: 24px; height: 24px; border-radius: 5px; display: grid; place-items: center; flex-shrink: 0; font-size: 12px; }
    .node-lbl { display: flex; flex-direction: column; gap: 1px; min-width: 0; }
    .node-title { color: var(--fg-default); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .node-sub { font-size: 9px; font-weight: 400; font-family: var(--font-mono); color: var(--fg-subtle); }
    .node-body { padding: 8px 14px 10px; display: flex; flex-direction: column; gap: 4px; }
    .node-row { font-size: 10px; font-family: var(--font-mono); color: var(--fg-muted); display: flex; align-items: center; gap: 5px; }
    .node-row .d { width: 4px; height: 4px; border-radius: 50%; flex-shrink: 0; }

    .status-pill {
      margin-left: auto; display: inline-flex; align-items: center; gap: 4px;
      padding: 2px 7px; border-radius: 999px; font-size: 9px; font-family: var(--font-mono); font-weight: 500;
    }
    .status-pill .blink { width: 5px; height: 5px; border-radius: 50%; animation: blink 2s ease-in-out infinite; }
    @keyframes blink { 0%,100%{opacity:1;} 50%{opacity:0.3;} }

    /* Node themes */
    .node[data-type="user"] { border-color: rgba(88,166,255,0.3); background: linear-gradient(145deg, var(--bg-default), rgba(45,90,142,0.12)); }
    .node[data-type="user"] .node-ico { background: rgba(88,166,255,0.15); color: var(--accent-fg); }
    .node[data-type="user"]:hover { border-color: rgba(88,166,255,0.5); }

    .node[data-type="agent"] { border-color: rgba(163,113,247,0.25); background: linear-gradient(145deg, var(--bg-default), rgba(120,50,170,0.08)); }
    .node[data-type="agent"] .node-ico { background: rgba(163,113,247,0.15); color: var(--done-fg); }
    .node[data-type="agent"]:hover { border-color: rgba(163,113,247,0.5); }

    .node[data-type="subagent"] { border-color: rgba(247,120,186,0.25); background: linear-gradient(145deg, var(--bg-default), rgba(120,50,90,0.08)); }
    .node[data-type="subagent"] .node-ico { background: rgba(247,120,186,0.15); color: var(--sdk-fg); }
    .node[data-type="subagent"]:hover { border-color: rgba(247,120,186,0.5); }

    .node[data-type="sdk"] { border-color: rgba(247,120,186,0.25); background: linear-gradient(145deg, var(--bg-default), rgba(120,50,90,0.08)); }
    .node[data-type="sdk"] .node-ico { background: rgba(247,120,186,0.15); color: var(--sdk-fg); }

    .node[data-type="infra"] { border-color: rgba(63,185,80,0.25); }
    .node[data-type="infra"] .node-ico { background: rgba(63,185,80,0.15); color: var(--success-fg); }

    /* Depth bar */
    .depth-bar { position: absolute; left: -2px; top: 12px; bottom: 12px; width: 3px; border-radius: 3px; }

    /* Connection labels */
    .conn-label {
      position: absolute; font-size: 8px; font-family: var(--font-mono);
      text-transform: uppercase; letter-spacing: 0.06em; pointer-events: none; z-index: 3;
      padding: 2px 6px; border-radius: 3px; background: rgba(10,14,20,0.8);
    }

    /* Ticker */
    .ticker {
      flex-shrink: 0; height: 36px; background: rgba(10,14,20,0.9); backdrop-filter: blur(8px);
      border-top: 1px solid var(--border-default); display: flex; align-items: center;
      overflow: hidden; padding: 0 16px; gap: 8px; z-index: 10;
    }
    .ticker-label { font-size: 8px; font-family: var(--font-mono); text-transform: uppercase; letter-spacing: 0.1em; color: var(--fg-subtle); flex-shrink: 0; padding-right: 10px; border-right: 1px solid var(--border-default); }
    .ticker-track { flex: 1; display: flex; gap: 20px; animation: scroll 35s linear infinite; white-space: nowrap; }
    @keyframes scroll { 0%{transform:translateX(0);} 100%{transform:translateX(-50%);} }
    .tk-ev { display: flex; align-items: center; gap: 5px; font-size: 10px; font-family: var(--font-mono); color: var(--fg-muted); flex-shrink: 0; }
    .tk-ev .tk-dot { width: 4px; height: 4px; border-radius: 50%; }
    .tk-ev .tk-type { font-weight: 500; }
    .tk-ev .tk-dim { color: var(--fg-subtle); }

    /* Info panel */
    .info-panel {
      position: fixed; bottom: 48px; right: 16px; background: var(--bg-default);
      border: 1px solid var(--border-default); border-radius: var(--radius-lg);
      padding: 14px 16px; z-index: 15; width: 220px;
    }
    .ip-title { font-size: 9px; font-family: var(--font-mono); text-transform: uppercase; letter-spacing: 0.08em; color: var(--fg-subtle); margin-bottom: 10px; }
    .ip-row { display: flex; align-items: center; justify-content: space-between; font-size: 10px; font-family: var(--font-mono); color: var(--fg-muted); padding: 3px 0; }
    .ip-row strong { color: var(--fg-default); font-weight: 600; }
    .ip-sep { height: 1px; background: var(--border-default); margin: 6px 0; }

    @media (prefers-reduced-motion: reduce) { *, *::before, *::after { animation-duration: 0.01ms !important; transition-duration: 0.01ms !important; } }
  </style>
</head>
<body>
<div class="page">
  <header class="header">
    <div class="header-left">
      <div class="logo-mark">A</div>
      <h1>Architecture<span>Solo Dev — Deep Agent Tree (4 Levels)</span></h1>
    </div>
    <div class="legend">
      <div class="legend-item"><div class="legend-dot" style="background:var(--accent-fg);box-shadow:0 0 6px rgba(88,166,255,0.4)"></div>User</div>
      <div class="legend-item"><div class="legend-dot" style="background:var(--done-fg);box-shadow:0 0 6px rgba(163,113,247,0.4)"></div>Agent</div>
      <div class="legend-item"><div class="legend-dot" style="background:var(--sdk-fg);box-shadow:0 0 6px rgba(247,120,186,0.4)"></div>Sub-Agent</div>
      <div class="legend-item"><div class="legend-dot" style="background:var(--success-fg);box-shadow:0 0 6px rgba(63,185,80,0.4)"></div>Infra</div>
    </div>
  </header>

  <div class="canvas-wrap" id="canvas">
    <svg id="conn-svg">
      <defs><filter id="glow"><feGaussianBlur stdDeviation="3" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs>
    </svg>

    <div class="nodes-layer" id="nodes">

      <!-- ═══ DEPTH 0: User Session — top center ═══ -->
      <div class="node" data-id="user" data-type="user" style="left:50%; top:1%; width:280px; transform:translateX(-50%);">
        <div class="depth-bar" style="background:var(--accent-fg);"></div>
        <div class="node-hdr">
          <div class="node-ico"><svg width="14" height="14" viewBox="0 0 16 16" fill="none"><circle cx="8" cy="5" r="3" stroke="currentColor" stroke-width="1.5"/><path d="M2 14c0-3.3 2.7-6 6-6s6 2.7 6 6" stroke="currentColor" stroke-width="1.5"/></svg></div>
          <div class="node-lbl"><span class="node-title">User Session — Simon</span><span class="node-sub">usr-a1b2c3d · depth 0</span></div>
          <div class="status-pill" style="background:rgba(45,90,142,0.3);color:var(--accent-fg);"><span class="blink" style="background:var(--accent-fg);"></span>working</div>
        </div>
        <div class="node-body">
          <div class="node-row"><div class="d" style="background:var(--accent-fg)"></div>OAuth2 PKCE flow · feature/auth-overhaul</div>
          <div class="node-row"><div class="d" style="background:var(--accent-fg)"></div>47 msgs · 23 turns · sonnet-4</div>
          <div class="node-row"><div class="d" style="background:var(--event-fg)"></div>284K tokens · $1.42</div>
        </div>
      </div>

      <!-- ═══ DEPTH 1: Three top-level agents ═══ -->
      <div class="node" data-id="agent1" data-type="agent" style="left:2%; top:20%; width:210px;">
        <div class="depth-bar" style="background:var(--done-fg);"></div>
        <div class="node-hdr">
          <div class="node-ico"><svg width="14" height="14" viewBox="0 0 16 16" fill="none"><rect x="2" y="3" width="12" height="10" rx="2" stroke="currentColor" stroke-width="1.5"/><path d="M5 7l2 1.5L5 10" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
          <div class="node-lbl"><span class="node-title">Agent: OAuth Callback</span><span class="node-sub">agt-f7a8b9c · depth 1</span></div>
          <div class="status-pill" style="background:var(--success-dim);color:var(--success-fg);"><span class="blink" style="background:var(--success-fg);"></span>working</div>
        </div>
        <div class="node-body">
          <div class="node-row"><div class="d" style="background:var(--done-fg)"></div>PKCE + token exchange</div>
          <div class="node-row"><div class="d" style="background:var(--event-fg)"></div>156K tokens · 9 turns</div>
        </div>
      </div>

      <div class="node" data-id="agent2" data-type="agent" style="left:50%; top:20%; width:210px; transform:translateX(-50%);">
        <div class="depth-bar" style="background:var(--attention-fg);"></div>
        <div class="node-hdr">
          <div class="node-ico"><svg width="14" height="14" viewBox="0 0 16 16" fill="none"><path d="M8 3v5l3 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.5"/></svg></div>
          <div class="node-lbl"><span class="node-title">Agent: Token Refresh</span><span class="node-sub">agt-3e4f5a6 · depth 1</span></div>
          <div class="status-pill" style="background:rgba(210,153,34,0.2);color:var(--attention-fg);">approval</div>
        </div>
        <div class="node-body">
          <div class="node-row"><div class="d" style="background:var(--done-fg)"></div>Refresh middleware</div>
          <div class="node-row"><div class="d" style="background:var(--event-fg)"></div>98K tokens · 7 turns</div>
        </div>
      </div>

      <div class="node" data-id="agent3" data-type="agent" style="right:2%; top:20%; width:210px;">
        <div class="depth-bar" style="background:var(--done-fg);"></div>
        <div class="node-hdr">
          <div class="node-ico"><svg width="14" height="14" viewBox="0 0 16 16" fill="none"><ellipse cx="8" cy="4" rx="5" ry="2" stroke="currentColor" stroke-width="1.5"/><path d="M3 4v8c0 1.1 2.24 2 5 2s5-.9 5-2V4" stroke="currentColor" stroke-width="1.5"/></svg></div>
          <div class="node-lbl"><span class="node-title">Agent: Session Persist</span><span class="node-sub">agt-9d0e1f2 · depth 1</span></div>
          <div class="status-pill" style="background:var(--success-dim);color:var(--success-fg);"><span class="blink" style="background:var(--success-fg);"></span>working</div>
        </div>
        <div class="node-body">
          <div class="node-row"><div class="d" style="background:var(--done-fg)"></div>SQLite sessions table</div>
          <div class="node-row"><div class="d" style="background:var(--event-fg)"></div>72K tokens · 4 turns</div>
        </div>
      </div>

      <!-- ═══ DEPTH 2: Sub-agents (children of depth 1) ═══ -->
      <div class="node" data-id="sub1a" data-type="subagent" style="left:1%; top:43%; width:195px;">
        <div class="depth-bar" style="background:var(--sdk-fg);"></div>
        <div class="node-hdr">
          <div class="node-ico"><svg width="14" height="14" viewBox="0 0 16 16" fill="none"><path d="M4 12l4-8 4 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M5.5 9h5" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/></svg></div>
          <div class="node-lbl"><span class="node-title">Sub: Test Writer</span><span class="node-sub">agt-5c6d7e8 · depth 2</span></div>
          <div class="status-pill" style="background:var(--success-dim);color:var(--success-fg);"><span class="blink" style="background:var(--success-fg);"></span>working</div>
        </div>
        <div class="node-body">
          <div class="node-row"><div class="d" style="background:var(--sdk-fg)"></div>Integration tests · haiku-4</div>
          <div class="node-row"><div class="d" style="background:var(--event-fg)"></div>44K tokens · 3 turns</div>
        </div>
      </div>

      <div class="node" data-id="sub1b" data-type="subagent" style="left:17%; top:43%; width:195px;">
        <div class="depth-bar" style="background:var(--sdk-fg);"></div>
        <div class="node-hdr">
          <div class="node-ico"><svg width="14" height="14" viewBox="0 0 16 16" fill="none"><path d="M2 4h12M2 8h8M2 12h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg></div>
          <div class="node-lbl"><span class="node-title">Sub: Error Handler</span><span class="node-sub">agt-a1b2c3d · depth 2</span></div>
          <div class="status-pill" style="background:var(--success-dim);color:var(--success-fg);"><span class="blink" style="background:var(--success-fg);"></span>working</div>
        </div>
        <div class="node-body">
          <div class="node-row"><div class="d" style="background:var(--sdk-fg)"></div>PKCE error catalog · haiku-4</div>
          <div class="node-row"><div class="d" style="background:var(--event-fg)"></div>32K tokens · 2 turns</div>
        </div>
      </div>

      <div class="node" data-id="sub2a" data-type="subagent" style="left:36%; top:43%; width:195px;">
        <div class="depth-bar" style="background:var(--sdk-fg);"></div>
        <div class="node-hdr">
          <div class="node-ico"><svg width="14" height="14" viewBox="0 0 16 16" fill="none"><rect x="3" y="3" width="10" height="10" rx="1.5" stroke="currentColor" stroke-width="1.5"/><path d="M6 7h4M6 9h2" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/></svg></div>
          <div class="node-lbl"><span class="node-title">Sub: Type Generator</span><span class="node-sub">agt-d4e5f6a · depth 2</span></div>
          <div class="status-pill" style="background:rgba(210,153,34,0.2);color:var(--attention-fg);">approval</div>
        </div>
        <div class="node-body">
          <div class="node-row"><div class="d" style="background:var(--sdk-fg)"></div>Zod schemas for tokens</div>
          <div class="node-row"><div class="d" style="background:var(--event-fg)"></div>28K tokens · 2 turns</div>
        </div>
      </div>

      <div class="node" data-id="sub3a" data-type="subagent" style="left:55%; top:43%; width:195px;">
        <div class="depth-bar" style="background:var(--sdk-fg);"></div>
        <div class="node-hdr">
          <div class="node-ico"><svg width="14" height="14" viewBox="0 0 16 16" fill="none"><circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.5"/><path d="M8 5v3l2 2" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/></svg></div>
          <div class="node-lbl"><span class="node-title">Sub: Migration</span><span class="node-sub">agt-7b8c9d0 · depth 2</span></div>
          <div class="status-pill" style="background:var(--success-dim);color:var(--success-fg);"><span class="blink" style="background:var(--success-fg);"></span>working</div>
        </div>
        <div class="node-body">
          <div class="node-row"><div class="d" style="background:var(--sdk-fg)"></div>Drizzle migration gen</div>
          <div class="node-row"><div class="d" style="background:var(--event-fg)"></div>36K tokens · 3 turns</div>
        </div>
      </div>

      <div class="node" data-id="sub3b" data-type="subagent" style="right:2%; top:43%; width:195px;">
        <div class="depth-bar" style="background:var(--sdk-fg);"></div>
        <div class="node-hdr">
          <div class="node-ico"><svg width="14" height="14" viewBox="0 0 16 16" fill="none"><path d="M8 2v12M2 8h12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg></div>
          <div class="node-lbl"><span class="node-title">Sub: API Route</span><span class="node-sub">agt-e1f2a3b · depth 2</span></div>
          <div class="status-pill" style="background:var(--success-dim);color:var(--success-fg);"><span class="blink" style="background:var(--success-fg);"></span>working</div>
        </div>
        <div class="node-body">
          <div class="node-row"><div class="d" style="background:var(--sdk-fg)"></div>Hono session endpoints</div>
          <div class="node-row"><div class="d" style="background:var(--event-fg)"></div>52K tokens · 4 turns</div>
        </div>
      </div>

      <!-- ═══ DEPTH 3: Sub-sub-agents (children of depth 2) ═══ -->
      <div class="node" data-id="subsub1" data-type="subagent" style="left:1%; top:66%; width:185px;">
        <div class="depth-bar" style="background:var(--event-fg);"></div>
        <div class="node-hdr">
          <div class="node-ico" style="background:rgba(232,136,58,0.15);color:var(--event-fg);"><svg width="14" height="14" viewBox="0 0 16 16" fill="none"><path d="M3 13V7l5-4 5 4v6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
          <div class="node-lbl"><span class="node-title">Sub³: Fixture Gen</span><span class="node-sub">agt-fix001 · depth 3</span></div>
          <div class="status-pill" style="background:var(--success-dim);color:var(--success-fg);"><span class="blink" style="background:var(--success-fg);"></span>working</div>
        </div>
        <div class="node-body">
          <div class="node-row"><div class="d" style="background:var(--event-fg)"></div>Test factory data · haiku-4</div>
        </div>
      </div>

      <div class="node" data-id="subsub2" data-type="subagent" style="left:16%; top:66%; width:185px;">
        <div class="depth-bar" style="background:var(--event-fg);"></div>
        <div class="node-hdr">
          <div class="node-ico" style="background:rgba(232,136,58,0.15);color:var(--event-fg);"><svg width="14" height="14" viewBox="0 0 16 16" fill="none"><path d="M4 4l8 8M12 4l-8 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg></div>
          <div class="node-lbl"><span class="node-title">Sub³: Edge Cases</span><span class="node-sub">agt-edg002 · depth 3</span></div>
          <div class="status-pill" style="background:var(--success-dim);color:var(--success-fg);"><span class="blink" style="background:var(--success-fg);"></span>working</div>
        </div>
        <div class="node-body">
          <div class="node-row"><div class="d" style="background:var(--event-fg)"></div>Error boundary tests</div>
        </div>
      </div>

      <div class="node" data-id="subsub3" data-type="subagent" style="left:55%; top:66%; width:185px;">
        <div class="depth-bar" style="background:var(--event-fg);"></div>
        <div class="node-hdr">
          <div class="node-ico" style="background:rgba(232,136,58,0.15);color:var(--event-fg);"><svg width="14" height="14" viewBox="0 0 16 16" fill="none"><path d="M3 3h10v10H3z" stroke="currentColor" stroke-width="1.5"/><path d="M7 7h2v2H7z" fill="currentColor" opacity="0.5"/></svg></div>
          <div class="node-lbl"><span class="node-title">Sub³: Seed Script</span><span class="node-sub">agt-sed003 · depth 3</span></div>
          <div class="status-pill" style="background:var(--success-dim);color:var(--success-fg);"><span class="blink" style="background:var(--success-fg);"></span>working</div>
        </div>
        <div class="node-body">
          <div class="node-row"><div class="d" style="background:var(--event-fg)"></div>DB seed for sessions</div>
        </div>
      </div>

      <div class="node" data-id="subsub4" data-type="subagent" style="right:2%; top:66%; width:185px;">
        <div class="depth-bar" style="background:var(--event-fg);"></div>
        <div class="node-hdr">
          <div class="node-ico" style="background:rgba(232,136,58,0.15);color:var(--event-fg);"><svg width="14" height="14" viewBox="0 0 16 16" fill="none"><circle cx="8" cy="8" r="3" stroke="currentColor" stroke-width="1.5"/><path d="M8 2v2M8 12v2M2 8h2M12 8h2" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/></svg></div>
          <div class="node-lbl"><span class="node-title">Sub³: Validators</span><span class="node-sub">agt-val004 · depth 3</span></div>
          <div class="status-pill" style="background:rgba(210,153,34,0.2);color:var(--attention-fg);">approval</div>
        </div>
        <div class="node-body">
          <div class="node-row"><div class="d" style="background:var(--event-fg)"></div>Route param validation</div>
        </div>
      </div>

      <!-- ═══ BOTTOM ROW: SDK + Worktree ═══ -->
      <div class="node" data-id="sdk" data-type="sdk" style="left:25%; top:86%; width:220px;">
        <div class="node-hdr">
          <div class="node-ico"><svg width="14" height="14" viewBox="0 0 16 16" fill="none"><circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.5"/><circle cx="8" cy="8" r="1.5" fill="currentColor" opacity="0.4"/></svg></div>
          <div class="node-lbl"><span class="node-title">Claude Agent SDK</span><span class="node-sub">Plan → Execute → Spawn</span></div>
        </div>
        <div class="node-body">
          <div class="node-row"><div class="d" style="background:var(--sdk-fg)"></div>ExitPlanMode → 3 agents</div>
          <div class="node-row"><div class="d" style="background:var(--sdk-fg)"></div>Task tool → 8 sub-agents</div>
        </div>
      </div>

      <div class="node" data-id="worktree" data-type="infra" style="right:10%; top:86%; width:220px;">
        <div class="node-hdr">
          <div class="node-ico"><svg width="14" height="14" viewBox="0 0 16 16" fill="none"><circle cx="8" cy="4" r="2" stroke="currentColor" stroke-width="1.5"/><circle cx="5" cy="12" r="2" stroke="currentColor" stroke-width="1.5"/><circle cx="11" cy="12" r="2" stroke="currentColor" stroke-width="1.5"/><path d="M8 6v2M6.5 9.5L5 10M9.5 9.5L11 10" stroke="currentColor" stroke-width="1.2"/></svg></div>
          <div class="node-lbl"><span class="node-title">Git Worktree</span><span class="node-sub">feature/auth-overhaul</span></div>
        </div>
        <div class="node-body">
          <div class="node-row"><div class="d" style="background:var(--success-fg)"></div>Shared branch, 12 sessions</div>
        </div>
      </div>

    </div>
  </div>

  <div class="ticker">
    <div class="ticker-label">Live Events</div>
    <div class="ticker-track" id="ticker-track"></div>
  </div>
</div>

<div class="info-panel">
  <div class="ip-title">Hierarchy</div>
  <div class="ip-row"><span>Sessions</span><strong>12</strong></div>
  <div class="ip-row"><span>Users</span><strong style="color:var(--accent-fg)">1</strong></div>
  <div class="ip-row"><span>Agents (d1)</span><strong style="color:var(--done-fg)">3</strong></div>
  <div class="ip-row"><span>Sub-agents (d2)</span><strong style="color:var(--sdk-fg)">5</strong></div>
  <div class="ip-row"><span>Sub³ (d3)</span><strong style="color:var(--event-fg)">4</strong></div>
  <div class="ip-row"><span>Max depth</span><strong>3</strong></div>
  <div class="ip-sep"></div>
  <div class="ip-row"><span>Working</span><strong style="color:var(--success-fg)">10</strong></div>
  <div class="ip-row"><span>Approval</span><strong style="color:var(--attention-fg)">3</strong></div>
  <div class="ip-sep"></div>
  <div class="ip-row"><span>Tokens</span><strong>886K</strong></div>
  <div class="ip-row"><span>Cost</span><strong style="color:var(--attention-fg)">$4.43</strong></div>
</div>

<script>
const CONNECTIONS = [
  // User → Depth 1 agents
  { from:'user', to:'agent1', color:'#58a6ff', label:'spawn' },
  { from:'user', to:'agent2', color:'#58a6ff', label:'spawn' },
  { from:'user', to:'agent3', color:'#58a6ff', label:'spawn' },
  // Agent1 → depth 2 subs
  { from:'agent1', to:'sub1a', color:'#a371f7', label:'Task tool' },
  { from:'agent1', to:'sub1b', color:'#a371f7' },
  // Agent2 → depth 2 sub
  { from:'agent2', to:'sub2a', color:'#a371f7', label:'Task tool' },
  // Agent3 → depth 2 subs
  { from:'agent3', to:'sub3a', color:'#a371f7', label:'Task tool' },
  { from:'agent3', to:'sub3b', color:'#a371f7' },
  // Depth 2 → depth 3 subs
  { from:'sub1a', to:'subsub1', color:'#f778ba', label:'Task tool' },
  { from:'sub1b', to:'subsub2', color:'#f778ba' },
  { from:'sub3a', to:'subsub3', color:'#f778ba' },
  { from:'sub3b', to:'subsub4', color:'#f778ba' },
  // Bottom infra connections
  { from:'sub2a', to:'sdk',  color:'#f778ba' },
  { from:'subsub1', to:'sdk', color:'#f778ba' },
  { from:'sub3b', to:'worktree', color:'#3fb950', label:'git ops' },
];

const svg = document.getElementById('conn-svg');
const canvas = document.getElementById('canvas');

function getCenter(el) {
  const r = el.getBoundingClientRect();
  const cr = canvas.getBoundingClientRect();
  return {
    cx: r.left - cr.left + r.width / 2,
    top: r.top - cr.top,
    bottom: r.top - cr.top + r.height,
  };
}

function drawAll() {
  while (svg.childNodes.length > 1) svg.removeChild(svg.lastChild);
  document.querySelectorAll('.conn-label').forEach(e => e.remove());

  CONNECTIONS.forEach(conn => {
    const fromEl = document.querySelector(`[data-id="${conn.from}"]`);
    const toEl = document.querySelector(`[data-id="${conn.to}"]`);
    if (!fromEl || !toEl) return;

    const f = getCenter(fromEl);
    const t = getCenter(toEl);

    const midY = (f.bottom + t.top) / 2;
    const points = [
      `${f.cx},${f.bottom}`,
      `${f.cx},${midY}`,
      `${t.cx},${midY}`,
      `${t.cx},${t.top}`,
    ];

    const polyline = document.createElementNS('http://www.w3.org/2000/svg', 'polyline');
    polyline.setAttribute('points', points.join(' '));
    polyline.setAttribute('fill', 'none');
    polyline.setAttribute('stroke', conn.color);
    polyline.setAttribute('stroke-opacity', '0.35');
    polyline.setAttribute('stroke-width', '1.5');
    svg.appendChild(polyline);

    const arrow = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
    arrow.setAttribute('points', '-4,-8 4,-8 0,0');
    arrow.setAttribute('transform', `translate(${t.cx},${t.top})`);
    arrow.setAttribute('fill', conn.color);
    arrow.setAttribute('opacity', '0.6');
    svg.appendChild(arrow);

    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
    circle.setAttribute('r', '2.5');
    circle.setAttribute('fill', conn.color);
    circle.setAttribute('filter', 'url(#glow)');
    svg.appendChild(circle);

    const segs = [];
    for (let i = 0; i < points.length - 1; i++) {
      const [x1, y1] = points[i].split(',').map(Number);
      const [x2, y2] = points[i + 1].split(',').map(Number);
      const len = Math.sqrt((x2-x1)**2 + (y2-y1)**2);
      segs.push({ x1, y1, x2, y2, len });
    }
    const totalLen = segs.reduce((s, seg) => s + seg.len, 0);
    let t0 = Math.random();
    const speed = 0.004 + Math.random() * 0.002;

    function tick() {
      t0 = (t0 + speed) % 1;
      let dist = t0 * totalLen;
      for (const seg of segs) {
        if (dist <= seg.len) {
          const frac = dist / seg.len;
          circle.setAttribute('cx', seg.x1 + (seg.x2 - seg.x1) * frac);
          circle.setAttribute('cy', seg.y1 + (seg.y2 - seg.y1) * frac);
          break;
        }
        dist -= seg.len;
      }
      requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);

    if (conn.label) {
      const lbl = document.createElement('div');
      lbl.className = 'conn-label';
      lbl.textContent = conn.label;
      lbl.style.color = conn.color;
      lbl.style.left = ((f.cx + t.cx) / 2) + 'px';
      lbl.style.top = (midY - 12) + 'px';
      lbl.style.transform = 'translateX(-50%)';
      canvas.appendChild(lbl);
    }
  });
}

function buildTicker() {
  const evs = [
    { t:'user:spawn', c:'#58a6ff', a:'usr-a1b2c3d', d:'→ 3 agents' },
    { t:'agent:started', c:'#a371f7', a:'agt-f7a8b9c', d:'OAuth Callback' },
    { t:'tool:Task', c:'#f778ba', a:'agt-f7a8b9c', d:'→ Test Writer (d2)' },
    { t:'tool:Task', c:'#f778ba', a:'agt-f7a8b9c', d:'→ Error Handler (d2)' },
    { t:'agent:plan_ready', c:'#d29922', a:'agt-3e4f5a6', d:'Token Refresh · approval' },
    { t:'tool:Task', c:'#f778ba', a:'agt-3e4f5a6', d:'→ Type Generator (d2)' },
    { t:'tool:Task', c:'#f778ba', a:'agt-9d0e1f2', d:'→ Migration (d2)' },
    { t:'tool:Task', c:'#f778ba', a:'agt-9d0e1f2', d:'→ API Route (d2)' },
    { t:'tool:Task', c:'#e8883a', a:'agt-5c6d7e8', d:'→ Fixture Gen (d3)' },
    { t:'tool:Task', c:'#e8883a', a:'agt-a1b2c3d', d:'→ Edge Cases (d3)' },
    { t:'tool:Task', c:'#e8883a', a:'agt-7b8c9d0', d:'→ Seed Script (d3)' },
    { t:'tool:Task', c:'#e8883a', a:'agt-e1f2a3b', d:'→ Validators (d3)' },
    { t:'agent:turn', c:'#a371f7', a:'agt-fix001', d:'turn 2 · Fixture Gen' },
    { t:'test:pass', c:'#3fb950', a:'agt-edg002', d:'5/5 edge cases' },
  ];
  const all = [...evs, ...evs];
  const now = Date.now();
  document.getElementById('ticker-track').innerHTML = all.map((e, i) => {
    const ts = new Date(now - (all.length - i) * 2500).toLocaleTimeString('en-US', { hour12:false, hour:'2-digit', minute:'2-digit', second:'2-digit' });
    return `<div class="tk-ev"><span class="tk-dot" style="background:${e.c}"></span><span class="tk-type" style="color:${e.c}">${e.t}</span><span class="tk-dim">→</span><span>${e.a}</span>${e.d ? `<span class="tk-dim">· ${e.d}</span>` : ''}<span class="tk-dim">${ts}</span></div>`;
  }).join('');
}

buildTicker();
requestAnimationFrame(() => requestAnimationFrame(drawAll));
let rt; window.addEventListener('resize', () => { clearTimeout(rt); rt = setTimeout(drawAll, 150); });
</script>
</body>
</html>
