<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AgentPane Neural Observatory â€” Design 1</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=IBM+Plex+Mono:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
/* ============================================================
   RESET & BASE
   ============================================================ */
*, *::before, *::after {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

:root {
  --bg-deep: #0a0a0f;
  --bg-surface: #0d0d15;
  --bg-elevated: #12121e;
  --cyan: #00f0ff;
  --cyan-dim: #00f0ff44;
  --cyan-glow: #00f0ff22;
  --amber: #ff9500;
  --amber-dim: #ff950044;
  --amber-glow: #ff950022;
  --violet: #8b5cf6;
  --violet-dim: #8b5cf644;
  --violet-glow: #8b5cf622;
  --red: #ff3b5c;
  --green: #00e676;
  --white: #e8eaed;
  --white-dim: #e8eaed88;
  --white-muted: #e8eaed44;
  --glass-bg: rgba(13, 13, 21, 0.75);
  --glass-border: rgba(255, 255, 255, 0.06);
  --glass-highlight: rgba(255, 255, 255, 0.03);
  --font-display: 'Orbitron', sans-serif;
  --font-mono: 'IBM Plex Mono', monospace;
}

html, body {
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: var(--bg-deep);
  color: var(--white);
  font-family: var(--font-mono);
  -webkit-font-smoothing: antialiased;
}

/* ============================================================
   SCANLINE OVERLAY
   ============================================================ */
.scanline-overlay {
  position: fixed;
  inset: 0;
  z-index: 9999;
  pointer-events: none;
  background: repeating-linear-gradient(
    0deg,
    transparent,
    transparent 2px,
    rgba(0, 0, 0, 0.03) 2px,
    rgba(0, 0, 0, 0.03) 4px
  );
}

.scanline-overlay::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(
    180deg,
    rgba(0, 240, 255, 0.01) 0%,
    transparent 8%,
    transparent 92%,
    rgba(0, 240, 255, 0.01) 100%
  );
  animation: scanlineMove 8s linear infinite;
}

@keyframes scanlineMove {
  0% { transform: translateY(-100%); }
  100% { transform: translateY(100%); }
}

/* ============================================================
   PARTICLE CANVAS
   ============================================================ */
#particleCanvas {
  position: fixed;
  inset: 0;
  z-index: 0;
  pointer-events: none;
}

/* ============================================================
   MAIN LAYOUT
   ============================================================ */
.observatory {
  position: relative;
  width: 100%;
  height: 100vh;
  display: grid;
  grid-template-columns: 280px 1fr 340px;
  grid-template-rows: 56px 1fr 140px 36px;
  grid-template-areas:
    "timeline timeline timeline"
    "metrics  core     codestream"
    "metrics  heatmap  codestream"
    "status   status   status";
  gap: 0;
  z-index: 1;
}

/* ============================================================
   SESSION TIMELINE (TOP)
   ============================================================ */
.session-timeline {
  grid-area: timeline;
  display: flex;
  align-items: center;
  padding: 0 24px;
  background: linear-gradient(180deg, rgba(13, 13, 21, 0.95) 0%, rgba(13, 13, 21, 0.6) 100%);
  border-bottom: 1px solid var(--glass-border);
  z-index: 10;
  gap: 16px;
}

.timeline-label {
  font-family: var(--font-display);
  font-size: 10px;
  font-weight: 600;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--cyan);
  white-space: nowrap;
}

.timeline-elapsed {
  font-family: var(--font-mono);
  font-size: 12px;
  font-weight: 500;
  color: var(--white-dim);
  white-space: nowrap;
  min-width: 64px;
}

.timeline-track {
  flex: 1;
  height: 24px;
  position: relative;
  display: flex;
  align-items: center;
}

.timeline-rail {
  width: 100%;
  height: 2px;
  background: var(--glass-border);
  border-radius: 1px;
  position: relative;
  overflow: visible;
}

.timeline-progress {
  height: 100%;
  background: linear-gradient(90deg, var(--cyan), var(--cyan-dim));
  border-radius: 1px;
  position: relative;
  transition: width 1s linear;
  box-shadow: 0 0 8px var(--cyan-dim);
}

.timeline-cursor {
  position: absolute;
  right: -5px;
  top: 50%;
  transform: translateY(-50%);
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--cyan);
  box-shadow: 0 0 12px var(--cyan), 0 0 24px var(--cyan-dim);
  animation: cursorPulse 2s ease-in-out infinite;
}

@keyframes cursorPulse {
  0%, 100% { transform: translateY(-50%) scale(1); opacity: 1; }
  50% { transform: translateY(-50%) scale(1.3); opacity: 0.8; }
}

.timeline-events {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
}

.timeline-event {
  position: absolute;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  transform: translateX(-50%);
  transition: all 0.3s ease;
}

.timeline-event:hover {
  transform: translateX(-50%) scale(2);
  z-index: 5;
}

.timeline-event.tool { background: var(--cyan); box-shadow: 0 0 6px var(--cyan-dim); }
.timeline-event.completion { background: var(--green); box-shadow: 0 0 6px rgba(0, 230, 118, 0.3); }
.timeline-event.error { background: var(--red); box-shadow: 0 0 6px rgba(255, 59, 92, 0.3); }
.timeline-event.planning { background: var(--amber); box-shadow: 0 0 6px var(--amber-dim); }

.timeline-total {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--white-muted);
  white-space: nowrap;
  min-width: 48px;
  text-align: right;
}

/* ============================================================
   METRICS PANEL (LEFT)
   ============================================================ */
.metrics-panel {
  grid-area: metrics;
  padding: 20px 16px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  overflow-y: auto;
  background: linear-gradient(90deg, rgba(13, 13, 21, 0.9) 0%, transparent 100%);
  border-right: 1px solid var(--glass-border);
  z-index: 10;
}

.metrics-section-title {
  font-family: var(--font-display);
  font-size: 9px;
  font-weight: 700;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--white-muted);
  margin-bottom: 4px;
  padding-left: 4px;
}

.metric-card {
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  border-radius: 12px;
  padding: 16px;
  position: relative;
  overflow: hidden;
  transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
  backdrop-filter: blur(20px);
}

.metric-card::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, var(--glass-highlight) 0%, transparent 50%);
  pointer-events: none;
}

.metric-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
  border-color: rgba(255, 255, 255, 0.1);
}

.metric-card-accent {
  position: absolute;
  top: 0;
  left: 0;
  width: 3px;
  height: 100%;
  border-radius: 3px 0 0 3px;
}

.metric-label {
  font-family: var(--font-display);
  font-size: 9px;
  font-weight: 600;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--white-muted);
  margin-bottom: 8px;
  padding-left: 12px;
}

.metric-value {
  font-family: var(--font-display);
  font-size: 28px;
  font-weight: 800;
  letter-spacing: 1px;
  padding-left: 12px;
  line-height: 1;
}

.metric-sub {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--white-muted);
  margin-top: 6px;
  padding-left: 12px;
}

.metric-spark {
  margin-top: 10px;
  padding-left: 12px;
  height: 24px;
}

.metric-spark svg {
  width: 100%;
  height: 24px;
}

.spark-line {
  fill: none;
  stroke-width: 1.5;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.spark-area {
  opacity: 0.15;
}

/* ============================================================
   CENTRAL CORE AREA
   ============================================================ */
.core-area {
  grid-area: core;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

/* Neural Core */
.neural-core {
  position: absolute;
  width: 180px;
  height: 180px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 5;
}

.core-orb {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  background: radial-gradient(circle at 35% 35%,
    rgba(0, 240, 255, 0.3) 0%,
    rgba(139, 92, 246, 0.2) 30%,
    rgba(10, 10, 15, 0.9) 70%
  );
  box-shadow:
    0 0 60px rgba(0, 240, 255, 0.2),
    0 0 120px rgba(0, 240, 255, 0.1),
    inset 0 0 40px rgba(0, 240, 255, 0.1);
  animation: coreBreath 4s ease-in-out infinite;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
}

@keyframes coreBreath {
  0%, 100% { transform: scale(1); box-shadow: 0 0 60px rgba(0, 240, 255, 0.2), 0 0 120px rgba(0, 240, 255, 0.1), inset 0 0 40px rgba(0, 240, 255, 0.1); }
  50% { transform: scale(1.05); box-shadow: 0 0 80px rgba(0, 240, 255, 0.3), 0 0 160px rgba(0, 240, 255, 0.15), inset 0 0 60px rgba(0, 240, 255, 0.15); }
}

.core-metric-main {
  font-family: var(--font-display);
  font-size: 24px;
  font-weight: 800;
  color: var(--cyan);
  text-shadow: 0 0 20px var(--cyan-dim);
}

.core-metric-label {
  font-family: var(--font-display);
  font-size: 7px;
  font-weight: 600;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--white-muted);
  margin-top: 2px;
}

.core-metric-sub {
  font-family: var(--font-mono);
  font-size: 10px;
  color: var(--white-dim);
  margin-top: 8px;
}

/* Radar Rings */
.radar-ring {
  position: absolute;
  border-radius: 50%;
  border: 1px solid;
  animation: radarExpand 4s ease-out infinite;
  pointer-events: none;
}

.radar-ring:nth-child(1) { width: 140px; height: 140px; border-color: rgba(0, 240, 255, 0.15); animation-delay: 0s; }
.radar-ring:nth-child(2) { width: 140px; height: 140px; border-color: rgba(0, 240, 255, 0.12); animation-delay: 1s; }
.radar-ring:nth-child(3) { width: 140px; height: 140px; border-color: rgba(0, 240, 255, 0.09); animation-delay: 2s; }
.radar-ring:nth-child(4) { width: 140px; height: 140px; border-color: rgba(0, 240, 255, 0.06); animation-delay: 3s; }

@keyframes radarExpand {
  0% { transform: scale(1); opacity: 0.8; }
  100% { transform: scale(4.5); opacity: 0; }
}

/* Orbit Rings (static paths) */
.orbit-path {
  position: absolute;
  border-radius: 50%;
  border: 1px dashed rgba(255, 255, 255, 0.04);
  pointer-events: none;
}

.orbit-path-1 { width: 300px; height: 260px; transform: rotate(-5deg); }
.orbit-path-2 { width: 400px; height: 340px; transform: rotate(8deg); }
.orbit-path-3 { width: 500px; height: 420px; transform: rotate(-3deg); }
.orbit-path-4 { width: 580px; height: 500px; transform: rotate(12deg); }
.orbit-path-5 { width: 660px; height: 560px; transform: rotate(-8deg); }

/* Agent Nodes */
.agent-node-container {
  position: absolute;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

.agent-node {
  position: absolute;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  pointer-events: all;
  transition: transform 0.2s ease;
  z-index: 10;
}

.agent-node:hover {
  transform: scale(1.2);
  z-index: 20;
}

.agent-node-inner {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--font-display);
  font-size: 10px;
  font-weight: 700;
  letter-spacing: 1px;
  position: relative;
}

.agent-node-ring {
  position: absolute;
  inset: -6px;
  border-radius: 50%;
  border: 2px solid;
  opacity: 0.4;
  animation: nodeRingPulse 3s ease-in-out infinite;
}

@keyframes nodeRingPulse {
  0%, 100% { transform: scale(1); opacity: 0.4; }
  50% { transform: scale(1.15); opacity: 0.2; }
}

.agent-node.active .agent-node-inner {
  background: radial-gradient(circle, rgba(0, 240, 255, 0.3) 0%, rgba(0, 240, 255, 0.1) 70%);
  color: var(--cyan);
  box-shadow: 0 0 20px var(--cyan-dim), 0 0 40px rgba(0, 240, 255, 0.1);
}
.agent-node.active .agent-node-ring { border-color: var(--cyan); }

.agent-node.planning .agent-node-inner {
  background: radial-gradient(circle, rgba(255, 149, 0, 0.3) 0%, rgba(255, 149, 0, 0.1) 70%);
  color: var(--amber);
  box-shadow: 0 0 20px var(--amber-dim), 0 0 40px rgba(255, 149, 0, 0.1);
}
.agent-node.planning .agent-node-ring { border-color: var(--amber); }

.agent-node.waiting .agent-node-inner {
  background: radial-gradient(circle, rgba(139, 92, 246, 0.3) 0%, rgba(139, 92, 246, 0.1) 70%);
  color: var(--violet);
  box-shadow: 0 0 20px var(--violet-dim), 0 0 40px rgba(139, 92, 246, 0.1);
}
.agent-node.waiting .agent-node-ring { border-color: var(--violet); }

.agent-node.idle .agent-node-inner {
  background: radial-gradient(circle, rgba(232, 234, 237, 0.1) 0%, rgba(232, 234, 237, 0.03) 70%);
  color: var(--white-muted);
  box-shadow: 0 0 10px rgba(232, 234, 237, 0.05);
}
.agent-node.idle .agent-node-ring { border-color: var(--white-muted); opacity: 0.2; }

/* Agent Tooltip */
.agent-tooltip {
  position: absolute;
  width: 240px;
  background: var(--glass-bg);
  backdrop-filter: blur(24px);
  border: 1px solid var(--glass-border);
  border-radius: 14px;
  padding: 16px;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.25s ease, transform 0.25s ease;
  transform: translateY(8px);
  z-index: 100;
  box-shadow: 0 16px 48px rgba(0, 0, 0, 0.5);
}

.agent-node:hover .agent-tooltip {
  opacity: 1;
  transform: translateY(0);
  pointer-events: all;
}

.tooltip-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 12px;
}

.tooltip-status-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
}

.tooltip-name {
  font-family: var(--font-display);
  font-size: 13px;
  font-weight: 700;
  letter-spacing: 1px;
}

.tooltip-state {
  font-family: var(--font-display);
  font-size: 8px;
  font-weight: 600;
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-left: auto;
  opacity: 0.6;
}

.tooltip-task {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--white-dim);
  margin-bottom: 12px;
  line-height: 1.5;
}

.tooltip-meta {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
}

.tooltip-meta-item {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.tooltip-meta-label {
  font-family: var(--font-display);
  font-size: 7px;
  font-weight: 600;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--white-muted);
}

.tooltip-meta-value {
  font-family: var(--font-mono);
  font-size: 12px;
  font-weight: 500;
}

.tooltip-progress-bar {
  margin-top: 12px;
  height: 3px;
  background: rgba(255, 255, 255, 0.06);
  border-radius: 2px;
  overflow: hidden;
}

.tooltip-progress-fill {
  height: 100%;
  border-radius: 2px;
  transition: width 0.5s ease;
}

/* Neural Pathways (SVG connections) */
#neuralPathways {
  position: absolute;
  inset: 0;
  z-index: 3;
  pointer-events: none;
}

/* ============================================================
   CODE STREAM PANEL (RIGHT)
   ============================================================ */
.code-stream {
  grid-area: codestream;
  background: linear-gradient(270deg, rgba(13, 13, 21, 0.95) 0%, rgba(13, 13, 21, 0.7) 100%);
  border-left: 1px solid var(--glass-border);
  display: flex;
  flex-direction: column;
  z-index: 10;
  overflow: hidden;
}

.code-stream-header {
  padding: 16px 20px 12px;
  display: flex;
  align-items: center;
  gap: 10px;
  border-bottom: 1px solid var(--glass-border);
  flex-shrink: 0;
}

.code-stream-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--green);
  box-shadow: 0 0 8px rgba(0, 230, 118, 0.4);
  animation: liveDot 2s ease-in-out infinite;
}

@keyframes liveDot {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.4; }
}

.code-stream-title {
  font-family: var(--font-display);
  font-size: 9px;
  font-weight: 700;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--white-dim);
}

.code-stream-body {
  flex: 1;
  overflow-y: auto;
  padding: 12px 0;
  scroll-behavior: smooth;
}

.code-stream-body::-webkit-scrollbar { width: 4px; }
.code-stream-body::-webkit-scrollbar-track { background: transparent; }
.code-stream-body::-webkit-scrollbar-thumb { background: var(--glass-border); border-radius: 2px; }

.code-entry {
  padding: 10px 20px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.02);
  animation: codeEntryIn 0.4s ease-out;
}

@keyframes codeEntryIn {
  0% { opacity: 0; transform: translateX(20px); }
  100% { opacity: 1; transform: translateX(0); }
}

.code-entry-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 6px;
}

.code-entry-agent {
  font-family: var(--font-display);
  font-size: 9px;
  font-weight: 600;
  letter-spacing: 1px;
}

.code-entry-file {
  font-family: var(--font-mono);
  font-size: 10px;
  color: var(--white-muted);
  flex: 1;
  text-align: right;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.code-entry-time {
  font-family: var(--font-mono);
  font-size: 9px;
  color: var(--white-muted);
  opacity: 0.5;
}

.code-entry-content {
  font-family: var(--font-mono);
  font-size: 11px;
  line-height: 1.6;
  color: var(--white-dim);
  background: rgba(0, 0, 0, 0.3);
  border-radius: 6px;
  padding: 10px 12px;
  overflow: hidden;
  white-space: pre;
  tab-size: 2;
}

/* Syntax highlighting */
.syn-keyword { color: #c792ea; }
.syn-string { color: #c3e88d; }
.syn-type { color: #ffcb6b; }
.syn-func { color: #82aaff; }
.syn-comment { color: #546e7a; }
.syn-number { color: #f78c6c; }
.syn-operator { color: #89ddff; }
.syn-punctuation { color: #89ddff; }
.syn-variable { color: #f07178; }
.syn-tag { color: #f07178; }
.syn-attr { color: #ffcb6b; }

/* ============================================================
   TOOL HEATMAP (BOTTOM CENTER)
   ============================================================ */
.tool-heatmap {
  grid-area: heatmap;
  background: linear-gradient(0deg, rgba(13, 13, 21, 0.9) 0%, transparent 100%);
  border-top: 1px solid var(--glass-border);
  padding: 14px 24px 10px;
  display: flex;
  flex-direction: column;
  z-index: 10;
  overflow: hidden;
}

.heatmap-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
}

.heatmap-title {
  font-family: var(--font-display);
  font-size: 9px;
  font-weight: 700;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--white-muted);
}

.heatmap-grid {
  display: flex;
  gap: 8px;
  flex: 1;
  align-items: stretch;
}

.heatmap-tool {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
}

.heatmap-bar-container {
  flex: 1;
  width: 100%;
  background: rgba(255, 255, 255, 0.03);
  border-radius: 4px;
  position: relative;
  overflow: hidden;
  min-height: 40px;
  display: flex;
  align-items: flex-end;
}

.heatmap-bar {
  width: 100%;
  border-radius: 4px 4px 0 0;
  transition: height 0.6s ease, opacity 0.3s ease;
  position: relative;
}

.heatmap-bar.pulse {
  animation: barPulse 0.5s ease-out;
}

@keyframes barPulse {
  0% { filter: brightness(2); }
  100% { filter: brightness(1); }
}

.heatmap-tool-label {
  font-family: var(--font-display);
  font-size: 7px;
  font-weight: 600;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--white-muted);
  white-space: nowrap;
}

.heatmap-count {
  font-family: var(--font-mono);
  font-size: 11px;
  font-weight: 500;
  color: var(--white-dim);
}

.heatmap-spark {
  width: 100%;
  height: 16px;
}

.heatmap-spark svg {
  width: 100%;
  height: 16px;
}

/* ============================================================
   STATUS BAR (BOTTOM)
   ============================================================ */
.status-bar {
  grid-area: status;
  display: flex;
  align-items: center;
  padding: 0 20px;
  background: rgba(10, 10, 15, 0.95);
  border-top: 1px solid var(--glass-border);
  gap: 20px;
  z-index: 10;
}

.status-brand {
  font-family: var(--font-display);
  font-size: 9px;
  font-weight: 600;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--white-muted);
}

.status-brand span {
  color: var(--cyan);
}

.status-divider {
  width: 1px;
  height: 16px;
  background: var(--glass-border);
}

.status-live {
  display: flex;
  align-items: center;
  gap: 6px;
}

.status-live-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--green);
  box-shadow: 0 0 6px rgba(0, 230, 118, 0.4);
  animation: liveDot 2s ease-in-out infinite;
}

.status-live-text {
  font-family: var(--font-display);
  font-size: 9px;
  font-weight: 700;
  letter-spacing: 2px;
  color: var(--green);
}

.status-time {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--white-muted);
}

.status-spacer { flex: 1; }

.status-cost {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--white-dim);
}

.status-cost span {
  color: var(--amber);
  font-weight: 500;
}

/* ============================================================
   AGENT NAME LABELS (floating near orbit)
   ============================================================ */
.agent-label-float {
  position: absolute;
  font-family: var(--font-display);
  font-size: 8px;
  font-weight: 600;
  letter-spacing: 2px;
  text-transform: uppercase;
  pointer-events: none;
  z-index: 8;
  text-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
}

/* ============================================================
   RESPONSIVE
   ============================================================ */
@media (max-width: 1200px) {
  .observatory {
    grid-template-columns: 220px 1fr 280px;
  }
}

@media (max-width: 900px) {
  .observatory {
    grid-template-columns: 1fr;
    grid-template-rows: 50px 1fr 160px 120px 36px;
    grid-template-areas:
      "timeline"
      "core"
      "codestream"
      "heatmap"
      "status";
  }
  .metrics-panel { display: none; }
  .code-stream { border-left: none; border-top: 1px solid var(--glass-border); }
}
</style>
</head>
<body>

<canvas id="particleCanvas"></canvas>

<div class="observatory">

  <!-- SESSION TIMELINE -->
  <div class="session-timeline">
    <div class="timeline-label">Session</div>
    <div class="timeline-elapsed" id="timelineElapsed">00:00</div>
    <div class="timeline-track">
      <div class="timeline-rail">
        <div class="timeline-progress" id="timelineProgress" style="width: 0%">
          <div class="timeline-cursor"></div>
        </div>
        <div class="timeline-events" id="timelineEvents"></div>
      </div>
    </div>
    <div class="timeline-total">45:00</div>
  </div>

  <!-- METRICS PANEL -->
  <div class="metrics-panel">
    <div class="metrics-section-title">System Metrics</div>

    <div class="metric-card">
      <div class="metric-card-accent" style="background: var(--cyan);"></div>
      <div class="metric-label">Tokens Consumed</div>
      <div class="metric-value" style="color: var(--cyan);" id="metricTokens">0</div>
      <div class="metric-sub"><span id="metricTokensRate">0</span> tok/sec</div>
      <div class="metric-spark" id="sparkTokens"></div>
    </div>

    <div class="metric-card">
      <div class="metric-card-accent" style="background: var(--green);"></div>
      <div class="metric-label">Tasks Progress</div>
      <div class="metric-value" style="color: var(--green);" id="metricTasks">1 / 5</div>
      <div class="metric-sub">20% complete</div>
      <div class="metric-spark" id="sparkTasks"></div>
    </div>

    <div class="metric-card">
      <div class="metric-card-accent" style="background: var(--amber);"></div>
      <div class="metric-label">Avg Turn Time</div>
      <div class="metric-value" style="color: var(--amber);" id="metricTurnTime">2.4s</div>
      <div class="metric-sub">Last: <span id="metricLastTurn">1.8s</span></div>
      <div class="metric-spark" id="sparkTurn"></div>
    </div>

    <div class="metric-card">
      <div class="metric-card-accent" style="background: var(--red);"></div>
      <div class="metric-label">Error Rate</div>
      <div class="metric-value" style="color: var(--red);" id="metricErrors">0.8%</div>
      <div class="metric-sub"><span id="metricErrorCount">2</span> errors total</div>
      <div class="metric-spark" id="sparkErrors"></div>
    </div>

    <div class="metric-card">
      <div class="metric-card-accent" style="background: var(--violet);"></div>
      <div class="metric-label">Active Agents</div>
      <div class="metric-value" style="color: var(--violet);" id="metricAgents">3 / 5</div>
      <div class="metric-sub">2 idle</div>
    </div>
  </div>

  <!-- CENTRAL CORE AREA -->
  <div class="core-area" id="coreArea">
    <svg id="neuralPathways" width="100%" height="100%"></svg>

    <!-- Orbit paths -->
    <div class="orbit-path orbit-path-1"></div>
    <div class="orbit-path orbit-path-2"></div>
    <div class="orbit-path orbit-path-3"></div>
    <div class="orbit-path orbit-path-4"></div>
    <div class="orbit-path orbit-path-5"></div>

    <!-- Radar rings -->
    <div class="radar-ring"></div>
    <div class="radar-ring"></div>
    <div class="radar-ring"></div>
    <div class="radar-ring"></div>

    <!-- Neural Core -->
    <div class="neural-core">
      <div class="core-orb">
        <div class="core-metric-main" id="coreAgentCount">5</div>
        <div class="core-metric-label">Agents</div>
        <div class="core-metric-sub" id="coreTokenRate">1,247 tok/s</div>
      </div>
    </div>

    <!-- Agent Nodes (positioned by JS) -->
    <div class="agent-node-container" id="agentNodes"></div>
  </div>

  <!-- CODE STREAM PANEL -->
  <div class="code-stream">
    <div class="code-stream-header">
      <div class="code-stream-dot"></div>
      <div class="code-stream-title">Live Code Stream</div>
    </div>
    <div class="code-stream-body" id="codeStreamBody"></div>
  </div>

  <!-- TOOL HEATMAP -->
  <div class="tool-heatmap">
    <div class="heatmap-header">
      <div class="heatmap-title">Tool Activity</div>
    </div>
    <div class="heatmap-grid" id="heatmapGrid"></div>
  </div>

  <!-- STATUS BAR -->
  <div class="status-bar">
    <div class="status-brand">Agent<span>Pane</span> Neural Observatory</div>
    <div class="status-divider"></div>
    <div class="status-live">
      <div class="status-live-dot"></div>
      <div class="status-live-text">LIVE</div>
    </div>
    <div class="status-divider"></div>
    <div class="status-time" id="statusTime">--:--:--</div>
    <div class="status-spacer"></div>
    <div class="status-cost">Session Cost: <span id="statusCost">$0.00</span></div>
  </div>

</div>

<div class="scanline-overlay"></div>

<script>
// ============================================================
// DATA & CONFIGURATION
// ============================================================
const AGENTS = [
  { id: 'atlas', name: 'Atlas', state: 'active', task: 'Implement auth middleware', progress: 72, model: 'Claude Opus 4.5', color: 'var(--cyan)', colorRaw: '#00f0ff' },
  { id: 'nova', name: 'Nova', state: 'planning', task: 'Refactor database schema', progress: 15, model: 'Claude Opus 4.5', color: 'var(--amber)', colorRaw: '#ff9500' },
  { id: 'cipher', name: 'Cipher', state: 'active', task: 'Add unit tests for API', progress: 48, model: 'Claude Sonnet 4', color: 'var(--cyan)', colorRaw: '#00f0ff' },
  { id: 'echo', name: 'Echo', state: 'waiting', task: 'Fix CSS layout bugs', progress: 90, model: 'Claude Sonnet 4', color: 'var(--violet)', colorRaw: '#8b5cf6' },
  { id: 'pulse', name: 'Pulse', state: 'idle', task: 'Update documentation', progress: 0, model: 'Claude Haiku 3.5', color: 'var(--white-muted)', colorRaw: '#e8eaed' },
];

const TOOLS = [
  { name: 'Read', count: 0, color: '#00f0ff', history: [] },
  { name: 'Write', count: 0, color: '#c792ea', history: [] },
  { name: 'Edit', count: 0, color: '#82aaff', history: [] },
  { name: 'Bash', count: 0, color: '#c3e88d', history: [] },
  { name: 'Grep', count: 0, color: '#ffcb6b', history: [] },
  { name: 'Glob', count: 0, color: '#f78c6c', history: [] },
  { name: 'WebFetch', count: 0, color: '#ff9500', history: [] },
];

const CODE_SNIPPETS = [
  {
    agent: 'Atlas',
    file: 'src/middleware/auth.ts',
    lang: 'typescript',
    code: `<span class="syn-keyword">export</span> <span class="syn-keyword">const</span> <span class="syn-func">authMiddleware</span> <span class="syn-operator">=</span> <span class="syn-keyword">async</span> (<span class="syn-variable">c</span><span class="syn-punctuation">:</span> <span class="syn-type">Context</span>, <span class="syn-variable">next</span><span class="syn-punctuation">:</span> <span class="syn-type">Next</span>) <span class="syn-operator">=></span> <span class="syn-punctuation">{</span>
  <span class="syn-keyword">const</span> token <span class="syn-operator">=</span> c<span class="syn-punctuation">.</span>req<span class="syn-punctuation">.</span><span class="syn-func">header</span>(<span class="syn-string">'Authorization'</span>)<span class="syn-punctuation">;</span>
  <span class="syn-keyword">if</span> (<span class="syn-operator">!</span>token) <span class="syn-keyword">throw</span> <span class="syn-keyword">new</span> <span class="syn-type">AuthError</span>(<span class="syn-string">'Missing token'</span>)<span class="syn-punctuation">;</span>
  <span class="syn-keyword">const</span> user <span class="syn-operator">=</span> <span class="syn-keyword">await</span> <span class="syn-func">verifyJWT</span>(token)<span class="syn-punctuation">;</span>
  c<span class="syn-punctuation">.</span><span class="syn-func">set</span>(<span class="syn-string">'user'</span>, user)<span class="syn-punctuation">;</span>
  <span class="syn-keyword">await</span> <span class="syn-func">next</span>()<span class="syn-punctuation">;</span>
<span class="syn-punctuation">}</span><span class="syn-punctuation">;</span>`
  },
  {
    agent: 'Cipher',
    file: 'tests/api/tasks.test.ts',
    lang: 'typescript',
    code: `<span class="syn-func">describe</span>(<span class="syn-string">'Task API'</span>, () <span class="syn-operator">=></span> <span class="syn-punctuation">{</span>
  <span class="syn-func">it</span>(<span class="syn-string">'should create a task'</span>, <span class="syn-keyword">async</span> () <span class="syn-operator">=></span> <span class="syn-punctuation">{</span>
    <span class="syn-keyword">const</span> res <span class="syn-operator">=</span> <span class="syn-keyword">await</span> app<span class="syn-punctuation">.</span><span class="syn-func">request</span>(<span class="syn-string">'/api/tasks'</span>, <span class="syn-punctuation">{</span>
      method<span class="syn-punctuation">:</span> <span class="syn-string">'POST'</span>,
      body<span class="syn-punctuation">:</span> <span class="syn-type">JSON</span><span class="syn-punctuation">.</span><span class="syn-func">stringify</span>(<span class="syn-punctuation">{</span> title<span class="syn-punctuation">:</span> <span class="syn-string">'Test'</span> <span class="syn-punctuation">}</span>),
    <span class="syn-punctuation">}</span>)<span class="syn-punctuation">;</span>
    <span class="syn-func">expect</span>(res<span class="syn-punctuation">.</span>status)<span class="syn-punctuation">.</span><span class="syn-func">toBe</span>(<span class="syn-number">201</span>)<span class="syn-punctuation">;</span>
  <span class="syn-punctuation">}</span>)<span class="syn-punctuation">;</span>
<span class="syn-punctuation">}</span>)<span class="syn-punctuation">;</span>`
  },
  {
    agent: 'Nova',
    file: 'src/db/schema.ts',
    lang: 'typescript',
    code: `<span class="syn-keyword">export</span> <span class="syn-keyword">const</span> tasks <span class="syn-operator">=</span> <span class="syn-func">sqliteTable</span>(<span class="syn-string">'tasks'</span>, <span class="syn-punctuation">{</span>
  id<span class="syn-punctuation">:</span> <span class="syn-func">text</span>(<span class="syn-string">'id'</span>)<span class="syn-punctuation">.</span><span class="syn-func">primaryKey</span>(),
  title<span class="syn-punctuation">:</span> <span class="syn-func">text</span>(<span class="syn-string">'title'</span>)<span class="syn-punctuation">.</span><span class="syn-func">notNull</span>(),
  status<span class="syn-punctuation">:</span> <span class="syn-func">text</span>(<span class="syn-string">'status'</span>, <span class="syn-punctuation">{</span> enum<span class="syn-punctuation">:</span> taskStatuses <span class="syn-punctuation">}</span>),
  agentId<span class="syn-punctuation">:</span> <span class="syn-func">text</span>(<span class="syn-string">'agent_id'</span>)<span class="syn-punctuation">.</span><span class="syn-func">references</span>(() <span class="syn-operator">=></span> agents<span class="syn-punctuation">.</span>id),
  createdAt<span class="syn-punctuation">:</span> <span class="syn-func">integer</span>(<span class="syn-string">'created_at'</span>)<span class="syn-punctuation">.</span><span class="syn-func">default</span>(<span class="syn-func">sql</span><span class="syn-string">\`CURRENT_TIMESTAMP\`</span>),
<span class="syn-punctuation">}</span>)<span class="syn-punctuation">;</span>`
  },
  {
    agent: 'Atlas',
    file: 'src/middleware/rate-limit.ts',
    lang: 'typescript',
    code: `<span class="syn-keyword">const</span> <span class="syn-func">rateLimiter</span> <span class="syn-operator">=</span> <span class="syn-keyword">new</span> <span class="syn-type">Map</span><span class="syn-punctuation">&lt;</span><span class="syn-type">string</span>, <span class="syn-type">number</span>[]<span class="syn-punctuation">&gt;</span>();

<span class="syn-keyword">export</span> <span class="syn-keyword">function</span> <span class="syn-func">checkRateLimit</span>(
  <span class="syn-variable">ip</span><span class="syn-punctuation">:</span> <span class="syn-type">string</span>,
  <span class="syn-variable">maxReq</span> <span class="syn-operator">=</span> <span class="syn-number">100</span>,
  <span class="syn-variable">windowMs</span> <span class="syn-operator">=</span> <span class="syn-number">60_000</span>
)<span class="syn-punctuation">:</span> <span class="syn-type">boolean</span> <span class="syn-punctuation">{</span>
  <span class="syn-keyword">const</span> now <span class="syn-operator">=</span> <span class="syn-type">Date</span><span class="syn-punctuation">.</span><span class="syn-func">now</span>()<span class="syn-punctuation">;</span>
  <span class="syn-keyword">const</span> hits <span class="syn-operator">=</span> rateLimiter<span class="syn-punctuation">.</span><span class="syn-func">get</span>(ip) <span class="syn-operator">??</span> []<span class="syn-punctuation">;</span>
  <span class="syn-keyword">const</span> valid <span class="syn-operator">=</span> hits<span class="syn-punctuation">.</span><span class="syn-func">filter</span>(t <span class="syn-operator">=></span> now <span class="syn-operator">-</span> t <span class="syn-operator">&lt;</span> windowMs)<span class="syn-punctuation">;</span>
  <span class="syn-keyword">return</span> valid<span class="syn-punctuation">.</span>length <span class="syn-operator">&lt;</span> maxReq<span class="syn-punctuation">;</span>
<span class="syn-punctuation">}</span>`
  },
  {
    agent: 'Echo',
    file: 'src/app/components/task-card.tsx',
    lang: 'tsx',
    code: `<span class="syn-keyword">export</span> <span class="syn-keyword">function</span> <span class="syn-func">TaskCard</span>(<span class="syn-punctuation">{</span> task <span class="syn-punctuation">}</span><span class="syn-punctuation">:</span> <span class="syn-punctuation">{</span> task<span class="syn-punctuation">:</span> <span class="syn-type">Task</span> <span class="syn-punctuation">}</span>) <span class="syn-punctuation">{</span>
  <span class="syn-keyword">return</span> (
    <span class="syn-punctuation">&lt;</span><span class="syn-tag">div</span> <span class="syn-attr">className</span><span class="syn-operator">=</span><span class="syn-punctuation">{</span><span class="syn-func">cn</span>(<span class="syn-string">'rounded-xl p-4'</span>,
      task<span class="syn-punctuation">.</span>status <span class="syn-operator">===</span> <span class="syn-string">'active'</span> <span class="syn-operator">&&</span> <span class="syn-string">'border-cyan-500'</span>
    )<span class="syn-punctuation">}</span><span class="syn-punctuation">&gt;</span>
      <span class="syn-punctuation">&lt;</span><span class="syn-tag">h3</span><span class="syn-punctuation">&gt;</span><span class="syn-punctuation">{</span>task<span class="syn-punctuation">.</span>title<span class="syn-punctuation">}</span><span class="syn-punctuation">&lt;/</span><span class="syn-tag">h3</span><span class="syn-punctuation">&gt;</span>
      <span class="syn-punctuation">&lt;</span><span class="syn-tag">StatusBadge</span> <span class="syn-attr">status</span><span class="syn-operator">=</span><span class="syn-punctuation">{</span>task<span class="syn-punctuation">.</span>status<span class="syn-punctuation">}</span> <span class="syn-punctuation">/&gt;</span>
    <span class="syn-punctuation">&lt;/</span><span class="syn-tag">div</span><span class="syn-punctuation">&gt;</span>
  )<span class="syn-punctuation">;</span>
<span class="syn-punctuation">}</span>`
  },
  {
    agent: 'Cipher',
    file: 'tests/api/auth.test.ts',
    lang: 'typescript',
    code: `<span class="syn-func">it</span>(<span class="syn-string">'rejects expired tokens'</span>, <span class="syn-keyword">async</span> () <span class="syn-operator">=></span> <span class="syn-punctuation">{</span>
  <span class="syn-keyword">const</span> expired <span class="syn-operator">=</span> <span class="syn-func">createToken</span>(<span class="syn-punctuation">{</span>
    sub<span class="syn-punctuation">:</span> <span class="syn-string">'user_123'</span>,
    exp<span class="syn-punctuation">:</span> <span class="syn-type">Math</span><span class="syn-punctuation">.</span><span class="syn-func">floor</span>(<span class="syn-type">Date</span><span class="syn-punctuation">.</span><span class="syn-func">now</span>() <span class="syn-operator">/</span> <span class="syn-number">1000</span>) <span class="syn-operator">-</span> <span class="syn-number">3600</span>,
  <span class="syn-punctuation">}</span>)<span class="syn-punctuation">;</span>
  <span class="syn-keyword">const</span> res <span class="syn-operator">=</span> <span class="syn-keyword">await</span> <span class="syn-func">fetchWithAuth</span>(expired)<span class="syn-punctuation">;</span>
  <span class="syn-func">expect</span>(res<span class="syn-punctuation">.</span>status)<span class="syn-punctuation">.</span><span class="syn-func">toBe</span>(<span class="syn-number">401</span>)<span class="syn-punctuation">;</span>
  <span class="syn-func">expect</span>(res<span class="syn-punctuation">.</span>body<span class="syn-punctuation">.</span>code)<span class="syn-punctuation">.</span><span class="syn-func">toBe</span>(<span class="syn-string">'TOKEN_EXPIRED'</span>)<span class="syn-punctuation">;</span>
<span class="syn-punctuation">}</span>)<span class="syn-punctuation">;</span>`
  },
  {
    agent: 'Nova',
    file: 'src/db/migrations/002.ts',
    lang: 'typescript',
    code: `<span class="syn-keyword">export</span> <span class="syn-keyword">async</span> <span class="syn-keyword">function</span> <span class="syn-func">up</span>(<span class="syn-variable">db</span><span class="syn-punctuation">:</span> <span class="syn-type">Database</span>) <span class="syn-punctuation">{</span>
  <span class="syn-keyword">await</span> db<span class="syn-punctuation">.</span><span class="syn-func">exec</span>(<span class="syn-string">\`
    ALTER TABLE tasks
    ADD COLUMN priority INTEGER DEFAULT 0;
    CREATE INDEX idx_tasks_priority
    ON tasks(priority DESC);
  \`</span>)<span class="syn-punctuation">;</span>
<span class="syn-punctuation">}</span>`
  },
  {
    agent: 'Atlas',
    file: 'src/services/session.service.ts',
    lang: 'typescript',
    code: `<span class="syn-keyword">export</span> <span class="syn-keyword">class</span> <span class="syn-type">SessionService</span> <span class="syn-punctuation">{</span>
  <span class="syn-keyword">async</span> <span class="syn-func">publish</span>(<span class="syn-variable">sessionId</span><span class="syn-punctuation">:</span> <span class="syn-type">string</span>, <span class="syn-variable">event</span><span class="syn-punctuation">:</span> <span class="syn-type">SessionEvent</span>) <span class="syn-punctuation">{</span>
    <span class="syn-keyword">const</span> stream <span class="syn-operator">=</span> <span class="syn-keyword">this</span><span class="syn-punctuation">.</span>streams<span class="syn-punctuation">.</span><span class="syn-func">get</span>(sessionId)<span class="syn-punctuation">;</span>
    <span class="syn-keyword">if</span> (<span class="syn-operator">!</span>stream) <span class="syn-keyword">return</span><span class="syn-punctuation">;</span>
    <span class="syn-keyword">await</span> stream<span class="syn-punctuation">.</span><span class="syn-func">append</span>(<span class="syn-punctuation">{</span>
      type<span class="syn-punctuation">:</span> event<span class="syn-punctuation">.</span>type,
      data<span class="syn-punctuation">:</span> <span class="syn-type">JSON</span><span class="syn-punctuation">.</span><span class="syn-func">stringify</span>(event<span class="syn-punctuation">.</span>payload),
      ts<span class="syn-punctuation">:</span> <span class="syn-type">Date</span><span class="syn-punctuation">.</span><span class="syn-func">now</span>(),
    <span class="syn-punctuation">}</span>)<span class="syn-punctuation">;</span>
  <span class="syn-punctuation">}</span>
<span class="syn-punctuation">}</span>`
  },
];

// ============================================================
// PARTICLE SYSTEM
// ============================================================
const canvas = document.getElementById('particleCanvas');
const ctx = canvas.getContext('2d');
let particles = [];

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

function initParticles(count = 120) {
  particles = [];
  for (let i = 0; i < count; i++) {
    particles.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      vx: (Math.random() - 0.5) * 0.3,
      vy: (Math.random() - 0.5) * 0.3,
      radius: Math.random() * 1.5 + 0.3,
      opacity: Math.random() * 0.3 + 0.05,
      hue: Math.random() > 0.7 ? 185 : (Math.random() > 0.5 ? 30 : 260),
    });
  }
}
initParticles();

function drawParticles() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  for (const p of particles) {
    p.x += p.vx;
    p.y += p.vy;
    if (p.x < 0) p.x = canvas.width;
    if (p.x > canvas.width) p.x = 0;
    if (p.y < 0) p.y = canvas.height;
    if (p.y > canvas.height) p.y = 0;

    ctx.beginPath();
    ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
    ctx.fillStyle = `hsla(${p.hue}, 80%, 60%, ${p.opacity})`;
    ctx.fill();
  }
  requestAnimationFrame(drawParticles);
}
drawParticles();

// ============================================================
// SPARKLINE GENERATOR
// ============================================================
function createSparkSVG(containerId, color, data) {
  const el = document.getElementById(containerId);
  if (!el) return;
  const w = 220, h = 24;
  const max = Math.max(...data, 1);
  const pts = data.map((v, i) => {
    const x = (i / (data.length - 1)) * w;
    const y = h - (v / max) * h;
    return `${x},${y}`;
  });
  const linePts = pts.join(' ');
  const areaPts = `0,${h} ${linePts} ${w},${h}`;
  el.innerHTML = `<svg viewBox="0 0 ${w} ${h}" preserveAspectRatio="none">
    <polygon class="spark-area" points="${areaPts}" fill="${color}" />
    <polyline class="spark-line" points="${linePts}" stroke="${color}" />
  </svg>`;
}

// ============================================================
// AGENT ORBITAL SYSTEM
// ============================================================
const agentOrbits = [
  { rx: 150, ry: 130, speed: 0.008, offset: 0, tilt: -5 },
  { rx: 200, ry: 170, speed: 0.006, offset: Math.PI * 0.6, tilt: 8 },
  { rx: 250, ry: 210, speed: 0.005, offset: Math.PI * 1.2, tilt: -3 },
  { rx: 290, ry: 250, speed: 0.004, offset: Math.PI * 0.3, tilt: 12 },
  { rx: 330, ry: 280, speed: 0.003, offset: Math.PI * 1.6, tilt: -8 },
];

let agentAngles = agentOrbits.map(o => o.offset);
let agentNodeEls = [];
let neuralSvg = document.getElementById('neuralPathways');
let coreAreaEl = document.getElementById('coreArea');

function buildAgentNodes() {
  const container = document.getElementById('agentNodes');
  container.innerHTML = '';
  AGENTS.forEach((agent, i) => {
    const node = document.createElement('div');
    node.className = `agent-node ${agent.state}`;
    node.id = `agent-${agent.id}`;
    node.innerHTML = `
      <div class="agent-node-inner">${agent.name[0]}</div>
      <div class="agent-node-ring"></div>
      <div class="agent-tooltip" style="left: 56px; top: -20px;">
        <div class="tooltip-header">
          <div class="tooltip-status-dot" style="background: ${agent.color}; box-shadow: 0 0 8px ${agent.colorRaw}44;"></div>
          <div class="tooltip-name" style="color: ${agent.color};">${agent.name}</div>
          <div class="tooltip-state">${agent.state}</div>
        </div>
        <div class="tooltip-task">${agent.task}</div>
        <div class="tooltip-meta">
          <div class="tooltip-meta-item">
            <div class="tooltip-meta-label">Model</div>
            <div class="tooltip-meta-value" style="font-size: 10px;">${agent.model}</div>
          </div>
          <div class="tooltip-meta-item">
            <div class="tooltip-meta-label">Progress</div>
            <div class="tooltip-meta-value" style="color: ${agent.color};">${agent.progress}%</div>
          </div>
        </div>
        <div class="tooltip-progress-bar">
          <div class="tooltip-progress-fill" style="width: ${agent.progress}%; background: ${agent.color};"></div>
        </div>
      </div>
    `;
    container.appendChild(node);
    agentNodeEls.push(node);
  });
}
buildAgentNodes();

function animateOrbits() {
  const rect = coreAreaEl.getBoundingClientRect();
  const cx = rect.width / 2;
  const cy = rect.height / 2;

  // Update neural pathways SVG
  let pathsHTML = '';
  const dashAnim = Date.now() * 0.02;

  AGENTS.forEach((agent, i) => {
    agentAngles[i] += agentOrbits[i].speed;
    const orbit = agentOrbits[i];
    const angle = agentAngles[i];
    const tiltRad = (orbit.tilt * Math.PI) / 180;

    const rawX = orbit.rx * Math.cos(angle);
    const rawY = orbit.ry * Math.sin(angle);
    const x = cx + rawX * Math.cos(tiltRad) - rawY * Math.sin(tiltRad);
    const y = cy + rawX * Math.sin(tiltRad) + rawY * Math.cos(tiltRad);

    // Position node
    const node = agentNodeEls[i];
    node.style.left = `${x - 24}px`;
    node.style.top = `${y - 24}px`;

    // Draw neural pathway
    const midX = (cx + x) / 2 + Math.sin(angle * 2) * 20;
    const midY = (cy + y) / 2 + Math.cos(angle * 3) * 15;
    const opacity = agent.state === 'idle' ? 0.05 : 0.15;
    pathsHTML += `<path d="M${cx},${cy} Q${midX},${midY} ${x},${y}"
      fill="none" stroke="${agent.colorRaw}" stroke-width="1"
      stroke-dasharray="4 8" stroke-dashoffset="${-dashAnim % 100}"
      opacity="${opacity}" />`;

    // Animated dot along path
    if (agent.state !== 'idle') {
      const t = ((Date.now() * 0.001 + i) % 2) / 2;
      const dotX = (1-t)*(1-t)*cx + 2*(1-t)*t*midX + t*t*x;
      const dotY = (1-t)*(1-t)*cy + 2*(1-t)*t*midY + t*t*y;
      pathsHTML += `<circle cx="${dotX}" cy="${dotY}" r="2" fill="${agent.colorRaw}" opacity="0.6">
        <animate attributeName="opacity" values="0.6;1;0.6" dur="1s" repeatCount="indefinite" />
      </circle>`;
    }
  });

  neuralSvg.innerHTML = pathsHTML;
  requestAnimationFrame(animateOrbits);
}
animateOrbits();

// ============================================================
// TOOL HEATMAP
// ============================================================
function buildHeatmap() {
  const grid = document.getElementById('heatmapGrid');
  grid.innerHTML = '';
  TOOLS.forEach((tool, i) => {
    // Initialize history
    tool.history = Array.from({ length: 20 }, () => Math.floor(Math.random() * 5));
    tool.count = tool.history.reduce((a, b) => a + b, 0);
    const el = document.createElement('div');
    el.className = 'heatmap-tool';
    el.id = `tool-${i}`;
    el.innerHTML = `
      <div class="heatmap-count" id="toolCount-${i}">${tool.count}</div>
      <div class="heatmap-bar-container">
        <div class="heatmap-bar" id="toolBar-${i}" style="height: 30%; background: ${tool.color}; opacity: 0.7;"></div>
      </div>
      <div class="heatmap-spark" id="toolSpark-${i}"></div>
      <div class="heatmap-tool-label">${tool.name}</div>
    `;
    grid.appendChild(el);
    updateToolSpark(i);
  });
}

function updateToolSpark(i) {
  const tool = TOOLS[i];
  const el = document.getElementById(`toolSpark-${i}`);
  if (!el) return;
  const w = 80, h = 16;
  const max = Math.max(...tool.history, 1);
  const pts = tool.history.map((v, idx) => {
    const x = (idx / (tool.history.length - 1)) * w;
    const y = h - (v / max) * (h - 2) - 1;
    return `${x},${y}`;
  }).join(' ');
  el.innerHTML = `<svg viewBox="0 0 ${w} ${h}" preserveAspectRatio="none">
    <polyline points="${pts}" fill="none" stroke="${tool.color}" stroke-width="1" opacity="0.5" />
  </svg>`;
}

buildHeatmap();

// ============================================================
// CODE STREAM
// ============================================================
let codeStreamIndex = 0;
const codeStreamBody = document.getElementById('codeStreamBody');

function addCodeEntry() {
  const snippet = CODE_SNIPPETS[codeStreamIndex % CODE_SNIPPETS.length];
  codeStreamIndex++;
  const now = new Date();
  const time = now.toLocaleTimeString('en-US', { hour12: false });
  const agentData = AGENTS.find(a => a.name === snippet.agent) || AGENTS[0];

  const entry = document.createElement('div');
  entry.className = 'code-entry';
  entry.innerHTML = `
    <div class="code-entry-header">
      <div class="code-entry-agent" style="color: ${agentData.color};">${snippet.agent}</div>
      <div class="code-entry-file">${snippet.file}</div>
    </div>
    <div class="code-entry-time">${time}</div>
    <div class="code-entry-content">${snippet.code}</div>
  `;
  codeStreamBody.appendChild(entry);

  // Keep max 20 entries
  while (codeStreamBody.children.length > 20) {
    codeStreamBody.removeChild(codeStreamBody.firstChild);
  }

  codeStreamBody.scrollTop = codeStreamBody.scrollHeight;
}

// Add initial entries
addCodeEntry();
setTimeout(() => addCodeEntry(), 500);

// ============================================================
// TIMELINE EVENTS
// ============================================================
const timelineEventsEl = document.getElementById('timelineEvents');
let timelineEventPositions = [];

function addTimelineEvent(type, position) {
  const dot = document.createElement('div');
  dot.className = `timeline-event ${type}`;
  dot.style.left = `${position}%`;
  timelineEventsEl.appendChild(dot);
  timelineEventPositions.push({ type, position });
}

// Seed some events
[5, 12, 18, 25, 30].forEach(p => addTimelineEvent('tool', p));
[22, 35].forEach(p => addTimelineEvent('completion', p));
[15].forEach(p => addTimelineEvent('error', p));
[8, 28].forEach(p => addTimelineEvent('planning', p));

// ============================================================
// SIMULATION ENGINE
// ============================================================
let sessionStartTime = Date.now();
let totalTokens = 84320;
let tokenRate = 1247;
let costEstimate = 2.47;
let tasksCompleted = 1;
let turnTimeAvg = 2.4;
let errorCount = 2;
let totalTurns = 47;

// Spark data
let sparkTokensData = Array.from({ length: 30 }, () => Math.floor(Math.random() * 500 + 800));
let sparkTasksData = Array.from({ length: 30 }, () => Math.floor(Math.random() * 2));
let sparkTurnData = Array.from({ length: 30 }, () => Math.random() * 2 + 1.5);
let sparkErrorData = Array.from({ length: 30 }, () => Math.random() > 0.85 ? 1 : 0);

function formatNumber(n) {
  if (n >= 1000000) return (n / 1000000).toFixed(1) + 'M';
  if (n >= 1000) return (n / 1000).toFixed(1) + 'K';
  return n.toString();
}

function updateMetrics() {
  // Tokens
  totalTokens += Math.floor(Math.random() * 200 + 80);
  tokenRate = Math.floor(Math.random() * 400 + 1000);
  document.getElementById('metricTokens').textContent = formatNumber(totalTokens);
  document.getElementById('metricTokensRate').textContent = tokenRate.toLocaleString();
  document.getElementById('coreTokenRate').textContent = tokenRate.toLocaleString() + ' tok/s';

  sparkTokensData.push(tokenRate);
  sparkTokensData.shift();
  createSparkSVG('sparkTokens', '#00f0ff', sparkTokensData);

  // Turn time
  const lastTurn = (Math.random() * 2 + 1.2).toFixed(1);
  turnTimeAvg = ((turnTimeAvg * totalTurns + parseFloat(lastTurn)) / (totalTurns + 1)).toFixed(1);
  totalTurns++;
  document.getElementById('metricTurnTime').textContent = turnTimeAvg + 's';
  document.getElementById('metricLastTurn').textContent = lastTurn + 's';

  sparkTurnData.push(parseFloat(lastTurn));
  sparkTurnData.shift();
  createSparkSVG('sparkTurn', '#ff9500', sparkTurnData);

  // Errors
  if (Math.random() > 0.95) {
    errorCount++;
    document.getElementById('metricErrorCount').textContent = errorCount;
    sparkErrorData.push(1);
  } else {
    sparkErrorData.push(0);
  }
  sparkErrorData.shift();
  const errRate = ((errorCount / totalTurns) * 100).toFixed(1);
  document.getElementById('metricErrors').textContent = errRate + '%';
  createSparkSVG('sparkErrors', '#ff3b5c', sparkErrorData);

  // Cost
  costEstimate += Math.random() * 0.02 + 0.005;
  document.getElementById('statusCost').textContent = '$' + costEstimate.toFixed(2);

  // Tasks (occasionally complete)
  if (Math.random() > 0.98 && tasksCompleted < 5) {
    tasksCompleted++;
    document.getElementById('metricTasks').textContent = `${tasksCompleted} / 5`;
    sparkTasksData.push(1);
  } else {
    sparkTasksData.push(0);
  }
  sparkTasksData.shift();
  createSparkSVG('sparkTasks', '#00e676', sparkTasksData);

  // Agent progress
  AGENTS.forEach((agent, i) => {
    if (agent.state === 'active') {
      agent.progress = Math.min(100, agent.progress + Math.random() * 2);
    } else if (agent.state === 'planning') {
      agent.progress = Math.min(100, agent.progress + Math.random() * 1);
    }
    const fill = document.querySelector(`#agent-${agent.id} .tooltip-progress-fill`);
    if (fill) fill.style.width = `${agent.progress}%`;
    const val = document.querySelector(`#agent-${agent.id} .tooltip-meta-value:last-of-type`);
  });
}

// Tool activity simulation
function simulateToolUse() {
  const toolIndex = Math.floor(Math.random() * TOOLS.length);
  const tool = TOOLS[toolIndex];
  tool.count++;
  tool.history.push(Math.floor(Math.random() * 3 + 1));
  tool.history.shift();

  document.getElementById(`toolCount-${toolIndex}`).textContent = tool.count;

  const maxCount = Math.max(...TOOLS.map(t => t.count), 1);
  TOOLS.forEach((t, i) => {
    const pct = (t.count / maxCount) * 80 + 10;
    const bar = document.getElementById(`toolBar-${i}`);
    bar.style.height = `${pct}%`;
    if (i === toolIndex) {
      bar.classList.add('pulse');
      setTimeout(() => bar.classList.remove('pulse'), 500);
    }
  });

  updateToolSpark(toolIndex);
}

// Timeline progression
function updateTimeline() {
  const elapsed = Date.now() - sessionStartTime;
  const totalMs = 45 * 60 * 1000;
  const pct = Math.min((elapsed / totalMs) * 100, 100);
  document.getElementById('timelineProgress').style.width = `${pct}%`;

  const mins = Math.floor(elapsed / 60000);
  const secs = Math.floor((elapsed % 60000) / 1000);
  document.getElementById('timelineElapsed').textContent =
    `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;

  // Random events
  if (Math.random() > 0.92) {
    const types = ['tool', 'tool', 'tool', 'completion', 'planning', 'error'];
    const type = types[Math.floor(Math.random() * types.length)];
    addTimelineEvent(type, pct);
  }
}

// Clock
function updateClock() {
  const now = new Date();
  document.getElementById('statusTime').textContent =
    now.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
}

// Occasionally change agent states
function cycleAgentStates() {
  const states = ['active', 'planning', 'waiting', 'idle'];
  const i = Math.floor(Math.random() * AGENTS.length);
  const agent = AGENTS[i];
  const currentIdx = states.indexOf(agent.state);
  const newState = states[(currentIdx + 1) % states.length];

  agent.state = newState;
  const colors = { active: { css: 'var(--cyan)', raw: '#00f0ff' }, planning: { css: 'var(--amber)', raw: '#ff9500' }, waiting: { css: 'var(--violet)', raw: '#8b5cf6' }, idle: { css: 'var(--white-muted)', raw: '#e8eaed' } };
  agent.color = colors[newState].css;
  agent.colorRaw = colors[newState].raw;

  const node = document.getElementById(`agent-${agent.id}`);
  node.className = `agent-node ${newState}`;

  // Update tooltip
  const dot = node.querySelector('.tooltip-status-dot');
  dot.style.background = agent.color;
  dot.style.boxShadow = `0 0 8px ${agent.colorRaw}44`;
  const nameEl = node.querySelector('.tooltip-name');
  nameEl.style.color = agent.color;
  const stateEl = node.querySelector('.tooltip-state');
  stateEl.textContent = newState;
  const progressFill = node.querySelector('.tooltip-progress-fill');
  progressFill.style.background = agent.color;

  // Count active
  const activeCount = AGENTS.filter(a => a.state !== 'idle').length;
  const idleCount = 5 - activeCount;
  document.getElementById('metricAgents').textContent = `${activeCount} / 5`;
}

// ============================================================
// INTERVALS
// ============================================================
setInterval(updateMetrics, 2000);
setInterval(simulateToolUse, 1500);
setInterval(updateTimeline, 1000);
setInterval(updateClock, 1000);
setInterval(addCodeEntry, 4000);
setInterval(cycleAgentStates, 8000);

// Initial
updateClock();
updateMetrics();
createSparkSVG('sparkTokens', '#00f0ff', sparkTokensData);
createSparkSVG('sparkTasks', '#00e676', sparkTasksData);
createSparkSVG('sparkTurn', '#ff9500', sparkTurnData);
createSparkSVG('sparkErrors', '#ff3b5c', sparkErrorData);
</script>
</body>
</html>
