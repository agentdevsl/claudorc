<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AgentPane Celestial Observatory — Chart of Active Intelligences</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=EB+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=JetBrains+Mono:ital,wght@0,300;0,400;0,500;1,300;1,400&display=swap" rel="stylesheet">
<style>
/* ============================================================
   CELESTIAL CARTOGRAPHY — Design 5 of 5
   AgentPane AI Agent Live Stream Monitor
   An 18th century celestial atlas brought to life
   ============================================================ */

*, *::before, *::after {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

:root {
  --midnight: #0b0e17;
  --midnight-deep: #060810;
  --celestial-gold: #c9a84c;
  --gold-bright: #e0c872;
  --gold-dim: #8a7234;
  --gold-faint: rgba(201, 168, 76, 0.15);
  --gold-glow: rgba(201, 168, 76, 0.4);
  --star-white: #f0ece2;
  --star-bright: #fffef5;
  --nebula-purple: #4a2070;
  --nebula-faint: rgba(74, 32, 112, 0.3);
  --comet-blue: #4169E1;
  --comet-glow: rgba(65, 105, 225, 0.4);
  --parchment: #faf3e0;
  --parchment-dark: #e8dcc4;
  --parchment-aged: #d4c5a0;
  --ink-dark: #2a1f0e;
  --ink-medium: #4a3a20;
  --ink-light: #6a5a3a;
  --error-red: #c04040;
  --success-green: #5a9a5a;

  --font-display: 'Cormorant Garamond', serif;
  --font-body: 'EB Garamond', serif;
  --font-mono: 'JetBrains Mono', monospace;
}

html, body {
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: var(--midnight-deep);
  color: var(--star-white);
  font-family: var(--font-body);
}

/* ============================================================
   ORNATE FRAME & BORDER
   ============================================================ */
.frame-outer {
  position: fixed;
  inset: 0;
  border: 3px solid var(--celestial-gold);
  pointer-events: none;
  z-index: 1000;
}

.frame-inner {
  position: fixed;
  inset: 6px;
  border: 1px solid var(--gold-dim);
  pointer-events: none;
  z-index: 1000;
}

.frame-corner {
  position: fixed;
  width: 60px;
  height: 60px;
  z-index: 1001;
  pointer-events: none;
}

.frame-corner svg {
  width: 100%;
  height: 100%;
}

.frame-corner.top-left { top: 0; left: 0; }
.frame-corner.top-right { top: 0; right: 0; transform: scaleX(-1); }
.frame-corner.bottom-left { bottom: 0; left: 0; transform: scaleY(-1); }
.frame-corner.bottom-right { bottom: 0; right: 0; transform: scale(-1, -1); }

/* ============================================================
   TITLE CARTOUCHE
   ============================================================ */
.cartouche {
  position: fixed;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 100;
  text-align: center;
  padding: 6px 40px;
  background: linear-gradient(180deg, rgba(11, 14, 23, 0.95), rgba(11, 14, 23, 0.85));
  border: 1px solid var(--celestial-gold);
  border-top: 2px solid var(--gold-bright);
  border-bottom: 2px solid var(--gold-bright);
}

.cartouche::before,
.cartouche::after {
  content: '✦';
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  color: var(--celestial-gold);
  font-size: 14px;
}

.cartouche::before { left: 12px; }
.cartouche::after { right: 12px; }

.cartouche-title {
  font-family: var(--font-display);
  font-weight: 400;
  font-size: 15px;
  letter-spacing: 4px;
  text-transform: uppercase;
  color: var(--celestial-gold);
  font-variant: small-caps;
}

.cartouche-subtitle {
  font-family: var(--font-display);
  font-style: italic;
  font-size: 11px;
  color: var(--gold-dim);
  letter-spacing: 2px;
  margin-top: 1px;
}

/* ============================================================
   MAIN LAYOUT
   ============================================================ */
.observatory {
  display: grid;
  grid-template-columns: 280px 1fr 280px;
  grid-template-rows: 44px 1fr 200px;
  gap: 0;
  width: 100%;
  height: 100%;
  padding: 12px;
}

/* ============================================================
   CELESTIAL METRICS — TOP BANNER
   ============================================================ */
.metrics-banner {
  grid-column: 1 / -1;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0;
  padding: 4px 80px;
  background: linear-gradient(180deg, rgba(201, 168, 76, 0.08), transparent);
  border-bottom: 1px solid var(--gold-faint);
}

.metric-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 0 20px;
  border-right: 1px solid var(--gold-faint);
  white-space: nowrap;
}

.metric-item:last-child {
  border-right: none;
}

.metric-star {
  color: var(--celestial-gold);
  font-size: 8px;
  opacity: 0.6;
}

.metric-label {
  font-family: var(--font-display);
  font-style: italic;
  font-size: 11px;
  color: var(--gold-dim);
  letter-spacing: 1px;
}

.metric-value {
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--celestial-gold);
  font-weight: 500;
}

.metric-value.status-active {
  color: var(--gold-bright);
  text-shadow: 0 0 8px var(--gold-glow);
}

/* ============================================================
   STAR CATALOG — LEFT PANEL
   ============================================================ */
.star-catalog {
  grid-column: 1;
  grid-row: 2;
  background: linear-gradient(135deg, var(--parchment) 0%, var(--parchment-dark) 60%, var(--parchment-aged) 100%);
  border: 1px solid var(--celestial-gold);
  border-radius: 2px;
  overflow-y: auto;
  position: relative;
  margin: 8px 0;
}

/* Parchment aging texture */
.star-catalog::before {
  content: '';
  position: absolute;
  inset: 0;
  background:
    radial-gradient(ellipse at 20% 80%, rgba(180, 160, 120, 0.3), transparent 60%),
    radial-gradient(ellipse at 80% 20%, rgba(160, 140, 100, 0.2), transparent 50%),
    radial-gradient(ellipse at 50% 50%, rgba(140, 120, 80, 0.1), transparent 70%);
  pointer-events: none;
  z-index: 1;
}

/* Decorative inner border */
.star-catalog::after {
  content: '';
  position: absolute;
  inset: 6px;
  border: 1px solid var(--ink-light);
  border-radius: 1px;
  pointer-events: none;
  z-index: 1;
  opacity: 0.3;
}

.catalog-content {
  position: relative;
  padding: 16px 14px;
  z-index: 2;
}

.catalog-header {
  text-align: center;
  margin-bottom: 14px;
  padding-bottom: 10px;
  border-bottom: 1px solid var(--ink-light);
}

.catalog-title {
  font-family: var(--font-display);
  font-weight: 600;
  font-size: 16px;
  letter-spacing: 4px;
  color: var(--ink-dark);
  font-variant: small-caps;
  text-transform: uppercase;
}

.catalog-subtitle {
  font-family: var(--font-display);
  font-style: italic;
  font-size: 11px;
  color: var(--ink-medium);
  margin-top: 2px;
}

.star-entry {
  padding: 10px 0;
  border-bottom: 1px dotted var(--parchment-aged);
}

.star-entry:last-child {
  border-bottom: none;
}

.star-name {
  font-family: var(--font-display);
  font-weight: 600;
  font-size: 14px;
  color: var(--ink-dark);
  margin-bottom: 4px;
}

.star-name .designation {
  font-style: italic;
  font-weight: 400;
  color: var(--ink-medium);
  font-size: 12px;
}

.star-symbol {
  color: var(--celestial-gold);
  font-size: 16px;
  margin-right: 3px;
  text-shadow: 0 0 4px var(--gold-glow);
}

.star-detail {
  font-family: var(--font-body);
  font-size: 11.5px;
  color: var(--ink-medium);
  line-height: 1.6;
  padding-left: 8px;
}

.star-detail em {
  font-style: italic;
  color: var(--ink-dark);
}

.star-detail .detail-label {
  font-family: var(--font-display);
  font-variant: small-caps;
  letter-spacing: 1px;
  color: var(--ink-light);
  font-size: 10px;
}

.star-detail .detail-value {
  font-family: var(--font-mono);
  font-size: 10px;
  color: var(--ink-dark);
}

.star-magnitude-bar {
  display: flex;
  align-items: center;
  gap: 4px;
  margin-top: 4px;
  padding-left: 8px;
}

.magnitude-pip {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--gold-dim);
  opacity: 0.3;
}

.magnitude-pip.active {
  background: var(--celestial-gold);
  opacity: 1;
  box-shadow: 0 0 4px var(--gold-glow);
}

.star-mini-constellation {
  display: inline-block;
  width: 30px;
  height: 20px;
  vertical-align: middle;
  margin-left: 6px;
}

/* ============================================================
   CELESTIAL CHART — CENTER
   ============================================================ */
.celestial-chart {
  grid-column: 2;
  grid-row: 2;
  position: relative;
  margin: 8px;
  border: 1px solid var(--gold-faint);
  border-radius: 2px;
  overflow: hidden;
  background: radial-gradient(ellipse at center, #0f1225 0%, #0b0e17 50%, #060810 100%);
}

/* Star field canvas */
#starfield {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
}

/* Coordinate grid */
.coord-grid {
  position: absolute;
  inset: 0;
  opacity: 0.12;
}

/* Constellation container */
.constellation-container {
  position: absolute;
  inset: 0;
  animation: celestialRotate 300s linear infinite;
}

@keyframes celestialRotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* Constellation name */
.constellation-name {
  position: absolute;
  top: 12%;
  left: 50%;
  transform: translateX(-50%);
  font-family: var(--font-display);
  font-style: italic;
  font-weight: 300;
  font-size: 18px;
  color: var(--celestial-gold);
  opacity: 0.5;
  letter-spacing: 6px;
  text-transform: uppercase;
  white-space: nowrap;
  pointer-events: none;
  animation: celestialRotateReverse 300s linear infinite;
}

@keyframes celestialRotateReverse {
  from { transform: translateX(-50%) rotate(0deg); }
  to { transform: translateX(-50%) rotate(-360deg); }
}

/* Agent stars */
.agent-star {
  position: absolute;
  transform: translate(-50%, -50%);
  cursor: pointer;
  z-index: 10;
}

.star-core {
  width: var(--star-size, 12px);
  height: var(--star-size, 12px);
  border-radius: 50%;
  background: radial-gradient(circle, var(--star-bright) 0%, var(--star-color, var(--celestial-gold)) 40%, transparent 70%);
  box-shadow:
    0 0 calc(var(--star-size, 12px) * 1.5) var(--star-color, var(--celestial-gold)),
    0 0 calc(var(--star-size, 12px) * 3) rgba(201, 168, 76, 0.3),
    0 0 calc(var(--star-size, 12px) * 5) rgba(201, 168, 76, 0.1);
  animation: twinkle var(--twinkle-duration, 3s) ease-in-out infinite;
  animation-delay: var(--twinkle-delay, 0s);
}

@keyframes twinkle {
  0%, 100% { opacity: 1; transform: scale(1); }
  25% { opacity: 0.85; transform: scale(0.95); }
  50% { opacity: 1; transform: scale(1.05); }
  75% { opacity: 0.9; transform: scale(0.98); }
}

.star-label {
  position: absolute;
  top: calc(100% + 6px);
  left: 50%;
  transform: translateX(-50%);
  font-family: var(--font-display);
  font-style: italic;
  font-size: 11px;
  color: var(--celestial-gold);
  white-space: nowrap;
  opacity: 0.7;
  letter-spacing: 1px;
  text-shadow: 0 0 8px rgba(0,0,0,0.8);
  animation: celestialRotateReverse 300s linear infinite;
}

.star-activity {
  position: absolute;
  top: calc(100% + 20px);
  left: 50%;
  transform: translateX(-50%);
  font-family: var(--font-mono);
  font-size: 9px;
  color: var(--gold-dim);
  white-space: nowrap;
  opacity: 0.5;
  animation: celestialRotateReverse 300s linear infinite;
}

/* Constellation SVG lines */
.constellation-lines {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  z-index: 5;
  pointer-events: none;
}

.constellation-line {
  stroke: var(--celestial-gold);
  stroke-width: 0.8;
  opacity: 0.35;
  filter: drop-shadow(0 0 2px var(--gold-glow));
}

/* Shooting star */
.shooting-star {
  position: absolute;
  width: 3px;
  height: 3px;
  background: var(--star-bright);
  border-radius: 50%;
  z-index: 20;
  pointer-events: none;
  opacity: 0;
}

.shooting-star.active {
  animation: shootingStar 1.2s ease-out forwards;
}

.shooting-star::after {
  content: '';
  position: absolute;
  top: 0;
  right: 100%;
  width: 80px;
  height: 1.5px;
  background: linear-gradient(90deg, transparent, rgba(240, 236, 226, 0.6), var(--star-bright));
  transform-origin: right center;
}

@keyframes shootingStar {
  0% {
    opacity: 1;
    transform: translate(0, 0) rotate(var(--shoot-angle, -30deg));
  }
  80% {
    opacity: 1;
  }
  100% {
    opacity: 0;
    transform: translate(var(--shoot-dx, 300px), var(--shoot-dy, 200px)) rotate(var(--shoot-angle, -30deg));
  }
}

/* Nova flash */
.nova-flash {
  position: absolute;
  width: 0;
  height: 0;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(255,255,240,0.8), rgba(201,168,76,0.4), transparent);
  z-index: 15;
  pointer-events: none;
  transform: translate(-50%, -50%);
}

.nova-flash.active {
  animation: novaFlash 0.8s ease-out forwards;
}

@keyframes novaFlash {
  0% { width: 0; height: 0; opacity: 1; }
  50% { width: 60px; height: 60px; opacity: 0.8; }
  100% { width: 100px; height: 100px; opacity: 0; }
}

/* Nova notification */
.nova-notification {
  position: absolute;
  bottom: 16px;
  left: 50%;
  transform: translateX(-50%);
  font-family: var(--font-display);
  font-style: italic;
  font-size: 12px;
  color: var(--gold-bright);
  background: rgba(11, 14, 23, 0.85);
  padding: 4px 16px;
  border: 1px solid var(--gold-faint);
  border-radius: 2px;
  opacity: 0;
  z-index: 25;
  white-space: nowrap;
  transition: opacity 0.3s ease;
  pointer-events: none;
}

.nova-notification.visible {
  opacity: 1;
}

/* Nebula effect */
.nebula {
  position: absolute;
  border-radius: 50%;
  pointer-events: none;
  z-index: 2;
  animation: nebulaDrift 60s ease-in-out infinite alternate;
}

@keyframes nebulaDrift {
  0% { transform: translate(0, 0) scale(1); }
  50% { transform: translate(10px, -5px) scale(1.05); }
  100% { transform: translate(-5px, 8px) scale(0.98); }
}

/* ============================================================
   OBSERVATORY LOG — RIGHT PANEL
   ============================================================ */
.observatory-log {
  grid-column: 3;
  grid-row: 2;
  background: linear-gradient(180deg, rgba(11, 14, 23, 0.95), rgba(6, 8, 16, 0.98));
  border: 1px solid var(--gold-faint);
  border-radius: 2px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  margin: 8px 0;
}

.log-header {
  padding: 12px 14px 8px;
  border-bottom: 1px solid var(--gold-faint);
  text-align: center;
}

.log-title {
  font-family: var(--font-display);
  font-weight: 600;
  font-size: 13px;
  letter-spacing: 3px;
  color: var(--celestial-gold);
  font-variant: small-caps;
  text-transform: uppercase;
}

.log-subtitle {
  font-family: var(--font-display);
  font-style: italic;
  font-size: 10px;
  color: var(--gold-dim);
  margin-top: 1px;
}

.log-entries {
  flex: 1;
  overflow-y: auto;
  padding: 8px 10px;
}

.log-entry {
  padding: 6px 0;
  border-bottom: 1px solid rgba(201, 168, 76, 0.06);
  animation: logFadeIn 0.5s ease-out;
}

@keyframes logFadeIn {
  from { opacity: 0; transform: translateY(-4px); }
  to { opacity: 1; transform: translateY(0); }
}

.log-timestamp {
  font-family: var(--font-display);
  font-style: italic;
  font-size: 10px;
  color: var(--gold-dim);
  letter-spacing: 0.5px;
}

.log-message {
  font-family: var(--font-body);
  font-size: 11px;
  color: var(--star-white);
  line-height: 1.5;
  margin-top: 2px;
  opacity: 0.85;
}

.log-message .highlight {
  color: var(--celestial-gold);
  font-style: italic;
}

.log-message .tool-name {
  font-family: var(--font-mono);
  font-size: 10px;
  color: var(--comet-blue);
  background: rgba(65, 105, 225, 0.1);
  padding: 0 4px;
  border-radius: 2px;
}

.log-message .error-text {
  color: var(--error-red);
}

.log-magnitude {
  display: inline-flex;
  gap: 2px;
  margin-left: 6px;
  vertical-align: middle;
}

.log-mag-dot {
  width: 4px;
  height: 4px;
  border-radius: 50%;
  background: var(--celestial-gold);
}

.log-mag-dot.dim {
  opacity: 0.25;
}

/* ============================================================
   BOTTOM INSTRUMENTS PANEL
   ============================================================ */
.instruments-panel {
  grid-column: 1 / -1;
  grid-row: 3;
  display: grid;
  grid-template-columns: 200px 1fr 200px 200px;
  gap: 10px;
  padding-top: 8px;
  border-top: 1px solid var(--gold-faint);
}

/* --- Orrery Display --- */
.orrery {
  position: relative;
  background: radial-gradient(circle, rgba(201, 168, 76, 0.05), transparent);
  border: 1px solid var(--gold-faint);
  border-radius: 2px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

.orrery-title {
  position: absolute;
  top: 6px;
  left: 50%;
  transform: translateX(-50%);
  font-family: var(--font-display);
  font-variant: small-caps;
  font-size: 10px;
  letter-spacing: 2px;
  color: var(--gold-dim);
}

.orrery-canvas {
  width: 160px;
  height: 160px;
  position: relative;
}

.orrery-center {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--celestial-gold);
  box-shadow: 0 0 12px var(--gold-glow), 0 0 24px rgba(201, 168, 76, 0.2);
}

.orrery-ring {
  position: absolute;
  top: 50%;
  left: 50%;
  border-radius: 50%;
  border: 1px solid var(--gold-faint);
  transform: translate(-50%, -50%);
}

.orrery-ring:nth-child(2) { width: 50px; height: 50px; }
.orrery-ring:nth-child(3) { width: 80px; height: 80px; }
.orrery-ring:nth-child(4) { width: 110px; height: 110px; }
.orrery-ring:nth-child(5) { width: 140px; height: 140px; }

.orrery-planet {
  position: absolute;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  transform: translate(-50%, -50%);
  box-shadow: 0 0 6px currentColor;
}

/* --- Spectroscope --- */
.spectroscope {
  border: 1px solid var(--gold-faint);
  border-radius: 2px;
  display: flex;
  flex-direction: column;
  padding: 8px 14px;
  background: linear-gradient(180deg, rgba(11, 14, 23, 0.9), rgba(6, 8, 16, 0.95));
}

.spectroscope-title {
  font-family: var(--font-display);
  font-variant: small-caps;
  font-size: 10px;
  letter-spacing: 2px;
  color: var(--gold-dim);
  text-align: center;
  margin-bottom: 8px;
}

.spectrum-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 6px;
}

.spectrum-bar {
  height: 18px;
  border-radius: 2px;
  display: flex;
  overflow: hidden;
  position: relative;
  border: 1px solid var(--gold-faint);
}

.spectrum-segment {
  height: 100%;
  position: relative;
  transition: width 1s ease;
}

.spectrum-segment::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(180deg, rgba(255,255,255,0.15) 0%, transparent 50%, rgba(0,0,0,0.15) 100%);
}

.spectrum-prism {
  position: relative;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.prism-shape {
  width: 0;
  height: 0;
  border-left: 15px solid transparent;
  border-right: 15px solid transparent;
  border-bottom: 26px solid rgba(201, 168, 76, 0.3);
  position: relative;
}

.prism-shape::after {
  content: '';
  position: absolute;
  top: 8px;
  left: -8px;
  width: 0;
  height: 0;
  border-left: 8px solid transparent;
  border-right: 8px solid transparent;
  border-bottom: 14px solid rgba(201, 168, 76, 0.15);
}

.spectrum-labels {
  display: flex;
  justify-content: space-between;
  padding: 0 2px;
}

.spectrum-label {
  font-family: var(--font-mono);
  font-size: 8px;
  color: var(--gold-dim);
  text-align: center;
}

.spectrum-legend {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 6px;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 4px;
}

.legend-swatch {
  width: 8px;
  height: 8px;
  border-radius: 1px;
}

.legend-name {
  font-family: var(--font-display);
  font-style: italic;
  font-size: 9px;
  color: var(--gold-dim);
}

/* --- Chronometer --- */
.chronometer {
  position: relative;
  border: 1px solid var(--gold-faint);
  border-radius: 2px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: radial-gradient(circle, rgba(201, 168, 76, 0.04), transparent);
}

.chronometer-title {
  position: absolute;
  top: 6px;
  font-family: var(--font-display);
  font-variant: small-caps;
  font-size: 10px;
  letter-spacing: 2px;
  color: var(--gold-dim);
}

.clock-face {
  position: relative;
  width: 130px;
  height: 130px;
}

.clock-face svg {
  width: 100%;
  height: 100%;
}

.clock-digital {
  position: absolute;
  bottom: 10px;
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--celestial-gold);
  letter-spacing: 2px;
}

/* --- Compass Rose --- */
.compass-rose-container {
  position: relative;
  border: 1px solid var(--gold-faint);
  border-radius: 2px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: radial-gradient(circle, rgba(201, 168, 76, 0.04), transparent);
}

.compass-title {
  position: absolute;
  top: 6px;
  font-family: var(--font-display);
  font-variant: small-caps;
  font-size: 10px;
  letter-spacing: 2px;
  color: var(--gold-dim);
}

.compass-rose {
  width: 150px;
  height: 150px;
}

/* ============================================================
   SCROLLBAR STYLES
   ============================================================ */
.log-entries::-webkit-scrollbar,
.star-catalog::-webkit-scrollbar {
  width: 4px;
}

.log-entries::-webkit-scrollbar-track,
.star-catalog::-webkit-scrollbar-track {
  background: transparent;
}

.log-entries::-webkit-scrollbar-thumb {
  background: var(--gold-dim);
  border-radius: 2px;
}

.star-catalog::-webkit-scrollbar-thumb {
  background: var(--parchment-aged);
  border-radius: 2px;
}

/* ============================================================
   SCALE BAR & LEGEND (bottom edge)
   ============================================================ */
.scale-bar {
  position: fixed;
  bottom: 14px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  gap: 12px;
  z-index: 50;
}

.scale-line {
  display: flex;
  align-items: center;
  gap: 4px;
}

.scale-segment {
  width: 30px;
  height: 1px;
  background: var(--celestial-gold);
  opacity: 0.4;
}

.scale-label {
  font-family: var(--font-display);
  font-style: italic;
  font-size: 8px;
  color: var(--gold-dim);
  letter-spacing: 1px;
}

.scale-separator {
  color: var(--gold-dim);
  font-size: 6px;
  opacity: 0.4;
}

.legend-inline {
  display: flex;
  gap: 10px;
}

.legend-inline-item {
  display: flex;
  align-items: center;
  gap: 4px;
}

.legend-dot {
  width: 5px;
  height: 5px;
  border-radius: 50%;
  box-shadow: 0 0 4px currentColor;
}

.legend-text {
  font-family: var(--font-display);
  font-style: italic;
  font-size: 8px;
  color: var(--gold-dim);
}
</style>
</head>
<body>

<!-- ============================================================
     ORNATE FRAME
     ============================================================ -->
<div class="frame-outer"></div>
<div class="frame-inner"></div>

<div class="frame-corner top-left">
  <svg viewBox="0 0 60 60">
    <path d="M0,0 L60,0 L50,3 L3,3 L3,50 L0,60 Z" fill="none" stroke="#c9a84c" stroke-width="1"/>
    <path d="M8,8 Q8,3 3,3" fill="none" stroke="#c9a84c" stroke-width="0.5" opacity="0.5"/>
    <circle cx="12" cy="12" r="3" fill="none" stroke="#c9a84c" stroke-width="0.5" opacity="0.6"/>
    <path d="M12,9 L12,6 M15,12 L18,12 M12,15 L12,18 M9,12 L6,12" stroke="#c9a84c" stroke-width="0.5" opacity="0.4"/>
    <circle cx="12" cy="12" r="1" fill="#c9a84c" opacity="0.5"/>
    <path d="M20,3 C22,6 24,8 28,8" fill="none" stroke="#c9a84c" stroke-width="0.3" opacity="0.4"/>
    <path d="M3,20 C6,22 8,24 8,28" fill="none" stroke="#c9a84c" stroke-width="0.3" opacity="0.4"/>
  </svg>
</div>
<div class="frame-corner top-right">
  <svg viewBox="0 0 60 60">
    <path d="M0,0 L60,0 L50,3 L3,3 L3,50 L0,60 Z" fill="none" stroke="#c9a84c" stroke-width="1"/>
    <path d="M8,8 Q8,3 3,3" fill="none" stroke="#c9a84c" stroke-width="0.5" opacity="0.5"/>
    <circle cx="12" cy="12" r="3" fill="none" stroke="#c9a84c" stroke-width="0.5" opacity="0.6"/>
    <path d="M12,9 L12,6 M15,12 L18,12 M12,15 L12,18 M9,12 L6,12" stroke="#c9a84c" stroke-width="0.5" opacity="0.4"/>
    <circle cx="12" cy="12" r="1" fill="#c9a84c" opacity="0.5"/>
    <path d="M20,3 C22,6 24,8 28,8" fill="none" stroke="#c9a84c" stroke-width="0.3" opacity="0.4"/>
    <path d="M3,20 C6,22 8,24 8,28" fill="none" stroke="#c9a84c" stroke-width="0.3" opacity="0.4"/>
  </svg>
</div>
<div class="frame-corner bottom-left">
  <svg viewBox="0 0 60 60">
    <path d="M0,0 L60,0 L50,3 L3,3 L3,50 L0,60 Z" fill="none" stroke="#c9a84c" stroke-width="1"/>
    <path d="M8,8 Q8,3 3,3" fill="none" stroke="#c9a84c" stroke-width="0.5" opacity="0.5"/>
    <circle cx="12" cy="12" r="3" fill="none" stroke="#c9a84c" stroke-width="0.5" opacity="0.6"/>
    <path d="M12,9 L12,6 M15,12 L18,12 M12,15 L12,18 M9,12 L6,12" stroke="#c9a84c" stroke-width="0.5" opacity="0.4"/>
    <circle cx="12" cy="12" r="1" fill="#c9a84c" opacity="0.5"/>
  </svg>
</div>
<div class="frame-corner bottom-right">
  <svg viewBox="0 0 60 60">
    <path d="M0,0 L60,0 L50,3 L3,3 L3,50 L0,60 Z" fill="none" stroke="#c9a84c" stroke-width="1"/>
    <path d="M8,8 Q8,3 3,3" fill="none" stroke="#c9a84c" stroke-width="0.5" opacity="0.5"/>
    <circle cx="12" cy="12" r="3" fill="none" stroke="#c9a84c" stroke-width="0.5" opacity="0.6"/>
    <path d="M12,9 L12,6 M15,12 L18,12 M12,15 L12,18 M9,12 L6,12" stroke="#c9a84c" stroke-width="0.5" opacity="0.4"/>
    <circle cx="12" cy="12" r="1" fill="#c9a84c" opacity="0.5"/>
  </svg>
</div>

<!-- ============================================================
     TITLE CARTOUCHE
     ============================================================ -->
<div class="cartouche">
  <div class="cartouche-title">AgentPane Celestial Observatory</div>
  <div class="cartouche-subtitle">Chart of Active Intelligences &mdash; Anno MMXXVI</div>
</div>

<!-- ============================================================
     MAIN OBSERVATORY LAYOUT
     ============================================================ -->
<div class="observatory">

  <!-- ========================================================
       CELESTIAL METRICS — TOP BANNER
       ======================================================== -->
  <div class="metrics-banner">
    <div class="metric-item">
      <span class="metric-star">&#10038;</span>
      <span class="metric-label">Epoch</span>
      <span class="metric-value" id="metric-epoch">30 Jan 2026, 14:32 UTC</span>
    </div>
    <div class="metric-item">
      <span class="metric-star">&#10038;</span>
      <span class="metric-label">Observed Bodies</span>
      <span class="metric-value">5</span>
    </div>
    <div class="metric-item">
      <span class="metric-star">&#10038;</span>
      <span class="metric-label">Total Luminosity</span>
      <span class="metric-value" id="metric-tokens">24,847 tokens</span>
    </div>
    <div class="metric-item">
      <span class="metric-star">&#10038;</span>
      <span class="metric-label">Celestial Events</span>
      <span class="metric-value" id="metric-events">147</span>
    </div>
    <div class="metric-item">
      <span class="metric-star">&#10038;</span>
      <span class="metric-label">Observatory Status</span>
      <span class="metric-value status-active">ACTIVE</span>
    </div>
  </div>

  <!-- ========================================================
       STAR CATALOG — LEFT PANEL
       ======================================================== -->
  <div class="star-catalog">
    <div class="catalog-content">
      <div class="catalog-header">
        <div class="catalog-title">Catalogus Stellarum</div>
        <div class="catalog-subtitle">Active Intelligences &mdash; Epoch MMXXVI</div>
      </div>
      <div id="star-catalog-entries"></div>
    </div>
  </div>

  <!-- ========================================================
       CELESTIAL CHART — CENTER
       ======================================================== -->
  <div class="celestial-chart" id="celestial-chart">
    <canvas id="starfield"></canvas>

    <!-- Nebulae -->
    <div class="nebula" style="width:180px;height:120px;top:20%;left:60%;background:radial-gradient(ellipse,rgba(74,32,112,0.15),transparent);"></div>
    <div class="nebula" style="width:140px;height:100px;top:55%;left:25%;background:radial-gradient(ellipse,rgba(65,105,225,0.1),transparent);animation-delay:-20s;"></div>
    <div class="nebula" style="width:100px;height:80px;top:35%;left:40%;background:radial-gradient(ellipse,rgba(201,168,76,0.08),transparent);animation-delay:-40s;"></div>

    <!-- Coordinate grid SVG -->
    <svg class="coord-grid" viewBox="0 0 100 100" preserveAspectRatio="none">
      <!-- Horizontal lines -->
      <line x1="0" y1="10" x2="100" y2="10" stroke="#c9a84c" stroke-width="0.15"/>
      <line x1="0" y1="20" x2="100" y2="20" stroke="#c9a84c" stroke-width="0.15"/>
      <line x1="0" y1="30" x2="100" y2="30" stroke="#c9a84c" stroke-width="0.15"/>
      <line x1="0" y1="40" x2="100" y2="40" stroke="#c9a84c" stroke-width="0.15"/>
      <line x1="0" y1="50" x2="100" y2="50" stroke="#c9a84c" stroke-width="0.2"/>
      <line x1="0" y1="60" x2="100" y2="60" stroke="#c9a84c" stroke-width="0.15"/>
      <line x1="0" y1="70" x2="100" y2="70" stroke="#c9a84c" stroke-width="0.15"/>
      <line x1="0" y1="80" x2="100" y2="80" stroke="#c9a84c" stroke-width="0.15"/>
      <line x1="0" y1="90" x2="100" y2="90" stroke="#c9a84c" stroke-width="0.15"/>
      <!-- Vertical lines -->
      <line x1="10" y1="0" x2="10" y2="100" stroke="#c9a84c" stroke-width="0.15"/>
      <line x1="20" y1="0" x2="20" y2="100" stroke="#c9a84c" stroke-width="0.15"/>
      <line x1="30" y1="0" x2="30" y2="100" stroke="#c9a84c" stroke-width="0.15"/>
      <line x1="40" y1="0" x2="40" y2="100" stroke="#c9a84c" stroke-width="0.15"/>
      <line x1="50" y1="0" x2="50" y2="100" stroke="#c9a84c" stroke-width="0.2"/>
      <line x1="60" y1="0" x2="60" y2="100" stroke="#c9a84c" stroke-width="0.15"/>
      <line x1="70" y1="0" x2="70" y2="100" stroke="#c9a84c" stroke-width="0.15"/>
      <line x1="80" y1="0" x2="80" y2="100" stroke="#c9a84c" stroke-width="0.15"/>
      <line x1="90" y1="0" x2="90" y2="100" stroke="#c9a84c" stroke-width="0.15"/>
      <!-- Diagonal cross -->
      <line x1="0" y1="0" x2="100" y2="100" stroke="#c9a84c" stroke-width="0.08" opacity="0.5"/>
      <line x1="100" y1="0" x2="0" y2="100" stroke="#c9a84c" stroke-width="0.08" opacity="0.5"/>
      <!-- Center circle -->
      <circle cx="50" cy="50" r="35" fill="none" stroke="#c9a84c" stroke-width="0.15" opacity="0.5"/>
      <circle cx="50" cy="50" r="20" fill="none" stroke="#c9a84c" stroke-width="0.1" opacity="0.3"/>
    </svg>

    <!-- Constellation -->
    <div class="constellation-container" id="constellation">
      <div class="constellation-name">Constellation Agentis</div>
      <svg class="constellation-lines" id="constellation-lines"></svg>
      <!-- Agent stars injected by JS -->
    </div>

    <!-- Shooting star container -->
    <div id="shooting-stars"></div>

    <!-- Nova notification -->
    <div class="nova-notification" id="nova-notification"></div>
  </div>

  <!-- ========================================================
       OBSERVATORY LOG — RIGHT PANEL
       ======================================================== -->
  <div class="observatory-log">
    <div class="log-header">
      <div class="log-title">Observational Record</div>
      <div class="log-subtitle">Live Celestial Phenomena</div>
    </div>
    <div class="log-entries" id="log-entries"></div>
  </div>

  <!-- ========================================================
       BOTTOM INSTRUMENTS
       ======================================================== -->
  <div class="instruments-panel">

    <!-- Orrery -->
    <div class="orrery">
      <div class="orrery-title">Orrery</div>
      <div class="orrery-canvas" id="orrery-canvas">
        <div class="orrery-center"></div>
        <div class="orrery-ring"></div>
        <div class="orrery-ring"></div>
        <div class="orrery-ring"></div>
        <div class="orrery-ring"></div>
      </div>
    </div>

    <!-- Spectroscope -->
    <div class="spectroscope">
      <div class="spectroscope-title">Spectroscope &mdash; Token Distribution</div>
      <div class="spectrum-container">
        <div class="spectrum-bar" id="spectrum-bar"></div>
        <div class="spectrum-labels" id="spectrum-labels"></div>
        <div class="spectrum-legend" id="spectrum-legend"></div>
      </div>
    </div>

    <!-- Chronometer -->
    <div class="chronometer">
      <div class="chronometer-title">Chronometer</div>
      <div class="clock-face" id="clock-face">
        <svg viewBox="0 0 130 130">
          <!-- Clock outer ring -->
          <circle cx="65" cy="65" r="60" fill="none" stroke="#c9a84c" stroke-width="1.5" opacity="0.6"/>
          <circle cx="65" cy="65" r="58" fill="none" stroke="#c9a84c" stroke-width="0.3" opacity="0.3"/>
          <circle cx="65" cy="65" r="55" fill="none" stroke="#c9a84c" stroke-width="0.5" opacity="0.2"/>

          <!-- Roman numerals -->
          <text x="65" y="18" text-anchor="middle" font-family="Cormorant Garamond" font-size="10" fill="#c9a84c" opacity="0.8">XII</text>
          <text x="97" y="23" text-anchor="middle" font-family="Cormorant Garamond" font-size="8" fill="#c9a84c" opacity="0.6">I</text>
          <text x="115" y="42" text-anchor="middle" font-family="Cormorant Garamond" font-size="8" fill="#c9a84c" opacity="0.6">II</text>
          <text x="120" y="68" text-anchor="middle" font-family="Cormorant Garamond" font-size="9" fill="#c9a84c" opacity="0.8">III</text>
          <text x="115" y="93" text-anchor="middle" font-family="Cormorant Garamond" font-size="8" fill="#c9a84c" opacity="0.6">IV</text>
          <text x="97" y="112" text-anchor="middle" font-family="Cormorant Garamond" font-size="8" fill="#c9a84c" opacity="0.6">V</text>
          <text x="65" y="120" text-anchor="middle" font-family="Cormorant Garamond" font-size="9" fill="#c9a84c" opacity="0.8">VI</text>
          <text x="33" y="112" text-anchor="middle" font-family="Cormorant Garamond" font-size="8" fill="#c9a84c" opacity="0.6">VII</text>
          <text x="15" y="93" text-anchor="middle" font-family="Cormorant Garamond" font-size="8" fill="#c9a84c" opacity="0.6">VIII</text>
          <text x="11" y="68" text-anchor="middle" font-family="Cormorant Garamond" font-size="9" fill="#c9a84c" opacity="0.8">IX</text>
          <text x="15" y="42" text-anchor="middle" font-family="Cormorant Garamond" font-size="8" fill="#c9a84c" opacity="0.6">X</text>
          <text x="33" y="23" text-anchor="middle" font-family="Cormorant Garamond" font-size="8" fill="#c9a84c" opacity="0.6">XI</text>

          <!-- Tick marks -->
          <g id="clock-ticks"></g>

          <!-- Clock hands -->
          <line id="clock-hour" x1="65" y1="65" x2="65" y2="32" stroke="#c9a84c" stroke-width="2" stroke-linecap="round" opacity="0.9"/>
          <line id="clock-minute" x1="65" y1="65" x2="65" y2="22" stroke="#c9a84c" stroke-width="1.2" stroke-linecap="round" opacity="0.8"/>
          <line id="clock-second" x1="65" y1="75" x2="65" y2="18" stroke="#e0c872" stroke-width="0.5" opacity="0.7"/>
          <circle cx="65" cy="65" r="2.5" fill="#c9a84c"/>
          <circle cx="65" cy="65" r="1" fill="#0b0e17"/>
        </svg>
      </div>
      <div class="clock-digital" id="clock-digital">00:00:00</div>
    </div>

    <!-- Compass Rose -->
    <div class="compass-rose-container">
      <div class="compass-title">Status Compass</div>
      <svg class="compass-rose" viewBox="0 0 150 150" id="compass-rose">
        <!-- Outer decorative circles -->
        <circle cx="75" cy="75" r="68" fill="none" stroke="#c9a84c" stroke-width="0.8" opacity="0.4"/>
        <circle cx="75" cy="75" r="66" fill="none" stroke="#c9a84c" stroke-width="0.3" opacity="0.25"/>
        <circle cx="75" cy="75" r="64" fill="none" stroke="#c9a84c" stroke-width="0.5" opacity="0.3"/>
        <circle cx="75" cy="75" r="55" fill="none" stroke="#c9a84c" stroke-width="0.3" opacity="0.2"/>

        <!-- Degree ticks -->
        <g id="compass-ticks" opacity="0.3"></g>

        <!-- Decorative inner rings -->
        <circle cx="75" cy="75" r="42" fill="none" stroke="#c9a84c" stroke-width="0.3" opacity="0.15"/>
        <circle cx="75" cy="75" r="20" fill="none" stroke="#c9a84c" stroke-width="0.3" opacity="0.2"/>

        <!-- Main compass points - ornate star pattern -->
        <!-- North point (Active) -->
        <polygon points="75,12 79,55 75,48 71,55" fill="#c9a84c" opacity="0.9"/>
        <polygon points="75,12 71,55 75,48 79,55" fill="#8a7234" opacity="0.6"/>
        <!-- South point (Idle) -->
        <polygon points="75,138 79,95 75,102 71,95" fill="#c9a84c" opacity="0.5"/>
        <polygon points="75,138 71,95 75,102 79,95" fill="#8a7234" opacity="0.3"/>
        <!-- East point (Planning) -->
        <polygon points="138,75 95,71 102,75 95,79" fill="#c9a84c" opacity="0.5"/>
        <polygon points="138,75 95,79 102,75 95,71" fill="#8a7234" opacity="0.3"/>
        <!-- West point (Error) -->
        <polygon points="12,75 55,71 48,75 55,79" fill="#c9a84c" opacity="0.5"/>
        <polygon points="12,75 55,79 48,75 55,71" fill="#8a7234" opacity="0.3"/>

        <!-- Intercardinal points (smaller) -->
        <polygon points="109,19 85,60 82,56 90,52" fill="#c9a84c" opacity="0.3"/>
        <polygon points="131,41 90,60 86,56 92,52" fill="#c9a84c" opacity="0.2"/>
        <polygon points="131,109 90,90 86,94 92,98" fill="#c9a84c" opacity="0.2"/>
        <polygon points="109,131 85,90 82,94 90,98" fill="#c9a84c" opacity="0.2"/>
        <polygon points="41,131 60,90 64,94 56,98" fill="#c9a84c" opacity="0.2"/>
        <polygon points="19,109 60,90 64,86 56,82" fill="#c9a84c" opacity="0.2"/>
        <polygon points="19,41 60,60 64,56 56,52" fill="#c9a84c" opacity="0.2"/>
        <polygon points="41,19 60,60 64,64 56,60" fill="#c9a84c" opacity="0.2"/>

        <!-- Inner decorative star (16-point) -->
        <g opacity="0.15">
          <line x1="75" y1="35" x2="75" y2="115" stroke="#c9a84c" stroke-width="0.5"/>
          <line x1="35" y1="75" x2="115" y2="75" stroke="#c9a84c" stroke-width="0.5"/>
          <line x1="47" y1="47" x2="103" y2="103" stroke="#c9a84c" stroke-width="0.3"/>
          <line x1="103" y1="47" x2="47" y2="103" stroke="#c9a84c" stroke-width="0.3"/>
        </g>

        <!-- Direction labels -->
        <text x="75" y="10" text-anchor="middle" font-family="Cormorant Garamond" font-size="7" fill="#e0c872" font-weight="600" letter-spacing="1">ACTIVE</text>
        <text x="75" y="147" text-anchor="middle" font-family="Cormorant Garamond" font-size="7" fill="#c9a84c" opacity="0.6" letter-spacing="1">IDLE</text>
        <text x="146" y="78" text-anchor="end" font-family="Cormorant Garamond" font-size="7" fill="#c9a84c" opacity="0.6" letter-spacing="1">PLAN</text>
        <text x="4" y="78" text-anchor="start" font-family="Cormorant Garamond" font-size="7" fill="#c04040" opacity="0.6" letter-spacing="1">ERR</text>

        <!-- Compass needle -->
        <g id="compass-needle" transform-origin="75 75">
          <line x1="75" y1="30" x2="75" y2="120" stroke="#e0c872" stroke-width="1.5" opacity="0.8"/>
          <polygon points="75,25 72,45 75,40 78,45" fill="#e0c872" opacity="0.9"/>
          <polygon points="75,125 72,105 75,110 78,105" fill="#8a7234" opacity="0.5"/>
        </g>

        <!-- Center jewel -->
        <circle cx="75" cy="75" r="5" fill="#0b0e17" stroke="#c9a84c" stroke-width="1"/>
        <circle cx="75" cy="75" r="2.5" fill="#c9a84c" opacity="0.6"/>
        <circle cx="75" cy="75" r="1" fill="#e0c872"/>
      </svg>
    </div>

  </div><!-- /instruments-panel -->

</div><!-- /observatory -->

<!-- ============================================================
     SCALE BAR
     ============================================================ -->
<div class="scale-bar">
  <div class="scale-line">
    <div class="scale-segment"></div>
    <div class="scale-segment" style="opacity:0.6"></div>
    <div class="scale-segment" style="opacity:0.3"></div>
  </div>
  <span class="scale-label">100 tokens</span>
  <span class="scale-separator">&#10038;</span>
  <div class="legend-inline">
    <div class="legend-inline-item">
      <div class="legend-dot" style="background:#e0c872;color:#e0c872;"></div>
      <span class="legend-text">Active Star</span>
    </div>
    <div class="legend-inline-item">
      <div class="legend-dot" style="background:#4169E1;color:#4169E1;"></div>
      <span class="legend-text">Transit</span>
    </div>
    <div class="legend-inline-item">
      <div class="legend-dot" style="background:#c04040;color:#c04040;"></div>
      <span class="legend-text">Nova Event</span>
    </div>
  </div>
  <span class="scale-separator">&#10038;</span>
  <span class="scale-label">Proj. Mercator &middot; J2026.0</span>
</div>


<!-- ============================================================
     JAVASCRIPT — CELESTIAL ENGINE
     ============================================================ -->
<script>
// ============================================================
// AGENT DATA — The Five Stars
// ============================================================
const agents = [
  {
    id: 'alpha',
    greek: '\u03b1',
    name: 'ATLAS',
    fullName: '\u03b1 Agentis',
    spectralClass: 'TypeScript',
    currentTransit: 'auth-middleware.ts',
    currentModule: 'services/auth',
    magnitude: 1.2,
    luminosity: 423,
    tokens: 6842,
    color: '#e0c872',
    starSize: 16,
    position: { x: 42, y: 35 },
    twinkleDuration: 2.8,
    status: 'active',
    orbitRadius: 70,
    orbitSpeed: 0.015
  },
  {
    id: 'beta',
    greek: '\u03b2',
    name: 'BEACON',
    fullName: '\u03b2 Agentis',
    spectralClass: 'TypeScript',
    currentTransit: 'api-gateway.ts',
    currentModule: 'services/',
    magnitude: 1.8,
    luminosity: 367,
    tokens: 5934,
    color: '#4169E1',
    starSize: 13,
    position: { x: 65, y: 28 },
    twinkleDuration: 3.2,
    status: 'active',
    orbitRadius: 55,
    orbitSpeed: 0.022
  },
  {
    id: 'gamma',
    greek: '\u03b3',
    name: 'CIPHER',
    fullName: '\u03b3 Agentis',
    spectralClass: 'Python',
    currentTransit: 'ml-pipeline.py',
    currentModule: 'ml/',
    magnitude: 2.1,
    luminosity: 289,
    tokens: 4671,
    color: '#c9a84c',
    starSize: 11,
    position: { x: 30, y: 58 },
    twinkleDuration: 3.7,
    status: 'planning',
    orbitRadius: 40,
    orbitSpeed: 0.03
  },
  {
    id: 'delta',
    greek: '\u03b4',
    name: 'DRIFT',
    fullName: '\u03b4 Agentis',
    spectralClass: 'Rust',
    currentTransit: 'worker-pool.rs',
    currentModule: 'workers/',
    magnitude: 2.5,
    luminosity: 198,
    tokens: 4102,
    color: '#9370DB',
    starSize: 9,
    position: { x: 72, y: 62 },
    twinkleDuration: 4.1,
    status: 'active',
    orbitRadius: 25,
    orbitSpeed: 0.04
  },
  {
    id: 'epsilon',
    greek: '\u03b5',
    name: 'ECHO',
    fullName: '\u03b5 Agentis',
    spectralClass: 'Go',
    currentTransit: 'event-bus.go',
    currentModule: 'events/',
    magnitude: 3.0,
    luminosity: 156,
    tokens: 3298,
    color: '#CD853F',
    starSize: 8,
    position: { x: 55, y: 72 },
    twinkleDuration: 4.5,
    status: 'idle',
    orbitRadius: 60,
    orbitSpeed: 0.018
  }
];

// Constellation line connections (pairs of agent indices)
const constellationEdges = [
  [0, 1], // alpha - beta
  [1, 3], // beta - delta
  [3, 4], // delta - epsilon
  [4, 2], // epsilon - gamma
  [2, 0], // gamma - alpha
  [0, 3], // alpha - delta (cross line)
];

// Simulated event types
const eventTemplates = [
  { type: 'burst', text: (a) => `Star ${a.greek} emitted burst (<span class="tool-name">Write</span>) \u2014 magnitude ${(Math.random() * 3 + 1).toFixed(1)}`, mag: 3 },
  { type: 'transit', text: (a) => `Star ${a.greek} entered transit of module <span class="highlight">${a.currentModule}</span>`, mag: 2 },
  { type: 'read', text: (a) => `Star ${a.greek} observed file (<span class="tool-name">Read</span>) in sector ${a.currentModule}`, mag: 2 },
  { type: 'tool', text: (a) => `Star ${a.greek} invoked instrument (<span class="tool-name">Bash</span>) \u2014 luminosity spike`, mag: 3 },
  { type: 'complete', text: (a) => `Star ${a.greek} completed phase \u2014 stellar output recorded`, mag: 4 },
  { type: 'error', text: (a) => `<span class="error-text">Meteor event detected</span> near Star ${a.greek} \u2014 sector ${a.currentModule}`, mag: 1 },
  { type: 'search', text: (a) => `Star ${a.greek} scanning quadrant (<span class="tool-name">Grep</span>) \u2014 pattern matching`, mag: 2 },
  { type: 'plan', text: (a) => `Star ${a.greek} entering <span class="highlight">planning transit</span> \u2014 trajectory computing`, mag: 2 },
];

// ============================================================
// STATE
// ============================================================
let totalTokens = 24847;
let totalEvents = 147;
let sessionStart = Date.now() - (32 * 60 * 1000); // 32 minutes ago
let compassAngle = 0; // 0 = north = active
let orreryTime = 0;

// ============================================================
// STAR FIELD — Canvas Rendering
// ============================================================
function initStarfield() {
  const canvas = document.getElementById('starfield');
  const ctx = canvas.getContext('2d');
  const chart = document.getElementById('celestial-chart');

  function resize() {
    canvas.width = chart.clientWidth;
    canvas.height = chart.clientHeight;
  }
  resize();
  window.addEventListener('resize', resize);

  // Generate background stars
  const stars = [];
  const starCount = 300;
  for (let i = 0; i < starCount; i++) {
    stars.push({
      x: Math.random(),
      y: Math.random(),
      size: Math.random() * 1.8 + 0.2,
      brightness: Math.random() * 0.7 + 0.3,
      twinkleSpeed: Math.random() * 0.02 + 0.005,
      twinklePhase: Math.random() * Math.PI * 2,
      color: Math.random() > 0.85 ? '#fffde8' : (Math.random() > 0.7 ? '#e8dcc4' : '#f0ece2')
    });
  }

  function drawStars(time) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    for (const star of stars) {
      const twinkle = Math.sin(time * star.twinkleSpeed + star.twinklePhase);
      const alpha = star.brightness * (0.7 + twinkle * 0.3);
      const size = star.size * (0.9 + twinkle * 0.1);

      ctx.beginPath();
      ctx.arc(star.x * canvas.width, star.y * canvas.height, size, 0, Math.PI * 2);
      ctx.fillStyle = star.color;
      ctx.globalAlpha = alpha;
      ctx.fill();

      // Glow for brighter stars
      if (star.size > 1.2) {
        ctx.beginPath();
        ctx.arc(star.x * canvas.width, star.y * canvas.height, size * 2.5, 0, Math.PI * 2);
        const glow = ctx.createRadialGradient(
          star.x * canvas.width, star.y * canvas.height, 0,
          star.x * canvas.width, star.y * canvas.height, size * 2.5
        );
        glow.addColorStop(0, `rgba(240, 236, 226, ${alpha * 0.3})`);
        glow.addColorStop(1, 'transparent');
        ctx.fillStyle = glow;
        ctx.globalAlpha = 1;
        ctx.fill();
      }
    }

    ctx.globalAlpha = 1;
    requestAnimationFrame(drawStars);
  }

  requestAnimationFrame(drawStars);
}

// ============================================================
// CONSTELLATION — Stars & Lines
// ============================================================
function initConstellation() {
  const container = document.getElementById('constellation');
  const chart = document.getElementById('celestial-chart');

  // Place agent stars
  agents.forEach((agent, i) => {
    const starEl = document.createElement('div');
    starEl.className = 'agent-star';
    starEl.id = `star-${agent.id}`;
    starEl.style.left = `${agent.position.x}%`;
    starEl.style.top = `${agent.position.y}%`;
    starEl.style.setProperty('--star-size', `${agent.starSize}px`);
    starEl.style.setProperty('--star-color', agent.color);
    starEl.style.setProperty('--twinkle-duration', `${agent.twinkleDuration}s`);
    starEl.style.setProperty('--twinkle-delay', `${i * 0.5}s`);

    starEl.innerHTML = `
      <div class="star-core"></div>
      <div class="star-label">${agent.greek} ${agent.name}</div>
      <div class="star-activity">${agent.luminosity} tok/min</div>
    `;

    container.appendChild(starEl);
  });

  // Draw constellation lines
  updateConstellationLines();
  window.addEventListener('resize', updateConstellationLines);
}

function updateConstellationLines() {
  const svg = document.getElementById('constellation-lines');
  const chart = document.getElementById('celestial-chart');
  const w = chart.clientWidth;
  const h = chart.clientHeight;

  svg.innerHTML = '';
  svg.setAttribute('viewBox', `0 0 ${w} ${h}`);

  constellationEdges.forEach(([i, j]) => {
    const a = agents[i];
    const b = agents[j];
    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    line.setAttribute('x1', (a.position.x / 100) * w);
    line.setAttribute('y1', (a.position.y / 100) * h);
    line.setAttribute('x2', (b.position.x / 100) * w);
    line.setAttribute('y2', (b.position.y / 100) * h);
    line.setAttribute('class', 'constellation-line');
    svg.appendChild(line);
  });
}

// ============================================================
// STAR CATALOG — Parchment Panel
// ============================================================
function initStarCatalog() {
  const container = document.getElementById('star-catalog-entries');

  agents.forEach(agent => {
    const magnitudePips = Array.from({ length: 5 }, (_, i) =>
      `<div class="magnitude-pip ${i < Math.round(5 - agent.magnitude) ? 'active' : ''}"></div>`
    ).join('');

    // Mini constellation SVG for each entry
    const miniSvg = `<svg class="star-mini-constellation" viewBox="0 0 30 20">
      <circle cx="8" cy="6" r="1.5" fill="${agent.color}" opacity="0.8"/>
      <circle cx="22" cy="8" r="1" fill="#8a7234" opacity="0.5"/>
      <circle cx="15" cy="16" r="1" fill="#8a7234" opacity="0.5"/>
      <line x1="8" y1="6" x2="22" y2="8" stroke="#8a7234" stroke-width="0.3" opacity="0.4"/>
      <line x1="22" y1="8" x2="15" y2="16" stroke="#8a7234" stroke-width="0.3" opacity="0.4"/>
      <line x1="15" y1="16" x2="8" y2="6" stroke="#8a7234" stroke-width="0.3" opacity="0.4"/>
    </svg>`;

    const entry = document.createElement('div');
    entry.className = 'star-entry';
    entry.id = `catalog-${agent.id}`;
    entry.innerHTML = `
      <div class="star-name">
        <span class="star-symbol">\u2605</span>
        ${agent.fullName}
        <span class="designation">(${agent.name})</span>
        ${miniSvg}
      </div>
      <div class="star-detail">
        <span class="detail-label">Magnitude:</span>
        <span class="detail-value">${agent.magnitude.toFixed(1)}</span>
        <span style="margin-left:4px;opacity:0.5">(${agent.status})</span>
      </div>
      <div class="star-detail">
        <span class="detail-label">Spectral Class:</span>
        <em>${agent.spectralClass}</em>
      </div>
      <div class="star-detail">
        <span class="detail-label">Current Transit:</span>
        <span class="detail-value">${agent.currentTransit}</span>
      </div>
      <div class="star-detail">
        <span class="detail-label">Luminosity:</span>
        <span class="detail-value" id="lum-${agent.id}">${agent.luminosity} tokens/min</span>
      </div>
      <div class="star-magnitude-bar">${magnitudePips}</div>
    `;

    container.appendChild(entry);
  });
}

// ============================================================
// OBSERVATORY LOG
// ============================================================
function addLogEntry(agent, template) {
  const entries = document.getElementById('log-entries');
  const now = new Date();
  const timeStr = now.toTimeString().slice(0, 8);

  const magDots = Array.from({ length: 5 }, (_, i) =>
    `<div class="log-mag-dot ${i >= template.mag ? 'dim' : ''}"></div>`
  ).join('');

  const entry = document.createElement('div');
  entry.className = 'log-entry';
  entry.innerHTML = `
    <div class="log-timestamp">${timeStr}</div>
    <div class="log-message">
      ${template.text(agent)}
      <span class="log-magnitude">${magDots}</span>
    </div>
  `;

  entries.insertBefore(entry, entries.firstChild);

  // Keep max 50 entries
  while (entries.children.length > 50) {
    entries.removeChild(entries.lastChild);
  }

  // Update event count
  totalEvents++;
  document.getElementById('metric-events').textContent = totalEvents.toLocaleString();
}

function generateEvent() {
  const agent = agents[Math.floor(Math.random() * agents.length)];
  const template = eventTemplates[Math.floor(Math.random() * eventTemplates.length)];
  addLogEntry(agent, template);

  // Update token counts
  const tokenIncrease = Math.floor(Math.random() * 50 + 10);
  totalTokens += tokenIncrease;
  agent.tokens += tokenIncrease;
  document.getElementById('metric-tokens').textContent = totalTokens.toLocaleString() + ' tokens';

  // Update luminosity with some variance
  agent.luminosity = Math.floor(agent.luminosity * (0.95 + Math.random() * 0.1));
  const lumEl = document.getElementById(`lum-${agent.id}`);
  if (lumEl) lumEl.textContent = agent.luminosity + ' tokens/min';
}

function initLog() {
  // Seed initial entries
  for (let i = 0; i < 12; i++) {
    generateEvent();
  }

  // Generate new events every 2-5 seconds
  function scheduleNext() {
    const delay = 2000 + Math.random() * 3000;
    setTimeout(() => {
      generateEvent();
      scheduleNext();
    }, delay);
  }
  scheduleNext();
}

// ============================================================
// SHOOTING STARS
// ============================================================
function fireShootingStar() {
  const chart = document.getElementById('celestial-chart');
  const container = document.getElementById('shooting-stars');
  const w = chart.clientWidth;
  const h = chart.clientHeight;

  const star = document.createElement('div');
  star.className = 'shooting-star';

  // Random start position (top or left edge)
  const startX = Math.random() * w * 0.6;
  const startY = Math.random() * h * 0.3;
  const angle = -(20 + Math.random() * 25);
  const distance = 200 + Math.random() * 300;
  const rad = angle * Math.PI / 180;
  const dx = Math.cos(rad) * distance;
  const dy = -Math.sin(rad) * distance;

  star.style.left = startX + 'px';
  star.style.top = startY + 'px';
  star.style.setProperty('--shoot-angle', angle + 'deg');
  star.style.setProperty('--shoot-dx', dx + 'px');
  star.style.setProperty('--shoot-dy', (-dy) + 'px');

  container.appendChild(star);

  requestAnimationFrame(() => {
    star.classList.add('active');
  });

  setTimeout(() => {
    star.remove();
  }, 1500);
}

function initShootingStars() {
  // Fire one every 6-12 seconds
  function schedule() {
    const delay = 6000 + Math.random() * 6000;
    setTimeout(() => {
      fireShootingStar();
      schedule();
    }, delay);
  }
  // Initial one after 2 seconds
  setTimeout(fireShootingStar, 2000);
  schedule();
}

// ============================================================
// NOVA EVENTS (task completions)
// ============================================================
function fireNovaEvent() {
  const agent = agents[Math.floor(Math.random() * agents.length)];
  const starEl = document.getElementById(`star-${agent.id}`);
  if (!starEl) return;

  const chart = document.getElementById('celestial-chart');

  // Flash at star position
  const flash = document.createElement('div');
  flash.className = 'nova-flash';
  flash.style.left = `${agent.position.x}%`;
  flash.style.top = `${agent.position.y}%`;
  chart.querySelector('.constellation-container').appendChild(flash);

  requestAnimationFrame(() => flash.classList.add('active'));
  setTimeout(() => flash.remove(), 1000);

  // Notification
  const notif = document.getElementById('nova-notification');
  notif.innerHTML = `\u2605 Nova event \u2014 Star ${agent.greek} ${agent.name} completed task`;
  notif.classList.add('visible');
  setTimeout(() => notif.classList.remove('visible'), 3000);

  // Fire a shooting star from the nova
  setTimeout(fireShootingStar, 200);

  // Log it
  addLogEntry(agent, {
    type: 'complete',
    text: (a) => `<span class="highlight">\u2605 Nova event</span> \u2014 Star ${a.greek} completed task phase`,
    mag: 5
  });
}

function initNovaEvents() {
  // Nova every 15-25 seconds
  function schedule() {
    const delay = 15000 + Math.random() * 10000;
    setTimeout(() => {
      fireNovaEvent();
      schedule();
    }, delay);
  }
  setTimeout(() => { fireNovaEvent(); schedule(); }, 8000);
}

// ============================================================
// ORRERY — Planetary Orbits
// ============================================================
function initOrrery() {
  const canvas = document.getElementById('orrery-canvas');
  const planets = [];

  agents.forEach((agent, i) => {
    const planet = document.createElement('div');
    planet.className = 'orrery-planet';
    planet.style.color = agent.color;
    planet.style.background = agent.color;
    planet.style.width = (4 + (5 - i)) + 'px';
    planet.style.height = (4 + (5 - i)) + 'px';
    canvas.appendChild(planet);
    planets.push({ el: planet, agent, angle: (i / agents.length) * Math.PI * 2 });
  });

  function updateOrrery() {
    orreryTime += 0.016;
    const cx = 80; // center x in px
    const cy = 80;

    planets.forEach((p, i) => {
      p.angle += p.agent.orbitSpeed;
      const ringRadii = [22, 37, 52, 67]; // Match CSS ring sizes / 2
      const r = ringRadii[Math.min(i, ringRadii.length - 1)];
      const x = cx + Math.cos(p.angle) * r;
      const y = cy + Math.sin(p.angle) * r;
      p.el.style.left = x + 'px';
      p.el.style.top = y + 'px';
    });

    requestAnimationFrame(updateOrrery);
  }

  requestAnimationFrame(updateOrrery);
}

// ============================================================
// SPECTROSCOPE — Token Distribution
// ============================================================
function initSpectroscope() {
  const bar = document.getElementById('spectrum-bar');
  const labels = document.getElementById('spectrum-labels');
  const legend = document.getElementById('spectrum-legend');

  const colors = ['#e0c872', '#4169E1', '#c9a84c', '#9370DB', '#CD853F'];
  const totalAgentTokens = agents.reduce((s, a) => s + a.tokens, 0);

  agents.forEach((agent, i) => {
    const pct = (agent.tokens / totalAgentTokens) * 100;

    const segment = document.createElement('div');
    segment.className = 'spectrum-segment';
    segment.id = `spectrum-${agent.id}`;
    segment.style.width = pct + '%';
    segment.style.background = `linear-gradient(90deg, ${colors[i]}cc, ${colors[i]})`;
    bar.appendChild(segment);

    const label = document.createElement('div');
    label.className = 'spectrum-label';
    label.textContent = agent.greek;
    labels.appendChild(label);

    const item = document.createElement('div');
    item.className = 'legend-item';
    item.innerHTML = `
      <div class="legend-swatch" style="background:${colors[i]}"></div>
      <span class="legend-name">${agent.greek} ${agent.name}</span>
    `;
    legend.appendChild(item);
  });

  // Animate spectrum changes
  setInterval(() => {
    const total = agents.reduce((s, a) => s + a.tokens, 0);
    agents.forEach(agent => {
      const pct = (agent.tokens / total) * 100;
      const seg = document.getElementById(`spectrum-${agent.id}`);
      if (seg) seg.style.width = pct + '%';
    });
  }, 3000);
}

// ============================================================
// CHRONOMETER — Elapsed Time Clock
// ============================================================
function initChronometer() {
  // Generate tick marks
  const ticks = document.getElementById('clock-ticks');
  for (let i = 0; i < 60; i++) {
    const angle = (i / 60) * 360;
    const isHour = i % 5 === 0;
    const r1 = isHour ? 50 : 54;
    const r2 = 57;
    const rad = (angle - 90) * Math.PI / 180;
    const x1 = 65 + Math.cos(rad) * r1;
    const y1 = 65 + Math.sin(rad) * r1;
    const x2 = 65 + Math.cos(rad) * r2;
    const y2 = 65 + Math.sin(rad) * r2;

    const tick = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    tick.setAttribute('x1', x1);
    tick.setAttribute('y1', y1);
    tick.setAttribute('x2', x2);
    tick.setAttribute('y2', y2);
    tick.setAttribute('stroke', '#c9a84c');
    tick.setAttribute('stroke-width', isHour ? '1' : '0.3');
    tick.setAttribute('opacity', isHour ? '0.6' : '0.3');
    ticks.appendChild(tick);
  }

  function updateClock() {
    const elapsed = Date.now() - sessionStart;
    const totalSec = Math.floor(elapsed / 1000);
    const h = Math.floor(totalSec / 3600);
    const m = Math.floor((totalSec % 3600) / 60);
    const s = totalSec % 60;

    // Digital display
    document.getElementById('clock-digital').textContent =
      `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;

    // Analog hands
    const hourAngle = ((h % 12) + m / 60) * 30;
    const minAngle = (m + s / 60) * 6;
    const secAngle = s * 6;

    setHandRotation('clock-hour', hourAngle);
    setHandRotation('clock-minute', minAngle);
    setHandRotation('clock-second', secAngle);

    requestAnimationFrame(updateClock);
  }

  function setHandRotation(id, degrees) {
    const hand = document.getElementById(id);
    hand.setAttribute('transform', `rotate(${degrees} 65 65)`);
  }

  requestAnimationFrame(updateClock);
}

// ============================================================
// COMPASS ROSE — System Status Needle
// ============================================================
function initCompass() {
  // Generate tick marks around compass
  const ticks = document.getElementById('compass-ticks');
  for (let i = 0; i < 72; i++) {
    const angle = (i / 72) * 360;
    const isCardinal = i % 18 === 0;
    const isMinor = i % 9 === 0;
    const r1 = isCardinal ? 58 : (isMinor ? 60 : 62);
    const r2 = 65;
    const rad = (angle - 90) * Math.PI / 180;
    const x1 = 75 + Math.cos(rad) * r1;
    const y1 = 75 + Math.sin(rad) * r1;
    const x2 = 75 + Math.cos(rad) * r2;
    const y2 = 75 + Math.sin(rad) * r2;

    const tick = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    tick.setAttribute('x1', x1);
    tick.setAttribute('y1', y1);
    tick.setAttribute('x2', x2);
    tick.setAttribute('y2', y2);
    tick.setAttribute('stroke', '#c9a84c');
    tick.setAttribute('stroke-width', isCardinal ? '1' : '0.3');
    ticks.appendChild(tick);
  }

  // Animate needle towards dominant status
  function updateNeedle() {
    // Count statuses: N=Active(0), E=Planning(90), S=Idle(180), W=Error(270)
    const statusAngles = { active: 0, planning: 90, idle: 180, error: 270 };
    const counts = { active: 0, planning: 0, idle: 0, error: 0 };
    agents.forEach(a => counts[a.status] = (counts[a.status] || 0) + 1);

    // Find dominant
    let dominant = 'active';
    let maxCount = 0;
    for (const [status, count] of Object.entries(counts)) {
      if (count > maxCount) { maxCount = count; dominant = status; }
    }

    const targetAngle = statusAngles[dominant] || 0;

    // Smooth interpolation
    let diff = targetAngle - compassAngle;
    if (diff > 180) diff -= 360;
    if (diff < -180) diff += 360;
    compassAngle += diff * 0.02;

    // Add slight oscillation
    const wobble = Math.sin(Date.now() * 0.002) * 3;

    const needle = document.getElementById('compass-needle');
    needle.setAttribute('transform', `rotate(${compassAngle + wobble} 75 75)`);

    requestAnimationFrame(updateNeedle);
  }

  requestAnimationFrame(updateNeedle);
}

// ============================================================
// EPOCH CLOCK (top banner)
// ============================================================
function initEpochClock() {
  function update() {
    const now = new Date();
    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
                    'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    const d = now.getUTCDate();
    const m = months[now.getUTCMonth()];
    const y = now.getUTCFullYear();
    const time = now.toUTCString().split(' ')[4];
    document.getElementById('metric-epoch').textContent =
      `${d} ${m} ${y}, ${time} UTC`;
  }
  update();
  setInterval(update, 1000);
}

// ============================================================
// AGENT STATUS CYCLING (simulated)
// ============================================================
function initStatusCycling() {
  const statuses = ['active', 'planning', 'idle', 'active', 'active'];

  setInterval(() => {
    // Randomly shift one agent's status
    const idx = Math.floor(Math.random() * agents.length);
    const newStatus = statuses[Math.floor(Math.random() * statuses.length)];
    agents[idx].status = newStatus;

    // Update catalog
    const entry = document.getElementById(`catalog-${agents[idx].id}`);
    if (entry) {
      const statusSpan = entry.querySelector('.detail-value + span');
      // The status text is inside the magnitude detail
    }

    // Randomly change transit files
    const files = [
      'auth-middleware.ts', 'api-gateway.ts', 'ml-pipeline.py',
      'worker-pool.rs', 'event-bus.go', 'router.tsx', 'schema.ts',
      'deploy.yml', 'test-runner.ts', 'config.json', 'index.ts',
      'session.service.ts', 'agent-sdk.ts', 'db-migrate.ts'
    ];
    agents[idx].currentTransit = files[Math.floor(Math.random() * files.length)];

    // Update luminosity with more variance
    agents[idx].luminosity = Math.floor(100 + Math.random() * 400);
    const lumEl = document.getElementById(`lum-${agents[idx].id}`);
    if (lumEl) lumEl.textContent = agents[idx].luminosity + ' tokens/min';

    // Update star size based on activity
    const starEl = document.getElementById(`star-${agents[idx].id}`);
    if (starEl) {
      const newSize = agents[idx].status === 'active' ? agents[idx].starSize :
                      agents[idx].status === 'planning' ? agents[idx].starSize * 0.8 :
                      agents[idx].starSize * 0.6;
      starEl.style.setProperty('--star-size', newSize + 'px');
    }
  }, 5000);
}

// ============================================================
// INITIALIZE ALL SYSTEMS
// ============================================================
document.addEventListener('DOMContentLoaded', () => {
  initStarfield();
  initConstellation();
  initStarCatalog();
  initLog();
  initShootingStars();
  initNovaEvents();
  initOrrery();
  initSpectroscope();
  initChronometer();
  initCompass();
  initEpochClock();
  initStatusCycling();
});
</script>

</body>
</html>
