<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CLI Monitor - Subway/Metro Map View</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600&display=swap" rel="stylesheet">
  <link href="https://api.fontshare.com/v2/css?f[]=mona-sans@400,500,600,700&display=swap" rel="stylesheet">

  <style>
    /* ========================================
       CSS Reset
       ======================================== */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { line-height: 1.5; -webkit-font-smoothing: antialiased; }
    ul, ol { list-style: none; }
    img, svg { display: block; max-width: 100%; }
    button { cursor: pointer; border: none; background: none; font: inherit; }
    a { text-decoration: none; color: inherit; }

    /* ========================================
       Design Tokens
       ======================================== */
    :root {
      --bg-canvas: #0d1117;
      --bg-default: #161b22;
      --bg-subtle: #1c2128;
      --bg-muted: #21262d;
      --bg-emphasis: #30363d;
      --border-default: #30363d;
      --border-subtle: rgba(240, 246, 252, 0.1);
      --fg-default: #e6edf3;
      --fg-muted: #8b949e;
      --fg-subtle: #6e7681;
      --accent-fg: #58a6ff;
      --accent-muted: rgba(56, 139, 253, 0.15);
      --success-fg: #3fb950;
      --success-muted: rgba(46, 160, 67, 0.15);
      --danger-fg: #f85149;
      --danger-muted: rgba(248, 81, 73, 0.15);
      --attention-fg: #d29922;
      --attention-muted: rgba(210, 153, 34, 0.15);
      --done-fg: #a371f7;
      --done-muted: rgba(163, 113, 247, 0.15);
      --secondary-fg: #f778ba;
      --secondary-muted: rgba(247, 120, 186, 0.15);
      --radius: 6px;
      --radius-sm: 4px;
      --radius-lg: 12px;
      --font-sans: 'Mona Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
      --font-mono: 'Fira Code', ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      --tracking-tight: -0.02em;
      --tracking-wide: 0.02em;
      --space-1: 4px; --space-2: 8px; --space-3: 12px; --space-4: 16px;
      --space-5: 20px; --space-6: 24px; --space-8: 32px;
      --duration-fast: 150ms; --duration-normal: 200ms; --duration-slow: 300ms;
      --ease-out: cubic-bezier(0.25, 1, 0.5, 1);
      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.4);
      --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.5);
    }

    body {
      font-family: var(--font-sans);
      font-size: 14px;
      color: var(--fg-default);
      background-color: var(--bg-canvas);
      min-height: 100vh;
      display: grid;
      grid-template-columns: 240px 1fr;
      overflow: hidden;
    }

    /* ========================================
       Animations
       ======================================== */
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
    @keyframes breathe { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }
    @keyframes slideInUp {
      from { transform: translateY(8px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes logoGlow { 0%, 100% { opacity: 0.5; transform: scale(0.9); } 50% { opacity: 1; transform: scale(1.1); } }
    @keyframes nodePulse { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }
    @keyframes corePulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }

    /* Train movement along tracks */
    @keyframes trainMove {
      0% { offset-distance: 0%; }
      100% { offset-distance: 100%; }
    }

    @keyframes trainMoveReverse {
      0% { offset-distance: 100%; }
      100% { offset-distance: 0%; }
    }

    /* Pulsing station for waiting status */
    @keyframes stationPulse {
      0%, 100% { r: 6; opacity: 1; }
      50% { r: 10; opacity: 0.5; }
    }

    @keyframes stationRingPulse {
      0% { r: 8; opacity: 0.6; }
      100% { r: 18; opacity: 0; }
    }

    /* Glow for active lines */
    @keyframes lineGlow {
      0%, 100% { filter: drop-shadow(0 0 2px currentColor); }
      50% { filter: drop-shadow(0 0 6px currentColor); }
    }

    /* Train dot glow */
    @keyframes trainGlow {
      0%, 100% { filter: drop-shadow(0 0 3px currentColor) drop-shadow(0 0 6px currentColor); }
      50% { filter: drop-shadow(0 0 6px currentColor) drop-shadow(0 0 12px currentColor); }
    }

    /* ========================================
       Sidebar (matching existing AgentPane design)
       ======================================== */
    .sidebar {
      background-color: var(--bg-default);
      border-right: 1px solid var(--border-default);
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow-y: auto;
    }

    .sidebar-header {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-4);
      border-bottom: 1px solid var(--border-default);
    }

    .logo {
      width: 44px; height: 44px;
      position: relative;
      display: flex; align-items: center; justify-content: center;
      border-radius: 12px;
      background: radial-gradient(ellipse at 30% 30%, rgba(88, 166, 255, 0.08) 0%, transparent 50%), linear-gradient(165deg, #12161c 0%, #0a0d11 100%);
      box-shadow: 0 1px 0 0 rgba(255,255,255,0.04) inset, 0 -1px 0 0 rgba(0,0,0,0.3) inset, 0 4px 16px -2px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255,255,255,0.06);
      overflow: hidden;
    }
    .logo::before {
      content: '';
      position: absolute; inset: 0; border-radius: 12px;
      background: radial-gradient(circle at 50% 50%, rgba(163, 113, 247, 0.15) 0%, transparent 60%);
      animation: logoGlow 4s ease-in-out infinite;
    }
    .logo-icon { position: relative; z-index: 1; width: 28px; height: 28px; filter: drop-shadow(0 0 8px rgba(163, 113, 247, 0.4)); }
    .logo-node { animation: nodePulse 2s ease-in-out infinite; }
    .logo-node-1 { animation-delay: 0s; } .logo-node-2 { animation-delay: 0.4s; }
    .logo-node-3 { animation-delay: 0.8s; } .logo-node-4 { animation-delay: 1.2s; }
    .logo-node-5 { animation-delay: 1.6s; }
    .logo-core { animation: corePulse 3s ease-in-out infinite; }

    .sidebar-title { font-size: 16px; font-weight: 600; color: var(--fg-default); letter-spacing: var(--tracking-tight); }

    .project-switcher {
      display: flex; align-items: center; gap: var(--space-2);
      padding: var(--space-3); margin: var(--space-3);
      background-color: var(--bg-subtle); border: 1px solid var(--border-default);
      border-radius: var(--radius); cursor: pointer;
      transition: border-color var(--duration-fast) var(--ease-out);
    }
    .project-switcher:hover { border-color: var(--fg-subtle); }
    .project-avatar {
      width: 32px; height: 32px;
      background: linear-gradient(135deg, var(--accent-fg), var(--done-fg));
      border-radius: var(--radius);
      display: flex; align-items: center; justify-content: center;
      font-size: 12px; font-weight: 600; color: #fff;
    }
    .project-info { flex: 1; display: flex; flex-direction: column; gap: 2px; min-width: 0; }
    .project-name { font-size: 14px; font-weight: 500; color: var(--fg-default); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .project-path-text { font-size: 12px; font-family: var(--font-mono); color: var(--fg-subtle); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .project-switcher kbd { padding: 2px 6px; background-color: var(--bg-muted); border: 1px solid var(--border-default); border-radius: var(--radius-sm); font-size: 12px; color: var(--fg-muted); }

    .sidebar-nav { flex: 1; padding: var(--space-3); overflow-y: auto; }
    .nav-section { margin-bottom: var(--space-4); }
    .nav-section:last-child { margin-bottom: 0; }
    .nav-section-title { display: block; padding: 0 var(--space-2); margin-bottom: var(--space-2); font-size: 12px; font-weight: 600; color: var(--fg-muted); text-transform: uppercase; letter-spacing: var(--tracking-wide); }
    .nav-item { display: flex; align-items: center; gap: var(--space-2); padding: var(--space-2); margin-bottom: 2px; font-size: 14px; font-weight: 500; color: var(--fg-muted); border-radius: var(--radius); transition: all var(--duration-fast) var(--ease-out); cursor: pointer; }
    .nav-item:hover { background-color: var(--bg-subtle); color: var(--fg-default); }
    .nav-item.active { background-color: var(--accent-muted); color: var(--accent-fg); }
    .nav-item .icon { width: 16px; height: 16px; flex-shrink: 0; }
    .nav-badge { margin-left: auto; padding: 2px 6px; font-size: 12px; font-weight: 500; border-radius: 10px; min-width: 20px; text-align: center; }
    .nav-badge.active { background-color: var(--success-muted); color: var(--success-fg); }
    .nav-badge.default { background-color: var(--bg-emphasis); color: var(--fg-muted); }

    .sidebar-footer { padding: var(--space-3); border-top: 1px solid var(--border-default); }
    .user-menu { display: flex; align-items: center; gap: var(--space-2); padding: var(--space-2); border-radius: var(--radius); cursor: pointer; transition: background-color var(--duration-fast) var(--ease-out); }
    .user-menu:hover { background-color: var(--bg-subtle); }
    .user-avatar { width: 32px; height: 32px; background: linear-gradient(135deg, var(--success-fg), var(--accent-fg)); border-radius: var(--radius); display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; color: #fff; }
    .user-name { font-size: 14px; font-weight: 500; color: var(--fg-default); }

    /* ========================================
       Main Layout
       ======================================== */
    .app-layout { display: flex; flex-direction: column; height: 100vh; overflow: hidden; }

    /* Header */
    .header {
      display: flex; align-items: center; justify-content: space-between;
      padding: var(--space-3) var(--space-6);
      background-color: var(--bg-default); border-bottom: 1px solid var(--border-default);
    }
    .header-left { display: flex; align-items: center; gap: var(--space-3); }
    .header-title { display: flex; align-items: center; gap: var(--space-3); }
    .header-title h1 { font-size: 18px; font-weight: 600; }
    .header-title .icon { width: 24px; height: 24px; color: var(--fg-muted); }
    .header-controls { display: flex; align-items: center; gap: var(--space-3); }

    .live-indicator {
      display: flex; align-items: center; gap: var(--space-2);
      padding: var(--space-1) var(--space-3);
      background-color: var(--success-muted);
      border-radius: var(--radius-sm);
      font-size: 12px; font-weight: 600; color: var(--success-fg);
    }
    .live-dot {
      width: 8px; height: 8px; border-radius: 50%;
      background-color: var(--success-fg);
      animation: pulse 2s ease-in-out infinite;
    }

    .btn {
      display: inline-flex; align-items: center; justify-content: center; gap: var(--space-2);
      padding: var(--space-2) var(--space-3);
      font-size: 14px; font-weight: 500; border-radius: var(--radius);
      transition: all var(--duration-fast) var(--ease-out);
    }
    .btn-secondary { background-color: var(--bg-subtle); border: 1px solid var(--border-default); color: var(--fg-default); }
    .btn-secondary:hover { background-color: var(--bg-muted); border-color: var(--fg-subtle); }

    .view-selector {
      display: flex; align-items: center; gap: 2px;
      background: var(--bg-subtle); border: 1px solid var(--border-default);
      border-radius: var(--radius); padding: 2px;
    }
    .view-btn {
      padding: var(--space-1) var(--space-3); font-size: 12px; font-weight: 500;
      border-radius: var(--radius-sm); color: var(--fg-muted);
      transition: all var(--duration-fast) var(--ease-out);
    }
    .view-btn:hover { color: var(--fg-default); }
    .view-btn.active { background: var(--accent-muted); color: var(--accent-fg); }

    /* ========================================
       Stats Bar (Top)
       ======================================== */
    .stats-bar {
      display: flex; align-items: center; gap: var(--space-6);
      padding: var(--space-3) var(--space-6);
      background: var(--bg-subtle);
      border-bottom: 1px solid var(--border-default);
    }

    .stat-item {
      display: flex; align-items: center; gap: var(--space-2);
    }

    .stat-icon {
      width: 16px; height: 16px; color: var(--fg-subtle);
    }

    .stat-label {
      font-size: 12px; color: var(--fg-muted); font-weight: 500;
    }

    .stat-value {
      font-size: 14px; font-weight: 600; font-family: var(--font-mono);
    }

    .stat-value.success { color: var(--success-fg); }
    .stat-value.attention { color: var(--attention-fg); }
    .stat-value.accent { color: var(--accent-fg); }
    .stat-value.secondary { color: var(--secondary-fg); }
    .stat-value.danger { color: var(--danger-fg); }

    .stat-divider {
      width: 1px; height: 24px; background: var(--border-default);
    }

    /* ========================================
       Main Content Area (Map + Legend)
       ======================================== */
    .content-area {
      flex: 1; display: grid;
      grid-template-columns: 1fr 280px;
      overflow: hidden;
    }

    /* ========================================
       Subway Map Area
       ======================================== */
    .subway-map {
      flex: 1; overflow: auto;
      padding: var(--space-6);
      position: relative;
      background:
        radial-gradient(circle at 20% 30%, rgba(88, 166, 255, 0.03) 0%, transparent 40%),
        radial-gradient(circle at 80% 70%, rgba(163, 113, 247, 0.03) 0%, transparent 40%),
        var(--bg-canvas);
    }

    /* Grid pattern overlay */
    .subway-map::before {
      content: '';
      position: absolute; inset: 0;
      background-image:
        linear-gradient(rgba(48, 54, 61, 0.15) 1px, transparent 1px),
        linear-gradient(90deg, rgba(48, 54, 61, 0.15) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
    }

    .map-container {
      position: relative;
      min-width: 900px;
      min-height: 600px;
    }

    /* Project group labels */
    .project-group {
      margin-bottom: var(--space-8);
      animation: slideInUp 0.5s var(--ease-out) both;
    }

    .project-group:nth-child(1) { animation-delay: 0.1s; }
    .project-group:nth-child(2) { animation-delay: 0.2s; }
    .project-group:nth-child(3) { animation-delay: 0.3s; }

    .project-group-header {
      display: flex; align-items: center; gap: var(--space-3);
      margin-bottom: var(--space-4);
      padding: var(--space-2) var(--space-3);
      background: var(--bg-default);
      border: 1px solid var(--border-default);
      border-radius: var(--radius);
      width: fit-content;
    }

    .project-group-icon {
      width: 24px; height: 24px;
      border-radius: var(--radius-sm);
      display: flex; align-items: center; justify-content: center;
      font-size: 11px; font-weight: 700; color: #fff;
    }

    .project-group-name {
      font-size: 14px; font-weight: 600; color: var(--fg-default);
    }

    .project-group-path {
      font-size: 12px; font-family: var(--font-mono); color: var(--fg-subtle);
    }

    /* SVG Metro Lines */
    .metro-svg {
      width: 100%;
      overflow: visible;
    }

    /* Track lines */
    .track-line {
      fill: none;
      stroke-width: 4;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    .track-line.working {
      animation: lineGlow 3s ease-in-out infinite;
    }

    .track-line.idle {
      opacity: 0.3;
    }

    .track-line.waiting {
      opacity: 0.7;
    }

    /* Track background (darker, wider line behind) */
    .track-bg {
      fill: none;
      stroke: var(--bg-muted);
      stroke-width: 8;
      stroke-linecap: round;
      stroke-linejoin: round;
      opacity: 0.5;
    }

    /* Station dots */
    .station {
      cursor: pointer;
      transition: transform var(--duration-fast) var(--ease-out);
    }

    .station:hover {
      transform: scale(1.2);
    }

    .station-outer {
      fill: var(--bg-default);
      stroke-width: 3;
    }

    .station-inner {
      fill: var(--bg-canvas);
    }

    .station-label {
      font-family: var(--font-mono);
      font-size: 10px;
      fill: var(--fg-muted);
      font-weight: 500;
    }

    .station-label-detail {
      font-family: var(--font-mono);
      font-size: 9px;
      fill: var(--fg-subtle);
    }

    /* Train dots (animated along path) */
    .train-dot {
      offset-rotate: 0deg;
      animation: trainMove 4s linear infinite, trainGlow 2s ease-in-out infinite;
    }

    .train-dot-2 {
      animation-delay: -2s;
    }

    .train-dot-3 {
      animation-delay: -1s;
    }

    /* Interchange stations (shared files) */
    .interchange {
      cursor: pointer;
    }

    .interchange-outer {
      fill: var(--bg-default);
      stroke: var(--fg-muted);
      stroke-width: 2;
    }

    .interchange-inner {
      fill: var(--bg-canvas);
    }

    .interchange-label {
      font-family: var(--font-mono);
      font-size: 10px;
      fill: var(--fg-default);
      font-weight: 600;
    }

    .interchange-sublabel {
      font-family: var(--font-mono);
      font-size: 8px;
      fill: var(--fg-subtle);
    }

    /* Waiting station pulse animation */
    .waiting-pulse {
      animation: stationPulse 2s ease-in-out infinite;
    }

    .waiting-ring {
      fill: none;
      stroke-width: 2;
      opacity: 0;
      animation: stationRingPulse 2s ease-out infinite;
    }

    /* ========================================
       Route Legend Panel (Right Side)
       ======================================== */
    .legend-panel {
      background: var(--bg-default);
      border-left: 1px solid var(--border-default);
      display: flex; flex-direction: column;
      overflow-y: auto;
    }

    .legend-header {
      padding: var(--space-4);
      border-bottom: 1px solid var(--border-default);
    }

    .legend-title {
      font-size: 14px; font-weight: 600; color: var(--fg-default);
      display: flex; align-items: center; gap: var(--space-2);
    }

    .legend-title .icon {
      width: 16px; height: 16px; color: var(--fg-muted);
    }

    .legend-routes {
      flex: 1; padding: var(--space-3);
    }

    .legend-route {
      padding: var(--space-3);
      margin-bottom: var(--space-2);
      background: var(--bg-subtle);
      border: 1px solid var(--border-default);
      border-radius: var(--radius);
      cursor: pointer;
      transition: all var(--duration-fast) var(--ease-out);
    }

    .legend-route:hover {
      border-color: var(--fg-subtle);
      background: var(--bg-muted);
    }

    .legend-route-header {
      display: flex; align-items: center; gap: var(--space-2);
      margin-bottom: var(--space-2);
    }

    .route-color-line {
      width: 24px; height: 4px; border-radius: 2px;
    }

    .route-name {
      font-size: 13px; font-weight: 600; color: var(--fg-default);
      flex: 1;
    }

    .route-status {
      font-size: 11px; font-weight: 600; padding: 2px 6px;
      border-radius: 10px;
    }

    .route-status.working {
      background: var(--success-muted); color: var(--success-fg);
    }

    .route-status.waiting-approval {
      background: var(--attention-muted); color: var(--attention-fg);
    }

    .route-status.waiting-input {
      background: var(--secondary-muted); color: var(--secondary-fg);
    }

    .route-status.idle {
      background: var(--bg-emphasis); color: var(--fg-subtle);
    }

    .route-details {
      display: flex; flex-direction: column; gap: var(--space-1);
    }

    .route-detail {
      display: flex; align-items: center; gap: var(--space-2);
      font-size: 12px; color: var(--fg-muted);
    }

    .route-detail .icon {
      width: 12px; height: 12px; color: var(--fg-subtle); flex-shrink: 0;
    }

    .route-detail-value {
      font-family: var(--font-mono); font-size: 11px; color: var(--fg-subtle);
    }

    .route-project-badge {
      font-size: 10px; font-weight: 600; padding: 1px 6px;
      border-radius: var(--radius-sm);
      background: var(--bg-emphasis);
      color: var(--fg-muted);
    }

    .route-stops {
      display: flex; align-items: center; gap: 4px;
      margin-top: var(--space-2);
      flex-wrap: wrap;
    }

    .route-stop-mini {
      width: 6px; height: 6px; border-radius: 50%;
      border: 1.5px solid;
      background: var(--bg-default);
    }

    .route-stop-connector {
      width: 8px; height: 2px; border-radius: 1px;
    }

    /* Legend Key */
    .legend-key {
      padding: var(--space-3) var(--space-4);
      border-top: 1px solid var(--border-default);
    }

    .legend-key-title {
      font-size: 11px; font-weight: 600; color: var(--fg-muted);
      text-transform: uppercase; letter-spacing: var(--tracking-wide);
      margin-bottom: var(--space-2);
    }

    .legend-key-items {
      display: flex; flex-direction: column; gap: var(--space-2);
    }

    .legend-key-item {
      display: flex; align-items: center; gap: var(--space-2);
      font-size: 12px; color: var(--fg-muted);
    }

    .key-swatch {
      width: 16px; height: 4px; border-radius: 2px;
    }

    .key-station {
      width: 10px; height: 10px; border-radius: 50%;
      border: 2px solid var(--fg-muted);
      background: var(--bg-default);
    }

    .key-interchange {
      width: 12px; height: 12px; border-radius: 3px;
      border: 2px solid var(--fg-muted);
      background: var(--bg-default);
    }

    .key-train {
      width: 8px; height: 8px; border-radius: 50%;
      background: var(--success-fg);
      box-shadow: 0 0 4px var(--success-fg);
    }

    /* ========================================
       Scrollbar
       ======================================== */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--bg-emphasis); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--fg-subtle); }

    /* ========================================
       Design Notes
       ======================================== */
    .design-notes {
      position: fixed; bottom: var(--space-4); right: var(--space-4);
      width: 360px; background: var(--bg-default);
      border: 1px solid var(--accent-fg); border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg); overflow: hidden; z-index: 1000;
    }
    .design-notes-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: var(--space-3) var(--space-4);
      background: var(--accent-muted); border-bottom: 1px solid var(--accent-fg);
    }
    .design-notes-header h3 { font-size: 12px; font-weight: 600; color: var(--accent-fg); text-transform: uppercase; letter-spacing: 0.5px; }
    .design-notes-content { padding: var(--space-4); max-height: 400px; overflow-y: auto; }
    .design-note { margin-bottom: var(--space-4); }
    .design-note:last-child { margin-bottom: 0; }
    .design-note h4 { font-size: 13px; font-weight: 600; color: var(--fg-default); margin-bottom: var(--space-2); display: flex; align-items: center; gap: var(--space-2); }
    .design-note h4 .icon { width: 14px; height: 14px; color: var(--accent-fg); }
    .design-note p { font-size: 12px; color: var(--fg-muted); line-height: 1.6; }
    .design-note ul { margin-top: var(--space-2); padding-left: var(--space-4); }
    .design-note li { font-size: 12px; color: var(--fg-muted); line-height: 1.6; margin-bottom: var(--space-1); list-style: disc; }
    .design-note code { font-family: var(--font-mono); font-size: 11px; background: var(--bg-muted); padding: 1px 4px; border-radius: 3px; color: var(--accent-fg); }
  </style>
</head>
<body>
  <!-- ============================================
       Sidebar
       ============================================ -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="logo">
        <svg class="logo-icon" viewBox="0 0 32 32" fill="none">
          <defs><radialGradient id="coreGrad" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#fff"/><stop offset="50%" stop-color="#3fb950"/><stop offset="100%" stop-color="#3fb950" stop-opacity="0"/></radialGradient></defs>
          <line x1="14" y1="14" x2="6" y2="8" stroke="#58a6ff" stroke-opacity="0.4" stroke-width="1"/>
          <line x1="14" y1="14" x2="22" y2="6" stroke="#a371f7" stroke-opacity="0.4" stroke-width="1"/>
          <line x1="14" y1="14" x2="26" y2="16" stroke="#3fb950" stroke-opacity="0.4" stroke-width="1"/>
          <line x1="14" y1="14" x2="20" y2="26" stroke="#f778ba" stroke-opacity="0.4" stroke-width="1"/>
          <line x1="14" y1="14" x2="6" y2="22" stroke="#d29922" stroke-opacity="0.4" stroke-width="1"/>
          <line x1="6" y1="8" x2="22" y2="6" stroke="#58a6ff" stroke-opacity="0.15" stroke-width="1"/>
          <line x1="26" y1="16" x2="20" y2="26" stroke="#3fb950" stroke-opacity="0.15" stroke-width="1"/>
          <circle class="logo-node logo-node-1" cx="6" cy="8" r="2" fill="#58a6ff" style="filter: drop-shadow(0 0 2px #58a6ff);"/>
          <circle class="logo-node logo-node-2" cx="22" cy="6" r="2.5" fill="#a371f7" style="filter: drop-shadow(0 0 3px #a371f7);"/>
          <circle class="logo-node logo-node-3" cx="26" cy="16" r="2" fill="#3fb950" style="filter: drop-shadow(0 0 2px #3fb950);"/>
          <circle class="logo-node logo-node-4" cx="20" cy="26" r="3" fill="#f778ba" style="filter: drop-shadow(0 0 3px #f778ba);"/>
          <circle class="logo-node logo-node-5" cx="6" cy="22" r="2" fill="#d29922" style="filter: drop-shadow(0 0 2px #d29922);"/>
          <circle class="logo-core" cx="14" cy="14" r="5" fill="url(#coreGrad)"/><circle cx="14" cy="14" r="2" fill="#fff"/>
        </svg>
      </div>
      <span class="sidebar-title">AgentPane</span>
    </div>

    <div class="project-switcher">
      <div class="project-avatar">AP</div>
      <div class="project-info">
        <span class="project-name">AgentPane</span>
        <span class="project-path-text">~/git/agentpane</span>
      </div>
      <kbd>&#8984;P</kbd>
    </div>

    <nav class="sidebar-nav">
      <div class="nav-section">
        <span class="nav-section-title">Organization</span>
        <a class="nav-item" href="#">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
          Projects
        </a>
        <a class="nav-item" href="#">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12,6 12,12 16,14"/></svg>
          Sessions
        </a>
        <a class="nav-item active" href="#">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="4,17 10,11 4,5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>
          CLI Monitor
          <span class="nav-badge active">4</span>
        </a>
      </div>
      <div class="nav-section">
        <span class="nav-section-title">Content</span>
        <a class="nav-item" href="#">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/></svg>
          Org Templates
        </a>
        <a class="nav-item" href="#">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12,2 2,7 12,12 22,7 12,2"/><polyline points="2,17 12,22 22,17"/><polyline points="2,12 12,17 22,12"/></svg>
          Designer
        </a>
      </div>
      <div class="nav-section">
        <span class="nav-section-title">Admin</span>
        <a class="nav-item" href="#">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6m8.66-15.66l-4.24 4.24M7.76 16.24l-4.24 4.24M23 12h-6m-6 0H1m20.66 8.66l-4.24-4.24M7.76 7.76L3.52 3.52"/></svg>
          Settings
        </a>
      </div>
    </nav>

    <div class="sidebar-footer">
      <div class="user-menu">
        <div class="user-avatar">SL</div>
        <span class="user-name">Simon Lynch</span>
      </div>
    </div>
  </aside>

  <!-- ============================================
       Main Application
       ============================================ -->
  <div class="app-layout">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <div class="header-title">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="4,17 10,11 4,5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>
          <h1>CLI Monitor</h1>
        </div>
        <div class="live-indicator">
          <span class="live-dot"></span>
          LIVE
        </div>
      </div>
      <div class="header-controls">
        <div class="view-selector">
          <button class="view-btn">Dashboard</button>
          <button class="view-btn">Timeline</button>
          <button class="view-btn active">Subway</button>
          <button class="view-btn">Terminal</button>
        </div>
        <button class="btn btn-secondary">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px"><polyline points="23,4 23,10 17,10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>
          Refresh
        </button>
      </div>
    </header>

    <!-- Stats Bar -->
    <div class="stats-bar">
      <div class="stat-item">
        <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="4,17 10,11 4,5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>
        <span class="stat-label">Sessions</span>
        <span class="stat-value accent">4</span>
      </div>
      <div class="stat-divider"></div>
      <div class="stat-item">
        <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
        <span class="stat-label">Working</span>
        <span class="stat-value success">2</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Waiting</span>
        <span class="stat-value attention">1</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Idle</span>
        <span class="stat-value" style="color: var(--fg-subtle)">1</span>
      </div>
      <div class="stat-divider"></div>
      <div class="stat-item">
        <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
        <span class="stat-label">Total Tokens</span>
        <span class="stat-value secondary">847.2K</span>
      </div>
      <div class="stat-divider"></div>
      <div class="stat-item">
        <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
        <span class="stat-label">Tool Calls</span>
        <span class="stat-value accent">63</span>
      </div>
      <div class="stat-item">
        <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="18" r="3"/><circle cx="6" cy="6" r="3"/><path d="M6 21V9a9 9 0 0 0 9 9"/></svg>
        <span class="stat-label">Projects</span>
        <span class="stat-value" style="color: var(--done-fg)">3</span>
      </div>
    </div>

    <!-- Content: Map + Legend -->
    <div class="content-area">
      <!-- Subway Map -->
      <div class="subway-map">
        <div class="map-container">

          <!-- ======== Project 1: AgentPane ======== -->
          <div class="project-group">
            <div class="project-group-header">
              <div class="project-group-icon" style="background: linear-gradient(135deg, #58a6ff, #a371f7);">AP</div>
              <span class="project-group-name">AgentPane</span>
              <span class="project-group-path">~/.claude/projects/agentpane</span>
            </div>

            <svg class="metro-svg" viewBox="0 0 900 180" xmlns="http://www.w3.org/2000/svg">
              <!-- Define train paths for animation -->
              <defs>
                <!-- Line 1 path (Green - Working) -->
                <path id="line1-path" d="M 30,50 L 140,50 L 180,50 L 300,50 L 380,50 L 480,50 L 560,50 L 660,50 L 740,50 L 840,50" />
                <!-- Line 2 path (Yellow - Waiting) -->
                <path id="line2-path" d="M 30,130 L 140,130 L 220,130 L 340,130 L 440,130 L 540,130 L 640,130 L 720,130" />
              </defs>

              <!-- ---- Line 1: Session abc123 (Green/Working) ---- -->
              <!-- Track background -->
              <path class="track-bg" d="M 30,50 L 840,50" />
              <!-- Track line -->
              <path class="track-line working" d="M 30,50 L 840,50" stroke="#3fb950" style="color: #3fb950;" />

              <!-- Stations on Line 1 -->
              <!-- Start station -->
              <g class="station" transform="translate(30, 50)">
                <circle class="station-outer" r="8" stroke="#3fb950" />
                <circle class="station-inner" r="4" />
                <text class="station-label" x="0" y="-16" text-anchor="middle">START</text>
                <text class="station-label-detail" x="0" y="-28" text-anchor="middle">14:32:08</text>
              </g>

              <!-- Read station -->
              <g class="station" transform="translate(140, 50)">
                <circle class="station-outer" r="7" stroke="#3fb950" />
                <circle class="station-inner" r="3.5" />
                <text class="station-label" x="0" y="-16" text-anchor="middle">Read</text>
                <text class="station-label-detail" x="0" y="-28" text-anchor="middle">CLAUDE.md</text>
              </g>

              <!-- Glob station -->
              <g class="station" transform="translate(260, 50)">
                <circle class="station-outer" r="7" stroke="#3fb950" />
                <circle class="station-inner" r="3.5" />
                <text class="station-label" x="0" y="-16" text-anchor="middle">Glob</text>
                <text class="station-label-detail" x="0" y="-28" text-anchor="middle">src/**/*.ts</text>
              </g>

              <!-- Read station -->
              <g class="station" transform="translate(380, 50)">
                <circle class="station-outer" r="7" stroke="#3fb950" />
                <circle class="station-inner" r="3.5" />
                <text class="station-label" x="0" y="-16" text-anchor="middle">Read</text>
                <text class="station-label-detail" x="0" y="-28" text-anchor="middle">schema.ts</text>
              </g>

              <!-- Write station -->
              <g class="station" transform="translate(500, 50)">
                <circle class="station-outer" r="7" stroke="#3fb950" />
                <circle class="station-inner" r="3.5" />
                <text class="station-label" x="0" y="24" text-anchor="middle">Write</text>
                <text class="station-label-detail" x="0" y="36" text-anchor="middle">migration.ts</text>
              </g>

              <!-- Bash station -->
              <g class="station" transform="translate(620, 50)">
                <circle class="station-outer" r="7" stroke="#3fb950" />
                <circle class="station-inner" r="3.5" />
                <text class="station-label" x="0" y="-16" text-anchor="middle">Bash</text>
                <text class="station-label-detail" x="0" y="-28" text-anchor="middle">npm run test</text>
              </g>

              <!-- Write station -->
              <g class="station" transform="translate(740, 50)">
                <circle class="station-outer" r="7" stroke="#3fb950" />
                <circle class="station-inner" r="3.5" />
                <text class="station-label" x="0" y="24" text-anchor="middle">Write</text>
                <text class="station-label-detail" x="0" y="36" text-anchor="middle">index.ts</text>
              </g>

              <!-- Current/head station (larger, glowing) -->
              <g class="station" transform="translate(840, 50)">
                <circle r="10" fill="#3fb950" opacity="0.2" style="animation: stationRingPulse 2s ease-out infinite;" />
                <circle class="station-outer" r="8" stroke="#3fb950" stroke-width="3" />
                <circle r="4" fill="#3fb950" />
                <text class="station-label" x="0" y="-16" text-anchor="middle" fill="#3fb950" font-weight="600">Bash</text>
                <text class="station-label-detail" x="0" y="-28" text-anchor="middle">npm run build</text>
              </g>

              <!-- Train dots on Line 1 -->
              <circle r="5" fill="#3fb950" style="offset-path: path('M 30,50 L 140,50 L 260,50 L 380,50 L 500,50 L 620,50 L 740,50 L 840,50'); color: #3fb950;" class="train-dot">
                <animate attributeName="opacity" values="1;0.6;1" dur="1s" repeatCount="indefinite" />
              </circle>
              <circle r="3.5" fill="#3fb950" style="offset-path: path('M 30,50 L 140,50 L 260,50 L 380,50 L 500,50 L 620,50 L 740,50 L 840,50'); color: #3fb950;" class="train-dot train-dot-2" opacity="0.6" />

              <!-- ---- Line 2: Session def456 (Yellow/Waiting for Approval) ---- -->
              <!-- Track background -->
              <path class="track-bg" d="M 30,130 L 720,130" />
              <!-- Track line -->
              <path class="track-line waiting" d="M 30,130 L 720,130" stroke="#d29922" />

              <!-- Stations on Line 2 -->
              <g class="station" transform="translate(30, 130)">
                <circle class="station-outer" r="8" stroke="#d29922" />
                <circle class="station-inner" r="4" />
                <text class="station-label" x="0" y="24" text-anchor="middle">START</text>
                <text class="station-label-detail" x="0" y="36" text-anchor="middle">14:28:41</text>
              </g>

              <g class="station" transform="translate(150, 130)">
                <circle class="station-outer" r="7" stroke="#d29922" />
                <circle class="station-inner" r="3.5" />
                <text class="station-label" x="0" y="24" text-anchor="middle">Read</text>
                <text class="station-label-detail" x="0" y="36" text-anchor="middle">routes.ts</text>
              </g>

              <g class="station" transform="translate(280, 130)">
                <circle class="station-outer" r="7" stroke="#d29922" />
                <circle class="station-inner" r="3.5" />
                <text class="station-label" x="0" y="-16" text-anchor="middle">Grep</text>
                <text class="station-label-detail" x="0" y="-28" text-anchor="middle">TODO fixme</text>
              </g>

              <g class="station" transform="translate(420, 130)">
                <circle class="station-outer" r="7" stroke="#d29922" />
                <circle class="station-inner" r="3.5" />
                <text class="station-label" x="0" y="24" text-anchor="middle">Write</text>
                <text class="station-label-detail" x="0" y="36" text-anchor="middle">handler.ts</text>
              </g>

              <g class="station" transform="translate(560, 130)">
                <circle class="station-outer" r="7" stroke="#d29922" />
                <circle class="station-inner" r="3.5" />
                <text class="station-label" x="0" y="-16" text-anchor="middle">Bash</text>
                <text class="station-label-detail" x="0" y="-28" text-anchor="middle">git diff</text>
              </g>

              <!-- Waiting station (pulsing) -->
              <g class="station" transform="translate(720, 130)">
                <circle r="14" fill="#d29922" opacity="0.1" class="waiting-ring" style="stroke: #d29922;" />
                <circle r="12" fill="#d29922" opacity="0.05" class="waiting-ring" style="stroke: #d29922; animation-delay: 0.5s;" />
                <circle class="waiting-pulse" r="8" fill="none" stroke="#d29922" stroke-width="3" />
                <circle r="4" fill="#d29922" opacity="0.8" />
                <text class="station-label" x="0" y="24" text-anchor="middle" fill="#d29922" font-weight="600">APPROVAL</text>
                <text class="station-label-detail" x="0" y="36" text-anchor="middle">Waiting...</text>
              </g>

              <!-- Interchange station (shared file: schema.ts) -->
              <g class="interchange" transform="translate(380, 90)">
                <rect class="interchange-outer" x="-14" y="-10" width="28" height="20" rx="4" />
                <!-- Connector lines to both tracks -->
                <line x1="0" y1="-10" x2="0" y2="-32" stroke="#8b949e" stroke-width="1.5" stroke-dasharray="3,2" />
                <line x1="0" y1="10" x2="-100" y2="30" stroke="#8b949e" stroke-width="1.5" stroke-dasharray="3,2" />
                <text class="interchange-label" x="0" y="4" text-anchor="middle">schema.ts</text>
              </g>

            </svg>
          </div>

          <!-- ======== Project 2: web-app ======== -->
          <div class="project-group">
            <div class="project-group-header">
              <div class="project-group-icon" style="background: linear-gradient(135deg, #3fb950, #58a6ff);">WA</div>
              <span class="project-group-name">web-app</span>
              <span class="project-group-path">~/.claude/projects/web-app</span>
            </div>

            <svg class="metro-svg" viewBox="0 0 900 120" xmlns="http://www.w3.org/2000/svg">
              <!-- ---- Line 3: Session ghi789 (Green/Working) ---- -->
              <path class="track-bg" d="M 30,60 L 860,60" />
              <path class="track-line working" d="M 30,60 L 860,60" stroke="#58a6ff" style="color: #58a6ff;" />

              <!-- Stations -->
              <g class="station" transform="translate(30, 60)">
                <circle class="station-outer" r="8" stroke="#58a6ff" />
                <circle class="station-inner" r="4" />
                <text class="station-label" x="0" y="-16" text-anchor="middle">START</text>
                <text class="station-label-detail" x="0" y="-28" text-anchor="middle">14:45:22</text>
              </g>

              <g class="station" transform="translate(140, 60)">
                <circle class="station-outer" r="7" stroke="#58a6ff" />
                <circle class="station-inner" r="3.5" />
                <text class="station-label" x="0" y="24" text-anchor="middle">Read</text>
                <text class="station-label-detail" x="0" y="36" text-anchor="middle">package.json</text>
              </g>

              <g class="station" transform="translate(260, 60)">
                <circle class="station-outer" r="7" stroke="#58a6ff" />
                <circle class="station-inner" r="3.5" />
                <text class="station-label" x="0" y="-16" text-anchor="middle">Bash</text>
                <text class="station-label-detail" x="0" y="-28" text-anchor="middle">npm install</text>
              </g>

              <g class="station" transform="translate(380, 60)">
                <circle class="station-outer" r="7" stroke="#58a6ff" />
                <circle class="station-inner" r="3.5" />
                <text class="station-label" x="0" y="24" text-anchor="middle">Read</text>
                <text class="station-label-detail" x="0" y="36" text-anchor="middle">App.tsx</text>
              </g>

              <g class="station" transform="translate(500, 60)">
                <circle class="station-outer" r="7" stroke="#58a6ff" />
                <circle class="station-inner" r="3.5" />
                <text class="station-label" x="0" y="-16" text-anchor="middle">Write</text>
                <text class="station-label-detail" x="0" y="-28" text-anchor="middle">Header.tsx</text>
              </g>

              <g class="station" transform="translate(620, 60)">
                <circle class="station-outer" r="7" stroke="#58a6ff" />
                <circle class="station-inner" r="3.5" />
                <text class="station-label" x="0" y="24" text-anchor="middle">Write</text>
                <text class="station-label-detail" x="0" y="36" text-anchor="middle">styles.css</text>
              </g>

              <g class="station" transform="translate(740, 60)">
                <circle class="station-outer" r="7" stroke="#58a6ff" />
                <circle class="station-inner" r="3.5" />
                <text class="station-label" x="0" y="-16" text-anchor="middle">Bash</text>
                <text class="station-label-detail" x="0" y="-28" text-anchor="middle">npm run lint</text>
              </g>

              <!-- Active head -->
              <g class="station" transform="translate(860, 60)">
                <circle r="10" fill="#58a6ff" opacity="0.2" style="animation: stationRingPulse 2s ease-out infinite;" />
                <circle class="station-outer" r="8" stroke="#58a6ff" stroke-width="3" />
                <circle r="4" fill="#58a6ff" />
                <text class="station-label" x="0" y="24" text-anchor="middle" fill="#58a6ff" font-weight="600">Write</text>
                <text class="station-label-detail" x="0" y="36" text-anchor="middle">Footer.tsx</text>
              </g>

              <!-- Train dots -->
              <circle r="5" fill="#58a6ff" style="offset-path: path('M 30,60 L 140,60 L 260,60 L 380,60 L 500,60 L 620,60 L 740,60 L 860,60'); color: #58a6ff;" class="train-dot">
                <animate attributeName="opacity" values="1;0.6;1" dur="1s" repeatCount="indefinite" />
              </circle>
              <circle r="3.5" fill="#58a6ff" style="offset-path: path('M 30,60 L 140,60 L 260,60 L 380,60 L 500,60 L 620,60 L 740,60 L 860,60'); color: #58a6ff;" class="train-dot train-dot-3" opacity="0.6" />
            </svg>
          </div>

          <!-- ======== Project 3: api-service ======== -->
          <div class="project-group">
            <div class="project-group-header">
              <div class="project-group-icon" style="background: linear-gradient(135deg, #f778ba, #d29922);">AS</div>
              <span class="project-group-name">api-service</span>
              <span class="project-group-path">~/.claude/projects/api-service</span>
            </div>

            <svg class="metro-svg" viewBox="0 0 900 120" xmlns="http://www.w3.org/2000/svg">
              <!-- ---- Line 4: Session jkl012 (Idle/Dimmed) ---- -->
              <path class="track-bg" d="M 30,60 L 580,60" />
              <path class="track-line idle" d="M 30,60 L 580,60" stroke="#8b949e" />

              <!-- Stations (dimmed) -->
              <g class="station" transform="translate(30, 60)" style="opacity: 0.4;">
                <circle class="station-outer" r="8" stroke="#8b949e" />
                <circle class="station-inner" r="4" />
                <text class="station-label" x="0" y="-16" text-anchor="middle">START</text>
                <text class="station-label-detail" x="0" y="-28" text-anchor="middle">13:15:07</text>
              </g>

              <g class="station" transform="translate(140, 60)" style="opacity: 0.4;">
                <circle class="station-outer" r="7" stroke="#8b949e" />
                <circle class="station-inner" r="3.5" />
                <text class="station-label" x="0" y="24" text-anchor="middle">Read</text>
                <text class="station-label-detail" x="0" y="36" text-anchor="middle">config.ts</text>
              </g>

              <g class="station" transform="translate(260, 60)" style="opacity: 0.4;">
                <circle class="station-outer" r="7" stroke="#8b949e" />
                <circle class="station-inner" r="3.5" />
                <text class="station-label" x="0" y="-16" text-anchor="middle">Read</text>
                <text class="station-label-detail" x="0" y="-28" text-anchor="middle">server.ts</text>
              </g>

              <g class="station" transform="translate(380, 60)" style="opacity: 0.4;">
                <circle class="station-outer" r="7" stroke="#8b949e" />
                <circle class="station-inner" r="3.5" />
                <text class="station-label" x="0" y="24" text-anchor="middle">Write</text>
                <text class="station-label-detail" x="0" y="36" text-anchor="middle">auth.ts</text>
              </g>

              <g class="station" transform="translate(500, 60)" style="opacity: 0.4;">
                <circle class="station-outer" r="7" stroke="#8b949e" />
                <circle class="station-inner" r="3.5" />
                <text class="station-label" x="0" y="-16" text-anchor="middle">Bash</text>
                <text class="station-label-detail" x="0" y="-28" text-anchor="middle">npm test</text>
              </g>

              <!-- Idle end station (dimmed, no animation) -->
              <g class="station" transform="translate(580, 60)" style="opacity: 0.4;">
                <circle class="station-outer" r="8" stroke="#8b949e" stroke-width="2" />
                <circle r="4" fill="#8b949e" opacity="0.5" />
                <text class="station-label" x="0" y="24" text-anchor="middle" fill="#6e7681">IDLE</text>
                <text class="station-label-detail" x="0" y="36" text-anchor="middle">since 13:22</text>
              </g>

              <!-- No train dots for idle line -->
            </svg>
          </div>

        </div>
      </div>

      <!-- ============================================
           Route Legend Panel
           ============================================ -->
      <div class="legend-panel">
        <div class="legend-header">
          <div class="legend-title">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg>
            Route Legend
          </div>
        </div>

        <div class="legend-routes">
          <!-- Route 1: Green Line -->
          <div class="legend-route">
            <div class="legend-route-header">
              <div class="route-color-line" style="background: #3fb950;"></div>
              <span class="route-name">abc123</span>
              <span class="route-status working">Working</span>
            </div>
            <div class="route-details">
              <div class="route-detail">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                <span class="route-project-badge">AgentPane</span>
              </div>
              <div class="route-detail">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                <span class="route-detail-value">8 stops / 12m 34s</span>
              </div>
              <div class="route-detail">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/></svg>
                <span class="route-detail-value">324.1K tokens</span>
              </div>
              <div class="route-detail">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="18" r="3"/><circle cx="6" cy="6" r="3"/><path d="M6 21V9a9 9 0 0 0 9 9"/></svg>
                <span class="route-detail-value" style="color: var(--done-fg);">feat/db-migration</span>
              </div>
            </div>
            <div class="route-stops">
              <div class="route-stop-mini" style="border-color: #3fb950;"></div>
              <div class="route-stop-connector" style="background: #3fb950;"></div>
              <div class="route-stop-mini" style="border-color: #3fb950;"></div>
              <div class="route-stop-connector" style="background: #3fb950;"></div>
              <div class="route-stop-mini" style="border-color: #3fb950;"></div>
              <div class="route-stop-connector" style="background: #3fb950;"></div>
              <div class="route-stop-mini" style="border-color: #3fb950;"></div>
              <div class="route-stop-connector" style="background: #3fb950;"></div>
              <div class="route-stop-mini" style="border-color: #3fb950;"></div>
              <div class="route-stop-connector" style="background: #3fb950;"></div>
              <div class="route-stop-mini" style="border-color: #3fb950;"></div>
              <div class="route-stop-connector" style="background: #3fb950;"></div>
              <div class="route-stop-mini" style="border-color: #3fb950;"></div>
              <div class="route-stop-connector" style="background: #3fb950; opacity: 0.3;"></div>
              <div class="route-stop-mini" style="border-color: #3fb950; background: #3fb950;"></div>
            </div>
          </div>

          <!-- Route 2: Yellow Line -->
          <div class="legend-route">
            <div class="legend-route-header">
              <div class="route-color-line" style="background: #d29922;"></div>
              <span class="route-name">def456</span>
              <span class="route-status waiting-approval">Approval</span>
            </div>
            <div class="route-details">
              <div class="route-detail">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                <span class="route-project-badge">AgentPane</span>
              </div>
              <div class="route-detail">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                <span class="route-detail-value">6 stops / 16m 02s</span>
              </div>
              <div class="route-detail">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/></svg>
                <span class="route-detail-value">198.7K tokens</span>
              </div>
              <div class="route-detail">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="18" r="3"/><circle cx="6" cy="6" r="3"/><path d="M6 21V9a9 9 0 0 0 9 9"/></svg>
                <span class="route-detail-value" style="color: var(--done-fg);">fix/route-handler</span>
              </div>
            </div>
            <div class="route-stops">
              <div class="route-stop-mini" style="border-color: #d29922;"></div>
              <div class="route-stop-connector" style="background: #d29922;"></div>
              <div class="route-stop-mini" style="border-color: #d29922;"></div>
              <div class="route-stop-connector" style="background: #d29922;"></div>
              <div class="route-stop-mini" style="border-color: #d29922;"></div>
              <div class="route-stop-connector" style="background: #d29922;"></div>
              <div class="route-stop-mini" style="border-color: #d29922;"></div>
              <div class="route-stop-connector" style="background: #d29922;"></div>
              <div class="route-stop-mini" style="border-color: #d29922;"></div>
              <div class="route-stop-connector" style="background: #d29922;"></div>
              <div class="route-stop-mini" style="border-color: #d29922; background: #d29922;"></div>
            </div>
          </div>

          <!-- Route 3: Blue Line -->
          <div class="legend-route">
            <div class="legend-route-header">
              <div class="route-color-line" style="background: #58a6ff;"></div>
              <span class="route-name">ghi789</span>
              <span class="route-status working">Working</span>
            </div>
            <div class="route-details">
              <div class="route-detail">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                <span class="route-project-badge">web-app</span>
              </div>
              <div class="route-detail">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                <span class="route-detail-value">8 stops / 5m 18s</span>
              </div>
              <div class="route-detail">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/></svg>
                <span class="route-detail-value">246.8K tokens</span>
              </div>
              <div class="route-detail">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="18" r="3"/><circle cx="6" cy="6" r="3"/><path d="M6 21V9a9 9 0 0 0 9 9"/></svg>
                <span class="route-detail-value" style="color: var(--done-fg);">feat/redesign</span>
              </div>
            </div>
            <div class="route-stops">
              <div class="route-stop-mini" style="border-color: #58a6ff;"></div>
              <div class="route-stop-connector" style="background: #58a6ff;"></div>
              <div class="route-stop-mini" style="border-color: #58a6ff;"></div>
              <div class="route-stop-connector" style="background: #58a6ff;"></div>
              <div class="route-stop-mini" style="border-color: #58a6ff;"></div>
              <div class="route-stop-connector" style="background: #58a6ff;"></div>
              <div class="route-stop-mini" style="border-color: #58a6ff;"></div>
              <div class="route-stop-connector" style="background: #58a6ff;"></div>
              <div class="route-stop-mini" style="border-color: #58a6ff;"></div>
              <div class="route-stop-connector" style="background: #58a6ff;"></div>
              <div class="route-stop-mini" style="border-color: #58a6ff;"></div>
              <div class="route-stop-connector" style="background: #58a6ff;"></div>
              <div class="route-stop-mini" style="border-color: #58a6ff;"></div>
              <div class="route-stop-connector" style="background: #58a6ff; opacity: 0.3;"></div>
              <div class="route-stop-mini" style="border-color: #58a6ff; background: #58a6ff;"></div>
            </div>
          </div>

          <!-- Route 4: Gray Line (Idle) -->
          <div class="legend-route" style="opacity: 0.5;">
            <div class="legend-route-header">
              <div class="route-color-line" style="background: #8b949e;"></div>
              <span class="route-name">jkl012</span>
              <span class="route-status idle">Idle</span>
            </div>
            <div class="route-details">
              <div class="route-detail">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                <span class="route-project-badge">api-service</span>
              </div>
              <div class="route-detail">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                <span class="route-detail-value">6 stops / 7m 12s</span>
              </div>
              <div class="route-detail">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/></svg>
                <span class="route-detail-value">77.6K tokens</span>
              </div>
              <div class="route-detail">
                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="18" r="3"/><circle cx="6" cy="6" r="3"/><path d="M6 21V9a9 9 0 0 0 9 9"/></svg>
                <span class="route-detail-value" style="color: var(--fg-subtle);">main</span>
              </div>
            </div>
            <div class="route-stops">
              <div class="route-stop-mini" style="border-color: #8b949e;"></div>
              <div class="route-stop-connector" style="background: #8b949e;"></div>
              <div class="route-stop-mini" style="border-color: #8b949e;"></div>
              <div class="route-stop-connector" style="background: #8b949e;"></div>
              <div class="route-stop-mini" style="border-color: #8b949e;"></div>
              <div class="route-stop-connector" style="background: #8b949e;"></div>
              <div class="route-stop-mini" style="border-color: #8b949e;"></div>
              <div class="route-stop-connector" style="background: #8b949e;"></div>
              <div class="route-stop-mini" style="border-color: #8b949e;"></div>
              <div class="route-stop-connector" style="background: #8b949e;"></div>
              <div class="route-stop-mini" style="border-color: #8b949e; background: #8b949e;"></div>
            </div>
          </div>
        </div>

        <!-- Legend Key -->
        <div class="legend-key">
          <div class="legend-key-title">Map Key</div>
          <div class="legend-key-items">
            <div class="legend-key-item">
              <div class="key-swatch" style="background: #3fb950;"></div>
              <span>Working (active execution)</span>
            </div>
            <div class="legend-key-item">
              <div class="key-swatch" style="background: #d29922;"></div>
              <span>Waiting for approval</span>
            </div>
            <div class="legend-key-item">
              <div class="key-swatch" style="background: #f778ba;"></div>
              <span>Waiting for input</span>
            </div>
            <div class="legend-key-item">
              <div class="key-swatch" style="background: #8b949e; opacity: 0.4;"></div>
              <span>Idle (no activity)</span>
            </div>
            <div class="legend-key-item" style="margin-top: 4px;">
              <div class="key-station"></div>
              <span>Tool call station</span>
            </div>
            <div class="legend-key-item">
              <div class="key-interchange"></div>
              <span>Shared file interchange</span>
            </div>
            <div class="legend-key-item">
              <div class="key-train"></div>
              <span>Active train (execution)</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ============================================
       Design Notes
       ============================================ -->
  <aside class="design-notes">
    <div class="design-notes-header">
      <h3>Design Notes</h3>
    </div>
    <div class="design-notes-content">
      <div class="design-note">
        <h4>
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg>
          Subway/Metro Map Concept
        </h4>
        <p>Each CLI session is visualized as a metro line running horizontally. Tool calls appear as stations along the track, creating a transit map metaphor for code execution flow.</p>
        <ul>
          <li><strong>Lines:</strong> Each session becomes a colored metro line grouped by project</li>
          <li><strong>Stations:</strong> Tool calls (Read, Write, Bash, Glob, Grep) appear as stops</li>
          <li><strong>Trains:</strong> Animated dots travel along working lines using <code>offset-path</code></li>
          <li><strong>Interchanges:</strong> Shared files between sessions shown as transfer stations</li>
        </ul>
      </div>

      <div class="design-note">
        <h4>
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5,3 19,12 5,21 5,3"/></svg>
          Status Visualization
        </h4>
        <ul>
          <li><strong>Working:</strong> Green/blue lines with animated train dots and glowing tracks</li>
          <li><strong>Waiting:</strong> Yellow/pink lines with pulsing end station rings</li>
          <li><strong>Idle:</strong> Grayed out lines at 30% opacity, no animation</li>
          <li>Station labels alternate above/below tracks for readability</li>
        </ul>
      </div>

      <div class="design-note">
        <h4>
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4"/></svg>
          CSS Animation Techniques
        </h4>
        <ul>
          <li><code>offset-path</code> + <code>offset-distance</code> for train movement along SVG paths</li>
          <li><code>lineGlow</code> filter animation on active tracks</li>
          <li><code>stationPulse</code> radius animation for waiting stops</li>
          <li><code>stationRingPulse</code> expanding ring effect for head stations</li>
          <li>Grid background pattern via CSS <code>linear-gradient</code> overlay</li>
        </ul>
      </div>

      <div class="design-note">
        <h4>
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/><path d="M9 21V9"/></svg>
          Layout Structure
        </h4>
        <ul>
          <li>240px sidebar (standard AgentPane navigation)</li>
          <li>Stats bar with aggregate metrics across all sessions</li>
          <li>Map area with subtle grid pattern background</li>
          <li>280px right legend panel with route details and map key</li>
          <li>Sessions grouped by project with gradient-colored headers</li>
        </ul>
      </div>
    </div>
  </aside>

</body>
</html>
