<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>THE FOUNDRY — AgentPane Industrial Monitor</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Roboto+Mono:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
  /* ============================================================
     CSS RESET & BASE
     ============================================================ */
  *, *::before, *::after {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  :root {
    --charcoal: #1a1a1a;
    --charcoal-light: #222222;
    --charcoal-mid: #2a2a2a;
    --steel: #8a8a8a;
    --steel-dark: #4a4a4a;
    --steel-light: #b0b0b0;
    --molten: #ff6b00;
    --molten-bright: #ff8c00;
    --molten-dim: #cc5500;
    --white-hot: #fff4e0;
    --ember: #ff2d00;
    --ember-glow: #ff4422;
    --cooling: #3a6ea5;
    --cooling-light: #5a9ed6;
    --idle-gray: #555555;
    --success-green: #4a7a2e;
    --font-display: 'Bebas Neue', sans-serif;
    --font-mono: 'Roboto Mono', monospace;
    --border-thick: 4px solid var(--steel-dark);
    --border-thin: 2px solid #333333;
    --border-rivet: 3px solid #3a3a3a;
  }

  html, body {
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: var(--charcoal);
    color: var(--white-hot);
    font-family: var(--font-mono);
  }

  /* ============================================================
     SVG NOISE FILTER
     ============================================================ */
  .noise-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 9999;
    opacity: 0.035;
    mix-blend-mode: overlay;
  }

  .noise-overlay svg {
    width: 100%;
    height: 100%;
  }

  /* ============================================================
     VIBRATION / HUM ANIMATION ON BODY
     ============================================================ */
  @keyframes industrialHum {
    0%, 100% { transform: translate(0, 0); }
    10% { transform: translate(0.3px, 0); }
    20% { transform: translate(-0.2px, 0.2px); }
    30% { transform: translate(0.2px, -0.1px); }
    40% { transform: translate(-0.3px, 0); }
    50% { transform: translate(0.1px, 0.3px); }
    60% { transform: translate(-0.1px, -0.2px); }
    70% { transform: translate(0.3px, 0.1px); }
    80% { transform: translate(-0.2px, -0.3px); }
    90% { transform: translate(0.1px, 0.2px); }
  }

  .foundry-container {
    animation: industrialHum 0.15s infinite linear;
    width: 100%;
    height: 100%;
    display: grid;
    grid-template-rows: auto 1fr auto auto;
    grid-template-columns: 1fr 380px;
    gap: 0;
    background: var(--charcoal);
  }

  /* ============================================================
     STEEL PLATE TEXTURE (repeating gradient)
     ============================================================ */
  .steel-plate {
    background:
      linear-gradient(135deg, rgba(255,255,255,0.02) 25%, transparent 25%),
      linear-gradient(225deg, rgba(255,255,255,0.02) 25%, transparent 25%),
      linear-gradient(315deg, rgba(255,255,255,0.02) 25%, transparent 25%),
      linear-gradient(45deg, rgba(255,255,255,0.02) 25%, transparent 25%);
    background-size: 4px 4px;
  }

  /* ============================================================
     RIVET DECORATION
     ============================================================ */
  .riveted {
    position: relative;
  }

  .riveted::before {
    content: '';
    position: absolute;
    top: 6px;
    left: 6px;
    width: 8px;
    height: 8px;
    background: radial-gradient(circle, #555 30%, #333 60%, transparent 70%);
    border-radius: 50%;
    box-shadow:
      calc(100% - 20px) 0 0 0 #444,
      0 calc(100% - 20px) 0 0 #444,
      calc(100% - 20px) calc(100% - 20px) 0 0 #444;
    z-index: 2;
    pointer-events: none;
  }

  /* ============================================================
     HEADER — THE FOUNDRY
     ============================================================ */
  .forge-header {
    grid-column: 1 / 2;
    grid-row: 1;
    padding: 24px 32px 16px;
    border-bottom: var(--border-thick);
    background: linear-gradient(180deg, #222 0%, var(--charcoal) 100%);
    position: relative;
    overflow: hidden;
  }

  .forge-header::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, var(--ember), var(--molten), var(--molten-bright), var(--white-hot), var(--molten-bright), var(--molten), var(--ember));
    background-size: 200% 100%;
    animation: moltenFlow 4s ease-in-out infinite;
  }

  @keyframes moltenFlow {
    0% { background-position: 0% 0%; }
    50% { background-position: 100% 0%; }
    100% { background-position: 0% 0%; }
  }

  .forge-title {
    font-family: var(--font-display);
    font-size: 128px;
    line-height: 0.85;
    letter-spacing: 0.08em;
    color: var(--white-hot);
    text-shadow:
      0 0 40px rgba(255, 107, 0, 0.4),
      0 0 80px rgba(255, 107, 0, 0.15),
      0 2px 0 #333;
    position: relative;
  }

  @keyframes titleGlow {
    0%, 100% { text-shadow: 0 0 40px rgba(255, 107, 0, 0.4), 0 0 80px rgba(255, 107, 0, 0.15), 0 2px 0 #333; }
    50% { text-shadow: 0 0 60px rgba(255, 107, 0, 0.6), 0 0 120px rgba(255, 107, 0, 0.25), 0 2px 0 #333; }
  }

  .forge-title {
    animation: titleGlow 3s ease-in-out infinite;
  }

  .forge-subtitle {
    font-family: var(--font-mono);
    font-size: 14px;
    font-weight: 300;
    letter-spacing: 1em;
    text-transform: uppercase;
    color: var(--steel);
    margin-top: 8px;
    padding-left: 4px;
  }

  .forge-clock {
    position: absolute;
    bottom: 24px;
    right: 32px;
    font-family: var(--font-mono);
    font-size: 28px;
    font-weight: 700;
    color: var(--molten);
    letter-spacing: 0.15em;
    text-shadow: 0 0 20px rgba(255, 107, 0, 0.5);
  }

  .forge-clock-label {
    font-size: 10px;
    font-weight: 300;
    color: var(--steel);
    letter-spacing: 0.3em;
    text-transform: uppercase;
    text-align: right;
    margin-bottom: 2px;
  }

  /* ============================================================
     ALERTS PANEL (top right)
     ============================================================ */
  .alerts-panel {
    grid-column: 2;
    grid-row: 1 / 2;
    border-bottom: var(--border-thick);
    border-left: var(--border-thick);
    background: var(--charcoal-light);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .alerts-header {
    font-family: var(--font-display);
    font-size: 28px;
    letter-spacing: 0.15em;
    color: var(--ember);
    padding: 12px 16px 8px;
    border-bottom: var(--border-thin);
    background: linear-gradient(180deg, rgba(255, 45, 0, 0.08) 0%, transparent 100%);
    display: flex;
    align-items: center;
    gap: 10px;
    text-shadow: 0 0 20px rgba(255, 45, 0, 0.4);
  }

  .alerts-header .warning-icon {
    display: inline-block;
    width: 0;
    height: 0;
    border-left: 10px solid transparent;
    border-right: 10px solid transparent;
    border-bottom: 18px solid var(--ember);
    position: relative;
  }

  .alerts-header .warning-icon::after {
    content: '!';
    position: absolute;
    top: 4px;
    left: -3px;
    font-size: 11px;
    font-weight: 700;
    color: var(--charcoal);
    font-family: var(--font-mono);
  }

  .alerts-list {
    flex: 1;
    overflow: hidden;
    padding: 8px 0;
  }

  .alert-item {
    padding: 8px 16px;
    font-family: var(--font-mono);
    font-size: 11px;
    border-bottom: 1px solid #2a2a2a;
    display: flex;
    align-items: flex-start;
    gap: 8px;
    transition: background 0.3s;
  }

  .alert-item.critical {
    background: rgba(255, 45, 0, 0.08);
    animation: alertFlash 2s ease-in-out infinite;
  }

  @keyframes alertFlash {
    0%, 100% { background: rgba(255, 45, 0, 0.08); }
    50% { background: rgba(255, 45, 0, 0.18); }
  }

  .alert-item .alert-time {
    color: var(--steel);
    font-size: 10px;
    white-space: nowrap;
    min-width: 55px;
  }

  .alert-item .alert-level {
    font-weight: 700;
    font-size: 9px;
    padding: 1px 5px;
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }

  .alert-level.warn {
    color: var(--molten);
    border: 1px solid var(--molten-dim);
  }

  .alert-level.crit {
    color: var(--ember);
    border: 1px solid var(--ember);
    animation: critPulse 1.5s ease-in-out infinite;
  }

  @keyframes critPulse {
    0%, 100% { box-shadow: none; }
    50% { box-shadow: 0 0 8px rgba(255, 45, 0, 0.5); }
  }

  .alert-item .alert-msg {
    color: var(--steel-light);
    flex: 1;
    line-height: 1.4;
  }

  /* ============================================================
     FORGE STATIONS (main area)
     ============================================================ */
  .forge-stations {
    grid-column: 1;
    grid-row: 2;
    overflow-y: auto;
    overflow-x: hidden;
    border-bottom: var(--border-thick);
    scrollbar-width: thin;
    scrollbar-color: var(--steel-dark) var(--charcoal);
  }

  .forge-lane {
    border-bottom: var(--border-thick);
    padding: 20px 32px;
    background: var(--charcoal);
    position: relative;
    transition: background 0.8s ease-in-out;
  }

  .forge-lane:last-child {
    border-bottom: none;
  }

  .forge-lane.active {
    background: linear-gradient(90deg, rgba(255, 107, 0, 0.04) 0%, transparent 60%);
  }

  .forge-lane.error {
    background: linear-gradient(90deg, rgba(255, 45, 0, 0.06) 0%, transparent 40%);
  }

  .forge-lane-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px;
  }

  .forge-lane-left {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .forge-agent-name {
    font-family: var(--font-display);
    font-size: 48px;
    letter-spacing: 0.1em;
    color: var(--white-hot);
    line-height: 1;
    text-shadow: 0 1px 0 #333;
  }

  .forge-agent-name.active {
    color: var(--molten-bright);
    text-shadow: 0 0 30px rgba(255, 107, 0, 0.4);
  }

  .forge-agent-name.error {
    color: var(--ember);
    text-shadow: 0 0 30px rgba(255, 45, 0, 0.4);
  }

  .forge-agent-name.cooling {
    color: var(--cooling-light);
    text-shadow: 0 0 20px rgba(90, 158, 214, 0.3);
  }

  .forge-agent-name.idle {
    color: var(--idle-gray);
    text-shadow: none;
  }

  .forge-status-badge {
    font-family: var(--font-mono);
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    padding: 4px 12px;
    border: 2px solid;
    position: relative;
  }

  .forge-status-badge.forging {
    color: var(--molten);
    border-color: var(--molten);
    box-shadow: 0 0 15px rgba(255, 107, 0, 0.3), inset 0 0 15px rgba(255, 107, 0, 0.1);
    animation: forgingPulse 1.5s ease-in-out infinite;
  }

  @keyframes forgingPulse {
    0%, 100% { box-shadow: 0 0 15px rgba(255, 107, 0, 0.3), inset 0 0 15px rgba(255, 107, 0, 0.1); }
    50% { box-shadow: 0 0 25px rgba(255, 107, 0, 0.5), inset 0 0 25px rgba(255, 107, 0, 0.2); }
  }

  .forge-status-badge.cooling {
    color: var(--cooling-light);
    border-color: var(--cooling);
    box-shadow: 0 0 10px rgba(58, 110, 165, 0.3);
  }

  .forge-status-badge.idle {
    color: var(--idle-gray);
    border-color: var(--idle-gray);
  }

  .forge-status-badge.error {
    color: var(--ember);
    border-color: var(--ember);
    box-shadow: 0 0 15px rgba(255, 45, 0, 0.4);
    animation: errorPulse 1s ease-in-out infinite;
  }

  @keyframes errorPulse {
    0%, 100% { box-shadow: 0 0 15px rgba(255, 45, 0, 0.4); }
    50% { box-shadow: 0 0 30px rgba(255, 45, 0, 0.7); }
  }

  .forge-operation {
    font-family: var(--font-mono);
    font-size: 12px;
    color: var(--steel-light);
    margin-bottom: 14px;
    white-space: nowrap;
    overflow: hidden;
    position: relative;
    height: 18px;
  }

  .forge-operation-text {
    position: absolute;
    white-space: nowrap;
    animation: scrollOperation 20s linear infinite;
  }

  @keyframes scrollOperation {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }

  .forge-lane-right {
    display: flex;
    align-items: center;
    gap: 20px;
  }

  .forge-lane-stats {
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--steel);
    text-align: right;
  }

  .forge-lane-stats span {
    display: block;
    margin-bottom: 2px;
  }

  .forge-lane-stats .stat-value {
    color: var(--white-hot);
    font-weight: 500;
  }

  /* ============================================================
     TEMPERATURE GAUGE (progress bar)
     ============================================================ */
  .temp-gauge-container {
    position: relative;
    height: 28px;
    background: #111;
    border: 2px solid var(--steel-dark);
    overflow: visible;
  }

  .temp-gauge-bg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background:
      repeating-linear-gradient(
        90deg,
        transparent 0px,
        transparent 18px,
        rgba(255,255,255,0.03) 18px,
        rgba(255,255,255,0.03) 20px
      );
  }

  .temp-gauge-fill {
    height: 100%;
    position: relative;
    transition: width 1.2s ease-in-out;
    overflow: visible;
  }

  .temp-gauge-fill.forging {
    background: linear-gradient(90deg, var(--ember) 0%, var(--molten) 40%, var(--molten-bright) 70%, var(--white-hot) 100%);
    box-shadow: 0 0 20px rgba(255, 107, 0, 0.4);
  }

  .temp-gauge-fill.cooling {
    background: linear-gradient(90deg, var(--cooling) 0%, var(--cooling-light) 100%);
    box-shadow: 0 0 15px rgba(58, 110, 165, 0.3);
  }

  .temp-gauge-fill.idle {
    background: linear-gradient(90deg, #333 0%, var(--idle-gray) 100%);
  }

  .temp-gauge-fill.error {
    background: linear-gradient(90deg, #660000 0%, var(--ember) 100%);
    box-shadow: 0 0 15px rgba(255, 45, 0, 0.4);
    animation: errorGaugePulse 1s ease-in-out infinite;
  }

  @keyframes errorGaugePulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
  }

  .temp-gauge-label {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    font-family: var(--font-mono);
    font-size: 12px;
    font-weight: 700;
    color: var(--charcoal);
    text-shadow: 0 0 4px rgba(255,255,255,0.3);
    z-index: 2;
  }

  .temp-gauge-temp {
    position: absolute;
    left: 8px;
    top: 50%;
    transform: translateY(-50%);
    font-family: var(--font-mono);
    font-size: 10px;
    font-weight: 500;
    color: var(--white-hot);
    z-index: 2;
    opacity: 0.8;
  }

  /* Spark canvas overlay per lane */
  .spark-canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 3;
  }

  /* ============================================================
     PRODUCTION LOG (right column)
     ============================================================ */
  .production-log {
    grid-column: 2;
    grid-row: 2;
    border-left: var(--border-thick);
    border-bottom: var(--border-thick);
    display: flex;
    flex-direction: column;
    background: #111;
    position: relative;
    overflow: hidden;
  }

  /* CRT scanline overlay */
  .production-log::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: repeating-linear-gradient(
      0deg,
      transparent 0px,
      transparent 2px,
      rgba(0, 0, 0, 0.15) 2px,
      rgba(0, 0, 0, 0.15) 4px
    );
    pointer-events: none;
    z-index: 2;
  }

  .production-log-header {
    font-family: var(--font-display);
    font-size: 28px;
    letter-spacing: 0.15em;
    color: var(--molten);
    padding: 12px 16px 8px;
    border-bottom: var(--border-thin);
    background: linear-gradient(180deg, rgba(255, 107, 0, 0.06) 0%, transparent 100%);
    text-shadow: 0 0 15px rgba(255, 107, 0, 0.3);
    z-index: 3;
    position: relative;
  }

  .log-entries {
    flex: 1;
    overflow-y: auto;
    padding: 8px 0;
    font-family: var(--font-mono);
    font-size: 11px;
    line-height: 1.6;
    scrollbar-width: thin;
    scrollbar-color: var(--steel-dark) #111;
    position: relative;
    z-index: 1;
  }

  .log-entry {
    padding: 2px 12px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    opacity: 0;
    animation: logFadeIn 0.5s ease-out forwards;
  }

  @keyframes logFadeIn {
    from { opacity: 0; transform: translateY(4px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .log-entry .log-time {
    color: var(--steel);
    margin-right: 6px;
  }

  .log-entry .log-agent {
    color: var(--molten);
    font-weight: 700;
    margin-right: 6px;
  }

  .log-entry .log-msg {
    color: var(--steel-light);
  }

  .log-entry .log-msg.code {
    color: var(--molten-bright);
  }

  .log-entry .log-msg.error {
    color: var(--ember);
    font-weight: 700;
  }

  .log-entry .log-msg.success {
    color: var(--success-green);
  }

  /* ============================================================
     BOTTOM PANELS CONTAINER
     ============================================================ */
  .bottom-panels {
    grid-column: 1 / -1;
    grid-row: 3;
    display: grid;
    grid-template-columns: 1fr 1.2fr 1fr;
    border-bottom: var(--border-thick);
    min-height: 200px;
  }

  /* ============================================================
     METRICS ANVIL (bottom left)
     ============================================================ */
  .metrics-anvil {
    border-right: var(--border-thick);
    padding: 16px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    background: var(--charcoal-light);
  }

  .anvil-card {
    background: var(--charcoal);
    border: 3px solid #333;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.6), inset 0 -1px 0 rgba(255,255,255,0.03);
    padding: 14px;
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
  }

  .anvil-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
  }

  .anvil-card-label {
    font-family: var(--font-mono);
    font-size: 9px;
    font-weight: 700;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: var(--steel);
    margin-bottom: 8px;
  }

  .anvil-card-value {
    font-family: var(--font-display);
    font-size: 52px;
    line-height: 1;
    color: var(--white-hot);
    text-shadow: 0 0 20px rgba(255, 244, 224, 0.2);
  }

  .anvil-card-value.molten {
    color: var(--molten);
    text-shadow: 0 0 20px rgba(255, 107, 0, 0.4);
  }

  .anvil-card-value.ember {
    color: var(--ember);
    text-shadow: 0 0 20px rgba(255, 45, 0, 0.4);
  }

  .anvil-card-sub {
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--steel);
    margin-top: 6px;
  }

  .anvil-card-sub .trend-up {
    color: var(--success-green);
  }

  .anvil-card-sub .trend-down {
    color: var(--ember);
  }

  /* Analog gauge for HEAT INDEX */
  .analog-gauge {
    width: 80px;
    height: 44px;
    position: relative;
    margin-top: 4px;
    overflow: hidden;
  }

  .analog-gauge-bg {
    width: 80px;
    height: 80px;
    border: 3px solid var(--steel-dark);
    border-radius: 50%;
    position: absolute;
    bottom: -40px;
    left: 0;
    background: conic-gradient(
      from 180deg,
      var(--cooling) 0deg,
      var(--molten) 90deg,
      var(--ember) 150deg,
      var(--ember) 180deg,
      transparent 180deg
    );
    opacity: 0.3;
  }

  .analog-gauge-needle {
    position: absolute;
    bottom: 0;
    left: 38px;
    width: 4px;
    height: 36px;
    background: var(--white-hot);
    transform-origin: bottom center;
    transition: transform 1.5s ease-in-out;
    box-shadow: 0 0 8px rgba(255, 244, 224, 0.5);
  }

  .analog-gauge-pin {
    position: absolute;
    bottom: -4px;
    left: 34px;
    width: 12px;
    height: 12px;
    background: var(--steel);
    border-radius: 50%;
    border: 2px solid var(--steel-dark);
    z-index: 2;
  }

  /* Grade bar for ALLOY GRADE */
  .grade-bar {
    display: flex;
    gap: 3px;
    margin-top: 6px;
  }

  .grade-segment {
    flex: 1;
    height: 8px;
    background: #333;
    transition: background 0.8s ease-in-out;
  }

  .grade-segment.filled {
    background: var(--molten);
    box-shadow: 0 0 6px rgba(255, 107, 0, 0.3);
  }

  .grade-letter {
    font-family: var(--font-display);
    font-size: 48px;
    color: var(--molten);
    text-shadow: 0 0 20px rgba(255, 107, 0, 0.3);
    line-height: 1;
  }

  /* ============================================================
     TOOL USAGE FURNACE (bottom center)
     ============================================================ */
  .tool-furnace {
    border-right: var(--border-thick);
    padding: 16px 20px;
    background: var(--charcoal);
    display: flex;
    flex-direction: column;
  }

  .furnace-header {
    font-family: var(--font-display);
    font-size: 24px;
    letter-spacing: 0.15em;
    color: var(--molten);
    margin-bottom: 12px;
    text-shadow: 0 0 15px rgba(255, 107, 0, 0.3);
  }

  .furnace-bars {
    flex: 1;
    display: flex;
    align-items: flex-end;
    gap: 8px;
    padding-bottom: 24px;
    position: relative;
  }

  .furnace-bar-group {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    height: 100%;
    justify-content: flex-end;
  }

  .furnace-bar {
    width: 100%;
    max-width: 48px;
    position: relative;
    transition: height 1.2s ease-in-out;
    min-height: 4px;
  }

  .furnace-bar-inner {
    width: 100%;
    height: 100%;
    position: relative;
    border: 2px solid rgba(255, 107, 0, 0.3);
    border-bottom: none;
    overflow: hidden;
  }

  .furnace-bar-fill {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(0deg, var(--ember) 0%, var(--molten) 50%, var(--molten-bright) 100%);
    opacity: 0.8;
    transition: opacity 0.5s;
  }

  .furnace-bar-group.active .furnace-bar-fill {
    animation: furnaceGlow 1.5s ease-in-out infinite;
  }

  @keyframes furnaceGlow {
    0%, 100% { opacity: 0.8; }
    50% { opacity: 1; box-shadow: 0 0 20px rgba(255, 107, 0, 0.6); }
  }

  .furnace-bar-label {
    font-family: var(--font-mono);
    font-size: 8px;
    font-weight: 700;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--steel);
    margin-top: 8px;
    text-align: center;
    writing-mode: horizontal-tb;
  }

  .furnace-bar-count {
    font-family: var(--font-mono);
    font-size: 11px;
    font-weight: 700;
    color: var(--white-hot);
    margin-bottom: 4px;
    text-shadow: 0 0 8px rgba(255, 244, 224, 0.3);
  }

  /* ============================================================
     YIELD / EXTRA METRICS (bottom right)
     ============================================================ */
  .yield-panel {
    padding: 16px;
    background: var(--charcoal-light);
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .yield-header {
    font-family: var(--font-display);
    font-size: 24px;
    letter-spacing: 0.15em;
    color: var(--molten);
    text-shadow: 0 0 15px rgba(255, 107, 0, 0.3);
  }

  .yield-stat {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 12px;
    background: var(--charcoal);
    border: 2px solid #333;
  }

  .yield-stat-label {
    font-family: var(--font-mono);
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--steel);
  }

  .yield-stat-value {
    font-family: var(--font-display);
    font-size: 36px;
    color: var(--white-hot);
    line-height: 1;
  }

  .yield-stat-trend {
    font-family: var(--font-mono);
    font-size: 12px;
    font-weight: 700;
    margin-left: 8px;
  }

  .yield-stat-trend.up {
    color: var(--success-green);
  }

  .yield-stat-trend.down {
    color: var(--ember);
  }

  .yield-mini-chart {
    display: flex;
    align-items: flex-end;
    gap: 2px;
    height: 24px;
    margin-top: 4px;
  }

  .yield-mini-bar {
    flex: 1;
    background: var(--molten);
    opacity: 0.5;
    transition: height 0.8s ease-in-out;
    max-width: 6px;
  }

  /* ============================================================
     FOOTER BAR
     ============================================================ */
  .footer-bar {
    grid-column: 1 / -1;
    grid-row: 4;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 24px;
    background: linear-gradient(180deg, #2a2a2a 0%, #1e1e1e 50%, #222 100%);
    border-top: 3px solid var(--steel-dark);
    position: relative;
    min-height: 42px;
  }

  /* Riveted top edge */
  .footer-bar::before {
    content: '';
    position: absolute;
    top: -1px;
    left: 0;
    width: 100%;
    height: 3px;
    background: repeating-linear-gradient(
      90deg,
      var(--steel-dark) 0px,
      var(--steel-dark) 4px,
      #555 4px,
      #555 5px,
      var(--steel-dark) 5px,
      var(--steel-dark) 30px,
      transparent 30px,
      transparent 31px
    );
  }

  .footer-left {
    font-family: var(--font-mono);
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 0.3em;
    text-transform: uppercase;
    color: var(--steel);
  }

  .footer-center {
    display: flex;
    align-items: center;
    gap: 20px;
  }

  .footer-indicator {
    display: flex;
    align-items: center;
    gap: 6px;
    font-family: var(--font-mono);
    font-size: 10px;
    font-weight: 500;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--steel);
  }

  .indicator-light {
    width: 10px;
    height: 10px;
    border: 2px solid #555;
    background: #333;
    position: relative;
  }

  .indicator-light.on {
    background: var(--success-green);
    box-shadow: 0 0 8px rgba(74, 122, 46, 0.6);
  }

  .indicator-light.warn {
    background: var(--molten);
    box-shadow: 0 0 8px rgba(255, 107, 0, 0.6);
    animation: indicatorBlink 2s ease-in-out infinite;
  }

  @keyframes indicatorBlink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
  }

  .indicator-light.off {
    background: #660000;
  }

  .footer-right {
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--steel-light);
    letter-spacing: 0.15em;
  }

  .footer-right span {
    margin-left: 16px;
  }

  /* ============================================================
     EMBER PARTICLE SYSTEM (CSS-only fallback)
     ============================================================ */
  .ember-particle {
    position: fixed;
    width: 3px;
    height: 3px;
    background: var(--molten);
    border-radius: 50%;
    pointer-events: none;
    z-index: 9998;
    opacity: 0;
  }

  @keyframes emberRise {
    0% {
      opacity: 1;
      transform: translateY(0) translateX(0) scale(1);
    }
    30% {
      opacity: 0.9;
    }
    100% {
      opacity: 0;
      transform: translateY(-120px) translateX(var(--drift)) scale(0.2);
    }
  }

  /* ============================================================
     SCROLLBAR STYLES
     ============================================================ */
  ::-webkit-scrollbar {
    width: 6px;
  }
  ::-webkit-scrollbar-track {
    background: var(--charcoal);
  }
  ::-webkit-scrollbar-thumb {
    background: var(--steel-dark);
  }
  ::-webkit-scrollbar-thumb:hover {
    background: var(--steel);
  }

  /* ============================================================
     HEAT SHIMMER EFFECT
     ============================================================ */
  @keyframes heatShimmer {
    0% { filter: blur(0px) brightness(1); }
    25% { filter: blur(0.3px) brightness(1.01); }
    50% { filter: blur(0px) brightness(1); }
    75% { filter: blur(0.2px) brightness(1.005); }
    100% { filter: blur(0px) brightness(1); }
  }

  .heat-shimmer {
    animation: heatShimmer 3s ease-in-out infinite;
  }

  /* ============================================================
     NUMBER ANIMATION HELPER
     ============================================================ */
  @keyframes countUp {
    from { opacity: 0.5; transform: translateY(4px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .number-tick {
    display: inline-block;
    animation: countUp 0.4s ease-out;
  }
</style>
</head>
<body>

<!-- NOISE TEXTURE OVERLAY -->
<div class="noise-overlay">
  <svg>
    <filter id="noiseFilter">
      <feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="4" stitchTiles="stitch"/>
      <feColorMatrix type="saturate" values="0"/>
    </filter>
    <rect width="100%" height="100%" filter="url(#noiseFilter)"/>
  </svg>
</div>

<!-- MAIN CONTAINER -->
<div class="foundry-container" id="foundryContainer">

  <!-- ==================== HEADER ==================== -->
  <div class="forge-header steel-plate">
    <div class="forge-title" id="forgeTitle">THE FOUNDRY</div>
    <div class="forge-subtitle">ACTIVE OPERATIONS</div>
    <div style="position: absolute; bottom: 24px; right: 32px; text-align: right;">
      <div class="forge-clock-label">MILITARY TIME // UTC</div>
      <div class="forge-clock" id="forgeClock">00:00:00</div>
    </div>
  </div>

  <!-- ==================== ALERTS PANEL ==================== -->
  <div class="alerts-panel">
    <div class="alerts-header">
      <span class="warning-icon"></span>
      FOUNDRY ALERTS
    </div>
    <div class="alerts-list" id="alertsList">
      <!-- Alerts injected by JS -->
    </div>
  </div>

  <!-- ==================== FORGE STATIONS ==================== -->
  <div class="forge-stations" id="forgeStations">
    <!-- Forge lanes injected by JS -->
  </div>

  <!-- ==================== PRODUCTION LOG ==================== -->
  <div class="production-log">
    <div class="production-log-header">PRODUCTION LOG</div>
    <div class="log-entries" id="logEntries">
      <!-- Log entries injected by JS -->
    </div>
  </div>

  <!-- ==================== BOTTOM PANELS ==================== -->
  <div class="bottom-panels">

    <!-- METRICS ANVIL -->
    <div class="metrics-anvil">
      <div class="anvil-card riveted">
        <div class="anvil-card-label">UNITS FORGED</div>
        <div class="anvil-card-value" id="unitsForged">247</div>
        <div class="anvil-card-sub"><span class="trend-up" id="unitsTrend">+12 THIS HOUR</span></div>
      </div>

      <div class="anvil-card riveted">
        <div class="anvil-card-label">HEAT INDEX</div>
        <div style="display: flex; align-items: flex-end; gap: 10px;">
          <div class="anvil-card-value molten" id="heatIndex">73</div>
          <div style="font-family: var(--font-mono); font-size: 14px; color: var(--steel); padding-bottom: 8px;">%</div>
        </div>
        <div class="analog-gauge">
          <div class="analog-gauge-bg"></div>
          <div class="analog-gauge-needle" id="heatNeedle" style="transform: rotate(-45deg);"></div>
          <div class="analog-gauge-pin"></div>
        </div>
      </div>

      <div class="anvil-card riveted">
        <div class="anvil-card-label">ALLOY GRADE</div>
        <div class="grade-letter" id="gradeValue">A</div>
        <div class="grade-bar" id="gradeBar">
          <div class="grade-segment filled"></div>
          <div class="grade-segment filled"></div>
          <div class="grade-segment filled"></div>
          <div class="grade-segment filled"></div>
          <div class="grade-segment"></div>
        </div>
      </div>

      <div class="anvil-card riveted">
        <div class="anvil-card-label">YIELD RATE</div>
        <div style="display: flex; align-items: baseline; gap: 4px;">
          <div class="anvil-card-value" id="yieldRate">94</div>
          <div style="font-family: var(--font-display); font-size: 28px; color: var(--steel);">%</div>
        </div>
        <div class="anvil-card-sub"><span class="trend-up" id="yieldTrend">+2.1%</span></div>
      </div>
    </div>

    <!-- TOOL FURNACE -->
    <div class="tool-furnace">
      <div class="furnace-header">TOOL USAGE FURNACE</div>
      <div class="furnace-bars" id="furnaceBars">
        <!-- Bars injected by JS -->
      </div>
    </div>

    <!-- YIELD PANEL -->
    <div class="yield-panel">
      <div class="yield-header">FORGE OUTPUT</div>

      <div class="yield-stat">
        <div>
          <div class="yield-stat-label">TOKENS SMELTED</div>
          <div style="display: flex; align-items: baseline;">
            <div class="yield-stat-value" id="tokensSmelted">1.4M</div>
            <div class="yield-stat-trend up" id="tokensTrend">+127K</div>
          </div>
        </div>
      </div>

      <div class="yield-stat">
        <div>
          <div class="yield-stat-label">AVG FORGE TIME</div>
          <div style="display: flex; align-items: baseline;">
            <div class="yield-stat-value" id="avgForgeTime">4:32</div>
            <div class="yield-stat-trend down" id="forgeTimeTrend">+0:12</div>
          </div>
        </div>
      </div>

      <div class="yield-stat">
        <div>
          <div class="yield-stat-label">ACTIVE SESSIONS</div>
          <div style="display: flex; align-items: baseline;">
            <div class="yield-stat-value" id="activeSessions">3</div>
            <div class="yield-stat-trend up">/5 CAPACITY</div>
          </div>
        </div>
      </div>

      <div>
        <div class="yield-stat-label" style="margin-bottom: 4px; font-family: var(--font-mono); font-size: 9px; font-weight: 700; letter-spacing: 0.25em; text-transform: uppercase; color: var(--steel);">THROUGHPUT (24H)</div>
        <div class="yield-mini-chart" id="throughputChart">
          <!-- Mini bars injected by JS -->
        </div>
      </div>
    </div>
  </div>

  <!-- ==================== FOOTER BAR ==================== -->
  <div class="footer-bar">
    <div class="footer-left">AGENTPANE INDUSTRIAL // EST. 2025</div>
    <div class="footer-center">
      <div class="footer-indicator">
        <div class="indicator-light on" id="indPower"></div>
        POWER
      </div>
      <div class="footer-indicator">
        <div class="indicator-light on" id="indNetwork"></div>
        NETWORK
      </div>
      <div class="footer-indicator">
        <div class="indicator-light on" id="indDatabase"></div>
        DATABASE
      </div>
      <div class="footer-indicator">
        <div class="indicator-light warn" id="indLoad"></div>
        LOAD
      </div>
    </div>
    <div class="footer-right">
      SHIFT: <strong id="shiftNum">847</strong>
      <span>UPTIME: <strong id="uptimeVal">23:14:07</strong></span>
    </div>
  </div>

</div>

<!-- ==================== CANVAS FOR SPARK PARTICLES ==================== -->
<canvas id="sparkCanvas" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9998;"></canvas>

<script>
// ================================================================
// THE FOUNDRY — Live Data Simulation Engine
// ================================================================

// ---- AGENT DATA MODEL ----
const agents = [
  {
    id: 'FORGE-01',
    status: 'forging',
    progress: 0.67,
    operation: 'Implementing authentication middleware with OAuth2 flow and JWT token validation pipeline — session management service refactoring in progress',
    turns: 14,
    maxTurns: 30,
    tokensUsed: 42300,
    taskName: 'AUTH-2847'
  },
  {
    id: 'FORGE-02',
    status: 'forging',
    progress: 0.89,
    operation: 'Generating comprehensive test suite for payment processing module — edge cases for currency conversion and decimal precision handling',
    turns: 26,
    maxTurns: 30,
    tokensUsed: 78100,
    taskName: 'PAY-1093'
  },
  {
    id: 'FORGE-03',
    status: 'cooling',
    progress: 1.0,
    operation: 'Task complete — database migration scripts generated and validated — awaiting review approval',
    turns: 18,
    maxTurns: 30,
    tokensUsed: 31500,
    taskName: 'DB-0456'
  },
  {
    id: 'FORGE-04',
    status: 'error',
    progress: 0.34,
    operation: 'ERROR: Tool timeout on file system read — attempting recovery — sandbox container unresponsive since 14:28:03',
    turns: 8,
    maxTurns: 30,
    tokensUsed: 15200,
    taskName: 'UI-7721'
  },
  {
    id: 'FORGE-05',
    status: 'idle',
    progress: 0,
    operation: 'Standing by — no active task assignment — last operation completed at 13:47:22 UTC',
    turns: 0,
    maxTurns: 30,
    tokensUsed: 0,
    taskName: '—'
  }
];

// ---- ALERTS DATA ----
const alertsData = [
  { time: '14:31:42', level: 'warn', msg: 'FORGE-02 APPROACHING TURN LIMIT (26/30)' },
  { time: '14:30:18', level: 'crit', msg: 'FORGE-04 TOOL TIMEOUT — SANDBOX UNRESPONSIVE' },
  { time: '14:29:55', level: 'warn', msg: 'HEAT INDEX EXCEEDING 70% THRESHOLD' },
  { time: '14:28:03', level: 'crit', msg: 'FORGE-04 FILE SYSTEM READ FAILURE — RETRY 3/3' },
  { time: '14:26:41', level: 'warn', msg: 'TOKEN CONSUMPTION RATE ABOVE BASELINE (+18%)' },
  { time: '14:24:12', level: 'warn', msg: 'FORGE-01 WORKTREE LOCK CONTENTION DETECTED' },
  { time: '14:22:07', level: 'warn', msg: 'DATABASE CONNECTION POOL AT 85% CAPACITY' },
];

// ---- TOOL USAGE DATA ----
const tools = [
  { name: 'BASH', count: 347, max: 500, active: true },
  { name: 'READ', count: 512, max: 600, active: true },
  { name: 'EDIT', count: 289, max: 500, active: true },
  { name: 'WRITE', count: 134, max: 400, active: false },
  { name: 'GREP', count: 423, max: 500, active: true },
  { name: 'GLOB', count: 198, max: 400, active: false },
  { name: 'FETCH', count: 67, max: 200, active: false },
  { name: 'TASK', count: 45, max: 100, active: true },
];

// ---- LOG MESSAGES ----
const logTemplates = [
  { agent: 'FORGE-01', msg: 'Parsing OAuth2 callback handler...', type: 'code' },
  { agent: 'FORGE-01', msg: 'Writing src/middleware/auth.ts', type: 'code' },
  { agent: 'FORGE-01', msg: 'JWT validation schema defined', type: 'text' },
  { agent: 'FORGE-02', msg: 'Test case: currency_convert_jpy → PASS', type: 'success' },
  { agent: 'FORGE-02', msg: 'Generating edge case: decimal overflow', type: 'code' },
  { agent: 'FORGE-02', msg: 'Test suite 84% complete (127/151)', type: 'text' },
  { agent: 'FORGE-03', msg: 'Migration 0042_add_indexes.sql verified', type: 'success' },
  { agent: 'FORGE-03', msg: 'Awaiting review — task DB-0456', type: 'text' },
  { agent: 'FORGE-04', msg: 'ERROR: ETIMEDOUT reading /workspace/src', type: 'error' },
  { agent: 'FORGE-04', msg: 'ERROR: Container health check failed', type: 'error' },
  { agent: 'FORGE-04', msg: 'Retry attempt 3 of 3 exhausted', type: 'error' },
  { agent: 'FORGE-01', msg: 'Reading existing session store...', type: 'text' },
  { agent: 'FORGE-02', msg: 'Test case: null_amount_handling → PASS', type: 'success' },
  { agent: 'FORGE-01', msg: 'Refactoring token refresh logic', type: 'code' },
  { agent: 'FORGE-02', msg: 'Writing tests/payment.spec.ts', type: 'code' },
  { agent: 'FORGE-01', msg: 'Middleware chain: [cors, auth, rate-limit]', type: 'text' },
  { agent: 'FORGE-02', msg: 'Coverage: 91.2% statements', type: 'success' },
  { agent: 'FORGE-01', msg: 'Grep: "session" across 47 files', type: 'text' },
  { agent: 'FORGE-04', msg: 'ERROR: Sandbox restart triggered', type: 'error' },
  { agent: 'FORGE-02', msg: 'Test case: stripe_webhook_sig → PASS', type: 'success' },
];

// ---- THROUGHPUT DATA ----
const throughputData = [12, 18, 15, 22, 19, 25, 28, 31, 24, 27, 33, 29, 35, 30, 26, 32, 38, 34, 28, 31, 36, 33, 29, 27];

// ================================================================
// RENDER FUNCTIONS
// ================================================================

function renderForgeStations() {
  const container = document.getElementById('forgeStations');
  container.innerHTML = '';

  agents.forEach((agent, index) => {
    const lane = document.createElement('div');
    lane.className = `forge-lane ${agent.status === 'forging' ? 'active' : ''} ${agent.status === 'error' ? 'error' : ''} ${agent.status === 'forging' ? 'heat-shimmer' : ''}`;
    lane.id = `lane-${index}`;

    const nameClass = agent.status === 'forging' ? 'active' :
                      agent.status === 'error' ? 'error' :
                      agent.status === 'cooling' ? 'cooling' : 'idle';

    const statusLabel = agent.status.toUpperCase();

    lane.innerHTML = `
      <div class="forge-lane-header">
        <div class="forge-lane-left">
          <div class="forge-agent-name ${nameClass}">${agent.id}</div>
          <div class="forge-status-badge ${agent.status}">${statusLabel}</div>
        </div>
        <div class="forge-lane-right">
          <div class="forge-lane-stats">
            <span>TASK: <span class="stat-value">${agent.taskName}</span></span>
            <span>TURNS: <span class="stat-value">${agent.turns}/${agent.maxTurns}</span></span>
            <span>TOKENS: <span class="stat-value">${(agent.tokensUsed / 1000).toFixed(1)}K</span></span>
          </div>
        </div>
      </div>
      <div class="forge-operation">
        <span class="forge-operation-text">${agent.operation}  ///  ${agent.operation}</span>
      </div>
      <div class="temp-gauge-container">
        <div class="temp-gauge-bg"></div>
        <div class="temp-gauge-fill ${agent.status}" style="width: ${agent.progress * 100}%;" id="gauge-${index}">
          <div class="temp-gauge-temp">${Math.round(agent.progress * 1200 + 400)}&deg;F</div>
        </div>
        <div class="temp-gauge-label" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); color: ${agent.progress > 0.85 ? '#1a1a1a' : 'var(--steel-light)'};">${Math.round(agent.progress * 100)}%</div>
      </div>
    `;

    container.appendChild(lane);
  });
}

function renderAlerts() {
  const container = document.getElementById('alertsList');
  container.innerHTML = '';

  alertsData.forEach(alert => {
    const item = document.createElement('div');
    item.className = `alert-item ${alert.level === 'crit' ? 'critical' : ''}`;
    item.innerHTML = `
      <span class="alert-time">${alert.time}</span>
      <span class="alert-level ${alert.level}">${alert.level === 'crit' ? 'CRIT' : 'WARN'}</span>
      <span class="alert-msg">${alert.msg}</span>
    `;
    container.appendChild(item);
  });
}

function renderToolFurnace() {
  const container = document.getElementById('furnaceBars');
  container.innerHTML = '';

  const maxCount = Math.max(...tools.map(t => t.max));

  tools.forEach(tool => {
    const heightPercent = (tool.count / maxCount) * 100;
    const group = document.createElement('div');
    group.className = `furnace-bar-group ${tool.active ? 'active' : ''}`;
    group.innerHTML = `
      <div class="furnace-bar-count">${tool.count}</div>
      <div class="furnace-bar" style="height: ${heightPercent}%;">
        <div class="furnace-bar-inner">
          <div class="furnace-bar-fill"></div>
        </div>
      </div>
      <div class="furnace-bar-label">${tool.name}</div>
    `;
    container.appendChild(group);
  });
}

function renderThroughputChart() {
  const container = document.getElementById('throughputChart');
  container.innerHTML = '';
  const max = Math.max(...throughputData);

  throughputData.forEach(val => {
    const bar = document.createElement('div');
    bar.className = 'yield-mini-bar';
    bar.style.height = `${(val / max) * 100}%`;
    bar.style.opacity = 0.3 + (val / max) * 0.7;
    container.appendChild(bar);
  });
}

function renderLogEntries() {
  const container = document.getElementById('logEntries');
  // Start with some initial entries
  for (let i = 0; i < 20; i++) {
    addLogEntry(container, false);
  }
}

let logIndex = 0;
function addLogEntry(container, animate = true) {
  const template = logTemplates[logIndex % logTemplates.length];
  logIndex++;

  const now = new Date();
  const timeStr = now.toTimeString().substring(0, 8);

  const entry = document.createElement('div');
  entry.className = 'log-entry';
  if (!animate) entry.style.animation = 'none';
  entry.style.opacity = animate ? '0' : '1';

  entry.innerHTML = `
    <span class="log-time">${timeStr}</span>
    <span class="log-agent">[${template.agent}]</span>
    <span class="log-msg ${template.type}">${template.msg}</span>
  `;

  container.appendChild(entry);

  // Keep only last 80 entries
  while (container.children.length > 80) {
    container.removeChild(container.firstChild);
  }

  // Auto-scroll
  container.scrollTop = container.scrollHeight;
}

// ================================================================
// CLOCK
// ================================================================
function updateClock() {
  const now = new Date();
  const h = String(now.getUTCHours()).padStart(2, '0');
  const m = String(now.getUTCMinutes()).padStart(2, '0');
  const s = String(now.getUTCSeconds()).padStart(2, '0');
  document.getElementById('forgeClock').textContent = `${h}:${m}:${s}`;
}

// ================================================================
// UPTIME COUNTER
// ================================================================
let uptimeSeconds = 83647; // ~23:14:07
function updateUptime() {
  uptimeSeconds++;
  const h = String(Math.floor(uptimeSeconds / 3600)).padStart(2, '0');
  const m = String(Math.floor((uptimeSeconds % 3600) / 60)).padStart(2, '0');
  const s = String(uptimeSeconds % 60).padStart(2, '0');
  document.getElementById('uptimeVal').textContent = `${h}:${m}:${s}`;
}

// ================================================================
// LIVE DATA UPDATES
// ================================================================
let unitsForged = 247;
let heatIndex = 73;

function updateMetrics() {
  // Units forged — occasionally increment
  if (Math.random() < 0.15) {
    unitsForged++;
    document.getElementById('unitsForged').textContent = unitsForged;
    document.getElementById('unitsForged').classList.add('number-tick');
    setTimeout(() => document.getElementById('unitsForged').classList.remove('number-tick'), 400);
  }

  // Heat index — fluctuate
  heatIndex += (Math.random() - 0.45) * 3;
  heatIndex = Math.max(45, Math.min(95, heatIndex));
  const heatEl = document.getElementById('heatIndex');
  heatEl.textContent = Math.round(heatIndex);

  // Needle rotation: -90deg (0%) to 0deg (100%)
  const needleAngle = -90 + (heatIndex / 100) * 90;
  document.getElementById('heatNeedle').style.transform = `rotate(${needleAngle}deg)`;

  // Yield rate
  const yieldRate = 91 + Math.random() * 6;
  document.getElementById('yieldRate').textContent = Math.round(yieldRate);
}

function updateAgentProgress() {
  agents.forEach((agent, index) => {
    if (agent.status === 'forging') {
      agent.progress = Math.min(1.0, agent.progress + (Math.random() * 0.02));
      agent.tokensUsed += Math.floor(Math.random() * 800);
      if (Math.random() < 0.1) agent.turns = Math.min(agent.maxTurns, agent.turns + 1);

      const gauge = document.getElementById(`gauge-${index}`);
      if (gauge) {
        gauge.style.width = `${agent.progress * 100}%`;
        const tempEl = gauge.querySelector('.temp-gauge-temp');
        if (tempEl) tempEl.textContent = `${Math.round(agent.progress * 1200 + 400)}\u00B0F`;
      }

      // Update stats text
      const lane = document.getElementById(`lane-${index}`);
      if (lane) {
        const statValues = lane.querySelectorAll('.stat-value');
        if (statValues[1]) statValues[1].textContent = `${agent.turns}/${agent.maxTurns}`;
        if (statValues[2]) statValues[2].textContent = `${(agent.tokensUsed / 1000).toFixed(1)}K`;

        // Update percentage label
        const label = lane.querySelector('.temp-gauge-label');
        if (label) label.textContent = `${Math.round(agent.progress * 100)}%`;
      }
    }
  });
}

function updateToolCounts() {
  tools.forEach(tool => {
    if (tool.active && Math.random() < 0.3) {
      tool.count += Math.floor(Math.random() * 3) + 1;
    }
  });
  renderToolFurnace();
}

function addNewAlert() {
  const newAlerts = [
    'FORGE-01 TOKEN BUFFER REFILLING',
    'FORGE-02 NEARING COMPLETION (89%)',
    'MEMORY ALLOCATION SPIKE DETECTED',
    'FORGE-01 WORKTREE SYNC IN PROGRESS',
    'CONTAINER HEALTH CHECK: ALL GREEN',
    'FORGE-04 RECOVERY ATTEMPT INITIATED',
    'THROUGHPUT ABOVE SHIFT AVERAGE',
    'FORGE-02 FINAL TEST BATCH RUNNING',
  ];

  const now = new Date();
  const timeStr = now.toUTCString().substring(17, 25);
  const isWarn = Math.random() > 0.3;

  alertsData.unshift({
    time: timeStr,
    level: isWarn ? 'warn' : 'crit',
    msg: newAlerts[Math.floor(Math.random() * newAlerts.length)]
  });

  if (alertsData.length > 12) alertsData.pop();
  renderAlerts();
}

// ================================================================
// SPARK PARTICLE SYSTEM (Canvas)
// ================================================================
const sparkCanvas = document.getElementById('sparkCanvas');
const sparkCtx = sparkCanvas.getContext('2d');
let sparks = [];

function resizeSparkCanvas() {
  sparkCanvas.width = window.innerWidth;
  sparkCanvas.height = window.innerHeight;
}
resizeSparkCanvas();
window.addEventListener('resize', resizeSparkCanvas);

function createSpark(x, y) {
  return {
    x: x,
    y: y,
    vx: (Math.random() - 0.5) * 3,
    vy: -(Math.random() * 4 + 2),
    life: 1.0,
    decay: Math.random() * 0.02 + 0.008,
    size: Math.random() * 2.5 + 0.5,
    color: Math.random() > 0.3 ? [255, 107 + Math.floor(Math.random() * 60), 0] : [255, 200 + Math.floor(Math.random() * 55), 180]
  };
}

function emitSparksFromForge() {
  agents.forEach((agent, index) => {
    if (agent.status !== 'forging') return;

    const lane = document.getElementById(`lane-${index}`);
    if (!lane) return;

    const gauge = document.getElementById(`gauge-${index}`);
    if (!gauge) return;

    const gaugeRect = gauge.getBoundingClientRect();
    const emitX = gaugeRect.right;
    const emitY = gaugeRect.top + gaugeRect.height / 2;

    for (let i = 0; i < 2; i++) {
      sparks.push(createSpark(emitX + Math.random() * 4, emitY + (Math.random() - 0.5) * 10));
    }
  });
}

function updateAndDrawSparks() {
  sparkCtx.clearRect(0, 0, sparkCanvas.width, sparkCanvas.height);

  sparks = sparks.filter(s => s.life > 0);

  sparks.forEach(s => {
    s.x += s.vx;
    s.y += s.vy;
    s.vy += 0.05; // slight gravity
    s.vx *= 0.99;
    s.life -= s.decay;

    const alpha = s.life;
    sparkCtx.beginPath();
    sparkCtx.arc(s.x, s.y, s.size * s.life, 0, Math.PI * 2);
    sparkCtx.fillStyle = `rgba(${s.color[0]}, ${s.color[1]}, ${s.color[2]}, ${alpha})`;
    sparkCtx.fill();

    // Glow
    sparkCtx.beginPath();
    sparkCtx.arc(s.x, s.y, s.size * s.life * 3, 0, Math.PI * 2);
    sparkCtx.fillStyle = `rgba(${s.color[0]}, ${s.color[1]}, ${s.color[2]}, ${alpha * 0.15})`;
    sparkCtx.fill();
  });

  // Cap particles
  if (sparks.length > 300) {
    sparks = sparks.slice(-300);
  }
}

// ================================================================
// AMBIENT EMBER PARTICLES (floating upward)
// ================================================================
let embers = [];

function createEmber() {
  return {
    x: Math.random() * window.innerWidth,
    y: window.innerHeight + 10,
    vx: (Math.random() - 0.5) * 0.5,
    vy: -(Math.random() * 0.8 + 0.3),
    life: 1.0,
    decay: Math.random() * 0.003 + 0.001,
    size: Math.random() * 2 + 0.5,
    wobble: Math.random() * Math.PI * 2,
    wobbleSpeed: Math.random() * 0.02 + 0.01,
  };
}

function updateAndDrawEmbers() {
  // Add new embers
  if (embers.length < 30 && Math.random() < 0.1) {
    embers.push(createEmber());
  }

  embers = embers.filter(e => e.life > 0 && e.y > -20);

  embers.forEach(e => {
    e.wobble += e.wobbleSpeed;
    e.x += e.vx + Math.sin(e.wobble) * 0.3;
    e.y += e.vy;
    e.life -= e.decay;

    const alpha = e.life * 0.6;
    sparkCtx.beginPath();
    sparkCtx.arc(e.x, e.y, e.size, 0, Math.PI * 2);
    sparkCtx.fillStyle = `rgba(255, ${80 + Math.floor(Math.random() * 40)}, 0, ${alpha})`;
    sparkCtx.fill();

    sparkCtx.beginPath();
    sparkCtx.arc(e.x, e.y, e.size * 4, 0, Math.PI * 2);
    sparkCtx.fillStyle = `rgba(255, 100, 0, ${alpha * 0.08})`;
    sparkCtx.fill();
  });
}

// ================================================================
// ANIMATION LOOP
// ================================================================
function animationLoop() {
  updateAndDrawSparks();
  updateAndDrawEmbers();
  requestAnimationFrame(animationLoop);
}

// ================================================================
// INITIALIZATION
// ================================================================
function init() {
  renderForgeStations();
  renderAlerts();
  renderToolFurnace();
  renderThroughputChart();
  renderLogEntries();
  updateClock();

  // Clock — every second
  setInterval(updateClock, 1000);
  setInterval(updateUptime, 1000);

  // Metrics — every 2 seconds
  setInterval(updateMetrics, 2000);

  // Agent progress — every 1.5 seconds
  setInterval(updateAgentProgress, 1500);

  // Tool counts — every 3 seconds
  setInterval(updateToolCounts, 3000);

  // New log entry — every 1.2 seconds
  setInterval(() => {
    addLogEntry(document.getElementById('logEntries'), true);
  }, 1200);

  // New alert — every 8 seconds
  setInterval(addNewAlert, 8000);

  // Spark emission — every 100ms
  setInterval(emitSparksFromForge, 100);

  // Throughput chart update — every 10 seconds
  setInterval(() => {
    throughputData.shift();
    throughputData.push(Math.floor(Math.random() * 20) + 20);
    renderThroughputChart();
  }, 10000);

  // Start animation loop
  animationLoop();
}

// Wait for fonts then init
document.fonts.ready.then(init);
</script>
</body>
</html>
