---
# Agent Sandbox CRD definitions
# These define the custom resource types for the Agent Sandbox controller
# Based on the agents.x-k8s.io/v1alpha1 API group
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: sandboxes.agents.x-k8s.io
spec:
  group: agents.x-k8s.io
  names:
    kind: Sandbox
    listKind: SandboxList
    plural: sandboxes
    singular: sandbox
    shortNames:
      - sb
  scope: Namespaced
  versions:
    - name: v1alpha1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                sandboxTemplateRef:
                  type: object
                  properties:
                    name:
                      type: string
                  required:
                    - name
                podTemplateSpec:
                  type: object
                  x-kubernetes-preserve-unknown-fields: true
                networkPolicy:
                  type: object
                  x-kubernetes-preserve-unknown-fields: true
                volumeClaims:
                  type: array
                  items:
                    type: object
                    x-kubernetes-preserve-unknown-fields: true
                runtimeClassName:
                  type: string
                ttlSecondsAfterFinished:
                  type: integer
            status:
              type: object
              properties:
                phase:
                  type: string
                  enum:
                    - Pending
                    - Running
                    - Paused
                    - Succeeded
                    - Failed
                podName:
                  type: string
                podIP:
                  type: string
                startTime:
                  type: string
                  format: date-time
                conditions:
                  type: array
                  items:
                    type: object
                    properties:
                      type:
                        type: string
                      status:
                        type: string
                      reason:
                        type: string
                      message:
                        type: string
                      lastTransitionTime:
                        type: string
                        format: date-time
          x-kubernetes-preserve-unknown-fields: true
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Phase
          type: string
          jsonPath: .status.phase
        - name: Pod
          type: string
          jsonPath: .status.podName
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: sandboxtemplates.agents.x-k8s.io
spec:
  group: agents.x-k8s.io
  names:
    kind: SandboxTemplate
    listKind: SandboxTemplateList
    plural: sandboxtemplates
    singular: sandboxtemplate
    shortNames:
      - sbt
  scope: Namespaced
  versions:
    - name: v1alpha1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                podTemplateSpec:
                  type: object
                  x-kubernetes-preserve-unknown-fields: true
                networkPolicy:
                  type: object
                  x-kubernetes-preserve-unknown-fields: true
                volumeClaims:
                  type: array
                  items:
                    type: object
                    x-kubernetes-preserve-unknown-fields: true
                runtimeClassName:
                  type: string
            status:
              type: object
              properties:
                conditions:
                  type: array
                  items:
                    type: object
                    x-kubernetes-preserve-unknown-fields: true
          x-kubernetes-preserve-unknown-fields: true
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: sandboxclaims.agents.x-k8s.io
spec:
  group: agents.x-k8s.io
  names:
    kind: SandboxClaim
    listKind: SandboxClaimList
    plural: sandboxclaims
    singular: sandboxclaim
    shortNames:
      - sbc
  scope: Namespaced
  versions:
    - name: v1alpha1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                sandboxTemplateRef:
                  type: object
                  properties:
                    name:
                      type: string
                  required:
                    - name
            status:
              type: object
              properties:
                phase:
                  type: string
                  enum:
                    - Pending
                    - Bound
                    - Failed
                sandboxRef:
                  type: object
                  properties:
                    name:
                      type: string
                conditions:
                  type: array
                  items:
                    type: object
                    x-kubernetes-preserve-unknown-fields: true
          x-kubernetes-preserve-unknown-fields: true
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Phase
          type: string
          jsonPath: .status.phase
        - name: Sandbox
          type: string
          jsonPath: .status.sandboxRef.name
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: sandboxwarmpools.agents.x-k8s.io
spec:
  group: agents.x-k8s.io
  names:
    kind: SandboxWarmPool
    listKind: SandboxWarmPoolList
    plural: sandboxwarmpools
    singular: sandboxwarmpool
    shortNames:
      - sbwp
  scope: Namespaced
  versions:
    - name: v1alpha1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                templateRef:
                  type: object
                  properties:
                    name:
                      type: string
                  required:
                    - name
                desiredReady:
                  type: integer
                  minimum: 0
                maxSize:
                  type: integer
                  minimum: 1
            status:
              type: object
              properties:
                readyReplicas:
                  type: integer
                availableReplicas:
                  type: integer
                conditions:
                  type: array
                  items:
                    type: object
                    x-kubernetes-preserve-unknown-fields: true
          x-kubernetes-preserve-unknown-fields: true
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Ready
          type: integer
          jsonPath: .status.readyReplicas
        - name: Desired
          type: integer
          jsonPath: .spec.desiredReady
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
