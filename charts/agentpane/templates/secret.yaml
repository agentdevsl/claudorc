{{/* AI credentials secret — only created when no existingSecret is provided */}}
{{- if not .Values.ai.existingSecret }}
{{- if or .Values.ai.anthropicApiKey .Values.ai.claudeOauthToken }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ printf "%s-ai" (include "agentpane.fullname" .) }}
  labels:
    {{- include "agentpane.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if .Values.ai.anthropicApiKey }}
  {{ .Values.ai.secretKeys.anthropicApiKeyKey | default "ANTHROPIC_API_KEY" }}: {{ .Values.ai.anthropicApiKey | b64enc | quote }}
  {{- end }}
  {{- if .Values.ai.claudeOauthToken }}
  {{ .Values.ai.secretKeys.claudeOauthTokenKey | default "CLAUDE_OAUTH_TOKEN" }}: {{ .Values.ai.claudeOauthToken | b64enc | quote }}
  {{- end }}
{{- end }}
{{- end }}
---
{{/* Database secret — only for external DB without existingSecret */}}
{{- if and .Values.database.external.enabled (not .Values.database.external.existingSecret) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ printf "%s-database" (include "agentpane.fullname" .) }}
  labels:
    {{- include "agentpane.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if .Values.database.external.password }}
  {{ .Values.database.external.secretKeys.passwordKey | default "password" }}: {{ .Values.database.external.password | b64enc | quote }}
  {{- end }}
{{- end }}
---
{{/* GitHub credentials secret — only created when GitHub is enabled without existingSecret */}}
{{- if and .Values.github.enabled (not .Values.github.existingSecret) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ printf "%s-github" (include "agentpane.fullname" .) }}
  labels:
    {{- include "agentpane.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if .Values.github.clientSecret }}
  {{ .Values.github.secretKeys.clientSecretKey | default "GITHUB_CLIENT_SECRET" }}: {{ .Values.github.clientSecret | b64enc | quote }}
  {{- end }}
  {{- if .Values.github.privateKey }}
  {{ .Values.github.secretKeys.privateKeyKey | default "GITHUB_PRIVATE_KEY" }}: {{ .Values.github.privateKey | b64enc | quote }}
  {{- end }}
  {{- if .Values.github.webhookSecret }}
  {{ .Values.github.secretKeys.webhookSecretKey | default "GITHUB_WEBHOOK_SECRET" }}: {{ .Values.github.webhookSecret | b64enc | quote }}
  {{- end }}
{{- end }}
